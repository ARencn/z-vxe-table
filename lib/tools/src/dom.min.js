"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.DomTools=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_utils=_interopRequireDefault(require("./utils"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var browse=_xeUtils.default.browse(),htmlElem=browse.isDoc?document.querySelector("html"):0,bodyElem=browse.isDoc?document.body:0;function getClsRE(e){return reClsMap[e]||(reClsMap[e]=new RegExp("(?:^|\\s)".concat(e,"(?!\\S)"),"g")),reClsMap[e]}var reClsMap={},DomTools={browse:browse,isPx:function(e){return e&&/^\d+(px)?$/.test(e)},isScale:function(e){return e&&/^\d+%$/.test(e)},hasClass:function(e,t){return e&&e.className&&e.className.match&&e.className.match(getClsRE(t))},removeClass:function(e,t){e&&DomTools.hasClass(e,t)&&(e.className=e.className.replace(getClsRE(t),""))},addClass:function(e,t){e&&!DomTools.hasClass(e,t)&&(DomTools.removeClass(e,t),e.className="".concat(e.className," ").concat(t))},updateCellTitle:function(e){var t=e.currentTarget.querySelector(".vxe-cell"),o=t.innerText;t.getAttribute("title")!==o&&t.setAttribute("title",o)},rowToVisible:function(e,t){var o=e.$refs.tableBody.$el,r=o.querySelector('[data-rowid="'.concat(_utils.default.getRowid(e,t),'"]'));if(r){var l=o.clientHeight,s=o.scrollTop,n=r.offsetTop+(r.offsetParent?r.offsetParent.offsetTop:0),a=r.clientHeight;if(n<s||s+l<n)return e.scrollTo(null,n);if(l+s<=n+a)return e.scrollTo(null,s+a)}else if(e.scrollYLoad)return e.scrollTo(null,(e.afterFullData.indexOf(t)-1)*e.scrollYStore.rowHeight);return Promise.resolve()},colToVisible:function(e,t){var o=e.$refs.tableBody.$el,r=o.querySelector(".".concat(t.id));if(r){var l=o.clientWidth,s=o.scrollLeft,n=r.offsetLeft+(r.offsetParent?r.offsetParent.offsetLeft:0),a=r.clientWidth;if(n<s||s+l<n)return e.scrollTo(n);if(l+s<=n+a)return e.scrollTo(s+a)}else if(e.scrollXLoad){for(var i=e.visibleColumn,c=0,f=0;f<i.length&&i[f]!==t;f++)c+=i[f].renderWidth;return e.scrollTo(c)}return Promise.resolve()},getDomNode:function(){var e=document.documentElement,t=document.body;return{scrollTop:e.scrollTop||t.scrollTop,scrollLeft:e.scrollLeft||t.scrollLeft,visibleHeight:e.clientHeight||t.clientHeight,visibleWidth:e.clientWidth||t.clientWidth}},getEventTargetNode:function(e,t,o){for(var r,l=e.target;l&&l.nodeType&&l!==document;){if(o&&DomTools.hasClass(l,o))r=l;else if(l===t)return{flag:!o||!!r,container:t,targetElem:r};l=l.parentNode}return{flag:!1}},getOffsetPos:function(e,t){return getNodeOffset(e,t,{left:0,top:0})},getAbsolutePos:function(e){var t=e.getBoundingClientRect(),o=DomTools.getDomNode(),r=o.scrollTop,l=o.scrollLeft;return{top:r+t.top,left:l+t.left}},getCellIndexs:function(e){var t=e.parentNode,o=t.getAttribute("data-rowid"),r=[].indexOf.call(t.children,e);return{rowid:o,rowIndex:[].indexOf.call(t.parentNode.children,t),columnIndex:r}},getCell:function(e,t){var o=t.row,r=(t.rowIndex,t.column),l=_utils.default.getRowid(e,o);return(e.$refs["".concat(r.fixed||"table","Body")]||e.$refs.tableBody).$el.querySelector('.vxe-body--row[data-rowid="'.concat(l,'"] .').concat(r.id))},getCursorPosition:function(e){var t={text:"",start:0,end:0};if(e.setSelectionRange)t.start=e.selectionStart,t.end=e.selectionEnd,t.text=t.start!==t.end?e.value.substring(t.start,t.end):"";else if(document.selection){var o=0,r=document.selection.createRange(),l=document.body.createTextRange();for(l.moveToElementText(e),t.text=r.text,t.bookmark=r.getBookmark();l.compareEndPoints("StartToStart",r)<0&&0!==r.moveStart("character",-1);o++)"\n"===e.value.charAt(o)&&o++;t.start=o,t.end=t.text.length+t.start}return t},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t.start,t.end);else if(e.createTextRange){var o=e.createTextRange();e.value.length===t.start?o.collapse(!1):o.moveToBookmark(t.bookmark),o.select()}},toView:function(e){var t="scrollIntoViewIfNeeded",o="scrollIntoView";e&&(e[t]?e[t]():e[o]&&e[o]())}};function getNodeOffset(e,t,o){if(e){var r=e.parentNode;if(o.top+=e.offsetTop,o.left+=e.offsetLeft,r&&r!==htmlElem&&r!==bodyElem&&(o.top-=r.scrollTop,o.left-=r.scrollLeft),(!t||e!==t&&e.offsetParent!==t)&&e.offsetParent)return getNodeOffset(e.offsetParent,t,o)}return o}var _default=exports.DomTools=DomTools;exports.default=_default;