"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var _default2={name:"VxeTooltip",props:{value:Boolean,trigger:{type:String,default:function(){return _conf.default.tooltip.trigger}},theme:{type:String,default:function(){return _conf.default.tooltip.theme}},content:[String,Function],zIndex:[String,Number],isArrow:{type:Boolean,default:!0},enterable:Boolean,leaveDelay:{type:Number,default:_conf.default.tooltip.leaveDelay}},data:function(){return{isUpdate:!1,isHover:!1,visible:!1,message:"",tipZindex:0,tipStore:{style:{},placement:"",arrowStyle:null}}},watch:{content:function(t){this.message=t},value:function(t){this.isUpdate||this[t?"show":"close"](),this.isUpdate=!1}},mounted:function(){var i,o=this.$el,t=this.trigger,e=this.content,s=this.value,n=o.parentNode;this.message=e,this.tipZindex=_tools.UtilTools.nextZIndex(),_xeUtils.default.arrayEach(o.children,function(t,e){1<e&&(n.insertBefore(t,o),i=i||t)}),n.removeChild(o),(this.target=i)&&("hover"===t?(i.onmouseleave=this.targetMouseleaveEvent,i.onmouseenter=this.targetMouseenterEvent):"click"===t&&(i.onclick=this.clickEvent)),s&&this.show()},beforeDestroy:function(){var t=this.$el,e=this.target,i=this.trigger,o=t.parentNode;o&&o.removeChild(t),e&&("hover"===i?(e.onmouseenter=null,e.onmouseleave=null):"click"===i&&(e.onclick=null))},render:function(t){var e=this.theme,i=this.message,o=this.isHover,s=this.isArrow,n=this.visible,l=this.tipStore,r=this.enterable,a=null;return r&&(a={mouseenter:this.wrapperMouseenterEvent,mouseleave:this.wrapperMouseleaveEvent}),t("div",{class:["vxe-table--tooltip-wrapper","theme--".concat(e),"placement--".concat(l.placement),{"is--enterable":r,"is--visible":n,"is--arrow":s,"is--hover":o}],style:l.style,ref:"tipWrapper",on:a},[t("div",{class:"vxe-table--tooltip-content"},this.$slots.content||i),t("div",{class:"vxe-table--tooltip-arrow",style:l.arrowStyle})].concat(this.$slots.default))},methods:{show:function(){return this.toVisible(this.target)},close:function(){return Object.assign(this.tipStore,{style:{},placement:"",arrowStyle:null}),this.update(!1),this.$nextTick()},update:function(t){t!==this.visible&&(this.visible=t,this.isUpdate=!0,this.$listeners.input&&this.$emit("input",this.visible))},updateZindex:function(){this.tipZindex<_tools.UtilTools.getLastZIndex()&&(this.tipZindex=_tools.UtilTools.nextZIndex())},toVisible:function(i,t){var o=this;if(this.targetActive=!0,i){var s=this.$el,n=this.tipStore,l=this.zIndex,e=_tools.DomTools.getAbsolutePos(i),r=e.top,a=e.left,c=_tools.DomTools.getDomNode(),h=c.scrollTop,u=c.scrollLeft,p=c.visibleWidth,f=s.parentNode,v=a;return n.placement="top",n.style={width:"auto"},n.arrowStyle={left:"50%"},f||document.body.appendChild(s),t&&(this.message=t),this.update(!0),this.updateZindex(),this.$nextTick().then(function(){if(s){var t=s.clientHeight,e=_xeUtils.default.toNumber(getComputedStyle(s).width);return v=a+Math.floor((i.offsetWidth-e)/2),n.style={zIndex:l||o.tipZindex,width:"".concat(e,"px"),top:"".concat(r-t-6,"px"),left:"".concat(v,"px")},o.$nextTick()}}).then(function(){if(s){var t=s.clientHeight,e=s.clientWidth;Object.assign(n.style,{top:"".concat(r-t-6,"px"),left:"".concat(v,"px")}),r-t<h+6&&(n.placement="bottom",n.style.top="".concat(r+i.offsetHeight+6,"px")),v<u+6?(v=u+6,n.arrowStyle.left="".concat(v+16<a?a-v+16:16,"px"),n.style.left="".concat(v,"px")):u+p<v+e&&(v=u+p-e-6,n.arrowStyle.left="".concat(e-Math.max(Math.floor((v+e-a)/2),22),"px"),n.style.left="".concat(v,"px"))}})}return this.$nextTick()},clickEvent:function(){this[this.visible?"close":"show"]()},targetMouseenterEvent:function(){this.show()},targetMouseleaveEvent:function(){var t=this,e=this.trigger,i=this.enterable,o=this.leaveDelay;this.targetActive=!1,i&&"hover"===e?setTimeout(function(){t.isHover||t.close()},o):this.close()},wrapperMouseenterEvent:function(){this.isHover=!0},wrapperMouseleaveEvent:function(t){var e=this,i=this.$listeners,o=this.trigger,s=this.enterable,n=this.leaveDelay;this.isHover=!1,i.leave?this.$emit("leave",t):s&&"hover"===o&&setTimeout(function(){e.targetActive||e.close()},n)}}};exports.default=_default2;