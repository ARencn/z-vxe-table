"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var Cell={createColumn:function(e,r){var l=r.type,t=r.sortable,n=r.remoteSort,o=r.filters,d=r.editRender,i=r.treeNode,a=e.editConfig,c=e.editOpts,s=e.checkboxOpts,u={renderHeader:this.renderDefaultHeader,renderCell:i?this.renderTreeCell:this.renderDefaultCell,renderFooter:this.renderDefaultFooter};switch(l){case"seq":case"index":u.renderHeader=this.renderIndexHeader,u.renderCell=i?this.renderTreeIndexCell:this.renderIndexCell;break;case"radio":u.renderHeader=this.renderRadioHeader,u.renderCell=i?this.renderTreeRadioCell:this.renderRadioCell;break;case"checkbox":case"selection":u.renderHeader=this.renderSelectionHeader,u.renderCell=s.checkField?i?this.renderTreeSelectionCellByProp:this.renderSelectionCellByProp:i?this.renderTreeSelectionCell:this.renderSelectionCell;break;case"expand":u.renderCell=this.renderExpandCell,u.renderData=this.renderExpandData;break;case"html":u.renderCell=i?this.renderTreeHTMLCell:this.renderHTMLCell,o&&(t||n)?u.renderHeader=this.renderSortAndFilterHeader:t||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader);break;default:a&&d?(u.renderHeader=this.renderEditHeader,u.renderCell="cell"===c.mode?i?this.renderTreeCellEdit:this.renderCellEdit:i?this.renderTreeRowEdit:this.renderRowEdit):o&&(t||n)?u.renderHeader=this.renderSortAndFilterHeader:t||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader)}return _tools.UtilTools.getColumnConfig(e,r,u)},renderDefaultHeader:function(e,r){var l=r.$table,t=r.column,n=t.slots,o=t.own,d=o.editRender||o.cellRender;if(n&&n.header)return n.header.call(l,r,e);if(d){var i=_vXETable.default.renderer.get(d.name);if(i&&i.renderHeader)return i.renderHeader.call(l,e,d,r,{$grid:l.$xegrid,$excel:l.$parent,$table:l})}return[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(o.title||o.label),1)]},renderDefaultCell:function(e,r){var l=r.$table,t=r.row,n=r.column,o=n.slots,d=n.own,i=d.editRender||d.cellRender;if(o&&o.default)return o.default.call(l,r,e);if(i){var a=d.editRender?"renderCell":"renderDefault",c=_vXETable.default.renderer.get(i.name);if(c&&c[a])return c[a].call(l,e,i,r,{$type:d.editRender?"edit":"cell",$grid:l.$grid,$excel:l.$parent,$table:l,$column:n})}return[_tools.UtilTools.formatText(_tools.UtilTools.getCellLabel(t,n,r),1)]},renderTreeCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderDefaultCell.call(this,e,r))},renderDefaultFooter:function(e,r){var l=r.$table,t=r.column,n=r.cellIndex,o=r.cells,d=t.slots,i=t.own,a=i.editRender||i.cellRender;if(d&&d.footer)return d.footer.call(l,r,e);if(a){var c=_vXETable.default.renderer.get(a.name);if(c&&c.renderFooter)return c.renderFooter.call(l,e,a,r,{$grid:l.$xegrid,$excel:l.$parent,$table:l})}return[_tools.UtilTools.formatText(o[n],1)]},renderTreeIcon:function(e,r,l){var t=r.$table,n=r.isHidden,o=t.treeOpts,d=t.treeExpandeds,i=t.treeLazyLoadeds,a=r.row,c=r.column,s=r.level,u=c.slots,f=o.children,x=o.hasChild,C=o.indent,h=o.lazy,v=o.trigger,b=o.iconLoaded,p=o.iconOpen,T=o.iconClose,_=a[f],g=!1,m=!1,H=!1,$={};return u&&u.icon?u.icon.call(t,r,e):(n||(m=-1<d.indexOf(a),h&&(H=-1<i.indexOf(a),g=a[x])),v&&"default"!==v||($.click=function(e){return t.triggerTreeExpandEvent(e,r)}),[e("div",{class:["vxe-cell--tree-node",{"is--active":m}],style:{paddingLeft:"".concat(s*C,"px")}},[_&&_.length||g?[e("div",{class:"vxe-tree--btn-wrapper",on:$},[e("i",{class:["vxe-tree--node-btn",H?b||_conf.default.icon.treeLoaded:m?p||_conf.default.icon.treeOpen:T||_conf.default.icon.treeClose]})])]:null,e("div",{class:"vxe-tree-cell"},l)])])},renderIndexHeader:function(e,r){var l=r.$table,t=r.column,n=t.slots;return n&&n.header?n.header.call(l,r,e):[_tools.UtilTools.formatText(t.getTitle(),1)]},renderIndexCell:function(e,r){var l=r.$table,t=r.column,n=l.seqOpts,o=l.startIndex,d=t.slots,i=t.indexMethod;if(d&&d.default)return d.default.call(l,r,e);var a=r.$seq,c=r.seq,s=r.level,u=n.seqMethod||i;return[_tools.UtilTools.formatText(u?u(r):s?"".concat(a,".").concat(c):(n.startIndex||o)+c,1)]},renderTreeIndexCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderIndexCell(e,r))},renderRadioHeader:function(e,r){var l=r.$table,t=r.column,n=t.slots,o=t.own;return n&&n.header?n.header.call(l,r,e):[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(o.title||o.label),1)]},renderRadioCell:function(e,r){var l,t=r.$table,n=r.column,o=r.isHidden,d=t.radioOpts,i=t.selectRow,a=n.slots,c=d.checkMethod,s=r.row,u=d.labelField||d.labelProp,f=s===i,x=!!c;return o||(l={click:function(e){x||t.triggerRadioRowEvent(e,r)}},c&&(x=!c(r))),[e("span",{class:["vxe-cell--radio",{"is--checked":f,"is--disabled":x}],on:l},[e("i",{class:"vxe-radio--icon"})].concat(u?a&&a.default?a.default.call(t,r,e):[_xeUtils.default.get(s,u)]:[]))]},renderTreeRadioCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderRadioCell(e,r))},renderSelectionHeader:function(e,r){var l,t=r.$table,n=r.column,o=r.isHidden,d=t.isIndeterminate,i=t.isAllCheckboxDisabled,a=t.checkboxOpts,c=n.slots,s=n.own,u=s.title||s.label,f=!1;return(a.checkStrictly?a.showHeader:!1!==a.showHeader)?(o||(f=!i&&t.isAllSelected,l={click:function(e){i||t.triggerCheckAllEvent(e,!f)}}),[e("span",{class:["vxe-cell--checkbox",{"is--checked":f,"is--disabled":i,"is--indeterminate":d}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:l},[e("i",{class:"vxe-checkbox--icon"})].concat(u?c&&c.header?c.header.call(t,r,e):[_tools.UtilTools.getFuncText(u)]:[]))]):c&&c.header?c.header.call(t,r,e):[_tools.UtilTools.getFuncText(u)]},renderSelectionCell:function(e,r){var l,t=r.$table,n=r.row,o=r.column,d=r.isHidden,i=t.treeConfig,a=t.treeIndeterminates,c=t.checkboxOpts,s=c.checkMethod,u=o.slots,f=c.labelField||c.labelProp,x=!1,C=!1,h=!!s;return d||(C=-1<t.selection.indexOf(n),l={click:function(e){h||t.triggerCheckRowEvent(e,r,!C)}},s&&(h=!s(r)),i&&(x=-1<a.indexOf(n))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":C,"is--disabled":h,"is--indeterminate":x}],on:l},[e("i",{class:"vxe-checkbox--icon"})].concat(f?u&&u.default?u.default.call(t,r,e):[_xeUtils.default.get(n,f)]:[]))]},renderTreeSelectionCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderSelectionCell(e,r))},renderSelectionCellByProp:function(e,r){var l,t=r.$table,n=r.row,o=r.column,d=r.isHidden,i=t.treeConfig,a=t.treeIndeterminates,c=t.checkboxOpts,s=c.checkMethod,u=o.slots,f=c.labelField||c.labelProp,x=!1,C=!!s,h=c.checkField||c.checkProp,v=!1;return d||(v=_xeUtils.default.get(n,h),l={click:function(e){C||t.triggerCheckRowEvent(e,r,!v)}},s&&(C=!s(r)),i&&(x=-1<a.indexOf(n))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":v,"is--disabled":C,"is--indeterminate":x}],on:l},[e("i",{class:"vxe-checkbox--icon"})].concat(f?u&&u.default?u.default.call(t,r,e):[_xeUtils.default.get(n,f)]:[]))]},renderTreeSelectionCellByProp:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderSelectionCellByProp(e,r))},renderExpandCell:function(e,r){var l=r.$table,t=r.isHidden,n=r.row,o=r.column,d=l.expandOpts,i=l.rowExpandeds,a=l.expandLazyLoadeds,c=d.lazy,s=d.labelField,u=d.iconLoaded,f=d.iconOpen,x=d.iconClose,C=o.slots,h=!1,v=!1;return C&&C.icon?C.icon.call(l,r,e):(t||(h=-1<i.indexOf(r.row),c&&(v=-1<a.indexOf(n))),[e("span",{class:["vxe-table--expanded",{"is--active":h}],on:{click:function(e){l.triggerRowExpandEvent(e,r)}}},[e("i",{class:["vxe-table--expand-btn",v?u||_conf.default.icon.treeLoaded:h?f||_conf.default.icon.expandOpen:x||_conf.default.icon.expandClose]})]),C.content&&C.default?C.default.call(l,r,e):s?_xeUtils.default.get(n,s):null])},renderExpandData:function(e,r){var l=r.$table,t=r.column.slots;if(t){if(t.content)return t.content.call(l,r,e);if(t.default)return t.default.call(l,r,e)}return[]},renderHTMLCell:function(e,r){var l=r.$table,t=r.row,n=r.column,o=n.slots;return o&&o.default?o.default.call(l,r,e):[e("span",{class:"vxe-cell--html",domProps:{innerHTML:_tools.UtilTools.formatText(_tools.UtilTools.getCellLabel(t,n,r),1)}})]},renderTreeHTMLCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderHTMLCell(e,r))},renderSortAndFilterHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderSortIcon(e,r)).concat(Cell.renderFilterIcon(e,r))},renderSortHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderSortIcon(e,r))},renderSortIcon:function(e,r){var l=r.$table,t=r.column,n=l.sortOpts,o=n.showIcon,d=n.iconAsc,i=n.iconDesc;return!1===o?[]:[e("span",{class:"vxe-sort-wrapper"},[e("i",{class:["vxe-sort--asc-btn",d||_conf.default.icon.sortAsc,{"sort--active":"asc"===t.order}],attrs:{title:_conf.default.i18n("vxe.table.sortAsc")},on:{click:function(e){l.triggerSortEvent(e,t,"asc")}}}),e("i",{class:["vxe-sort--desc-btn",i||_conf.default.icon.sortDesc,{"sort--active":"desc"===t.order}],attrs:{title:_conf.default.i18n("vxe.table.sortDesc")},on:{click:function(e){l.triggerSortEvent(e,t,"desc")}}})])]},renderFilterHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderFilterIcon(e,r))},renderFilterIcon:function(e,r){var l=r.$table,t=r.column,n=r.hasFilter,o=l.filterStore,d=l.filterOpts,i=d.showIcon,a=d.iconNone,c=d.iconMatch;return!1===i?[]:[e("span",{class:["vxe-filter-wrapper",{"is--active":o.visible&&o.column===t}]},[e("i",{class:["vxe-filter--btn",n?c||_conf.default.icon.filterMatch:a||_conf.default.icon.filterNone],attrs:{title:_conf.default.i18n("vxe.table.filter")},on:{click:function(e){l.triggerFilterEvent(e,r.column,r)}}})])]},renderEditHeader:function(e,r){var l,t=r.$table,n=r.column,o=t.editRules,d=t.editOpts,i=n.sortable,a=n.remoteSort,c=n.filters;if(o){var s=_xeUtils.default.get(o,r.column.property);s&&(l=s.some(function(e){return e.required}))}return[l?e("i",{class:"vxe-required-icon"}):null,!1===d.showIcon?null:e("i",{class:["vxe-edit-icon",d.icon||_conf.default.icon.edit]})].concat(Cell.renderDefaultHeader(e,r)).concat(i||a?Cell.renderSortIcon(e,r):[]).concat(c?Cell.renderFilterIcon(e,r):[])},renderRowEdit:function(e,r){var l=r.$table.editStore.actived;return Cell.runRenderer(e,r,this,l&&l.row===r.row)},renderTreeRowEdit:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderRowEdit(e,r))},renderCellEdit:function(e,r){var l=r.$table.editStore.actived;return Cell.runRenderer(e,r,this,l&&l.row===r.row&&l.column===r.column)},renderTreeCellEdit:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderCellEdit(e,r))},runRenderer:function(e,r,l,t){var n=r.$table,o=r.row,d=r.column,i=d.slots,a=d.own,c=d.formatter,s=a.editRender,u=_vXETable.default.renderer.get(s.name);return"visible"===s.type||t?i&&i.edit?i.edit.call(n,r,e):u&&u.renderEdit?u.renderEdit.call(n,e,s,r,{$type:"edit",$grid:n.$grid,$excel:n.$parent,$table:n,$column:d}):[]:i&&i.default?i.default.call(n,r,e):c?[_tools.UtilTools.formatText(_tools.UtilTools.getCellLabel(o,d,r),1)]:Cell.renderDefaultCell.call(l,e,r)}},_default=exports.Cell=Cell;exports.default=_default;