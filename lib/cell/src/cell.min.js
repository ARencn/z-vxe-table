"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=require("../../v-x-e-table"),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var Cell={createColumn:function(e,r){var t=r.type,l=r.sortable,n=r.remoteSort,o=r.filters,d=r.editRender,i=r.treeNode,c=e.checkboxOpts,a={renderHeader:this.renderHeader,renderCell:i?this.renderTreeCell:this.renderCell};switch(t){case"seq":case"index":a.renderHeader=this.renderIndexHeader,a.renderCell=i?this.renderTreeIndexCell:this.renderIndexCell;break;case"radio":a.renderHeader=this.renderRadioHeader,a.renderCell=i?this.renderTreeRadioCell:this.renderRadioCell;break;case"checkbox":case"selection":a.renderHeader=this.renderSelectionHeader,a.renderCell=c.checkField||c.checkProp?i?this.renderTreeSelectionCellByProp:this.renderSelectionCellByProp:i?this.renderTreeSelectionCell:this.renderSelectionCell;break;case"expand":a.renderCell=this.renderExpandCell,a.renderData=this.renderExpandData;break;case"html":a.renderCell=this.renderHTMLCell;break;default:d?(a.renderHeader=this.renderEditHeader,a.renderCell=e.editConfig&&"cell"===e.editConfig.mode?i?this.renderTreeCellEdit:this.renderCellEdit:i?this.renderTreeRadioCell:this.renderRowEdit):o&&o.length&&(l||n)?a.renderHeader=this.renderSortAndFilterHeader:l||n?a.renderHeader=this.renderSortHeader:o&&o.length&&(a.renderHeader=this.renderFilterHeader)}return _tools.UtilTools.getColumnConfig(e,r,a)},renderHeader:function(e,r){var t=r.column,l=t.slots,n=t.own;return l&&l.header?l.header(r,e):[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(n.title||n.label),1)]},renderCell:function(e,r){var t=r.$table,l=r.row,n=r.column,o=n.slots,d=n.own,i=d.editRender||d.cellRender;if(o&&o.default)return o.default(r,e);if(i){var c=d.editRender?"renderCell":"renderDefault",a=_vXETable.Renderer.get(i.name);if(a&&a[c])return a[c].call(t,e,i,r,{$type:d.editRender?"edit":"cell",$grid:t.$grid,$excel:t.$parent,$table:t,$column:n})}return[_tools.UtilTools.formatText(_tools.UtilTools.getCellLabel(l,n,r),1)]},renderTreeCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderCell.call(this,e,r))},renderTreeIcon:function(e,r){var t=r.$table,l=r.isHidden,n=t.treeOpts,o=t.treeExpandeds,d=t.treeLazyLoadeds,i=r.row,c=r.column,a=r.level,s=c.slots,u=n.children,f=n.hasChild,C=n.indent,x=n.lazy,h=n.trigger,p=n.iconLoaded,v=n.iconOpen,b=n.iconClose,T=i[u],g=!1,_=!1,m=!1,w={};return s&&s.icon?s.icon(r,e):(l||(_=-1<o.indexOf(i),x&&(m=-1<d.indexOf(i),g=i[f])),h&&"default"!==h||(w.click=function(e){return t.triggerTreeExpandEvent(e,r)}),[e("span",{class:"vxe-tree--indent",style:{width:"".concat(a*(C||20),"px")}}),e("span",{class:["vxe-tree-wrapper",{"is--active":_}],on:w},T&&T.length||g?[e("span",{class:"vxe-tree--btn-wrapper"},[e("i",{class:["vxe-tree--node-btn",m?p||_conf.default.icon.treeLoaded:_?v||_conf.default.icon.treeOpen:b||_conf.default.icon.treeClose]})])]:[])])},renderIndexHeader:function(e,r){var t=r.column,l=t.slots;return l&&l.header?l.header(r,e):[_tools.UtilTools.formatText(t.getTitle(),1)]},renderIndexCell:function(e,r){var t=r.$table,l=r.column,n=t.seqOpts,o=t.startIndex,d=l.slots,i=l.indexMethod;if(d&&d.default)return d.default(r,e);var c=r.$seq,a=r.seq,s=r.level,u=n.seqMethod||i;return[_tools.UtilTools.formatText(u?u(r):s?"".concat(c,".").concat(a):(n.startIndex||o)+a,1)]},renderTreeIndexCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderIndexCell(e,r))},renderRadioHeader:function(e,r){var t=r.column,l=t.slots,n=t.own;return l&&l.header?l.header(r,e):[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(n.title||n.label),1)]},renderRadioCell:function(e,r){var t,l=r.$table,n=r.column,o=r.isHidden,d=l.radioOpts,i=l.selectRow,c=n.slots,a=d.checkMethod,s=r.row,u=d.labelField||d.labelProp,f=s===i,C=!!a;return o||(t={click:function(e){C||l.triggerRadioRowEvent(e,r)}},a&&(C=!a(r))),[e("span",{class:["vxe-cell--radio",{"is--checked":f,"is--disabled":C}],on:t},u?c&&c.default?c.default(r,e):_xeUtils.default.get(s,u):null)]},renderTreeRadioCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderRadioCell(e,r))},renderSelectionHeader:function(e,r){var t,l=r.$table,n=r.column,o=r.isHidden,d=l.isIndeterminate,i=l.isAllCheckboxDisabled,c=l.checkboxOpts,a=n.slots,s=n.own,u=s.title||s.label,f=!1;return(c.checkStrictly?c.showHeader:!1!==c.showHeader)?(o||(f=!i&&l.isAllSelected,t={click:function(e){i||l.triggerCheckAllEvent(e,!f)}}),[e("span",{class:["vxe-cell--checkbox",{"is--checked":f,"is--disabled":i,"is--indeterminate":d}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:t},u?a&&a.header?a.header(r,e):_tools.UtilTools.getFuncText(u):null)]):a&&a.header?a.header(r,e):[_tools.UtilTools.getFuncText(u)]},renderSelectionCell:function(e,r){var t,l=r.$table,n=r.row,o=r.column,d=r.isHidden,i=l.treeConfig,c=l.treeIndeterminates,a=l.checkboxOpts,s=a.checkMethod,u=o.slots,f=a.labelField||a.labelProp,C=!1,x=!1,h=!!s;return d||(x=-1<l.selection.indexOf(n),t={click:function(e){h||l.triggerCheckRowEvent(e,r,!x)}},s&&(h=!s(r)),i&&(C=-1<c.indexOf(n))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":x,"is--disabled":h,"is--indeterminate":C}],on:t},f?u&&u.default?u.default(r,e):_xeUtils.default.get(n,f):null)]},renderTreeSelectionCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderSelectionCell(e,r))},renderSelectionCellByProp:function(e,r){var t,l=r.$table,n=r.row,o=r.column,d=r.isHidden,i=l.treeConfig,c=l.treeIndeterminates,a=l.checkboxOpts,s=a.checkMethod,u=o.slots,f=a.labelField||a.labelProp,C=!1,x=!!s,h=a.checkField||a.checkProp,p=!1;return d||(p=_xeUtils.default.get(n,h),t={click:function(e){x||l.triggerCheckRowEvent(e,r,!p)}},s&&(x=!s(r)),i&&(C=-1<c.indexOf(n))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":p,"is--disabled":x,"is--indeterminate":C}],on:t},f?u&&u.default?u.default(r,e):_xeUtils.default.get(n,f):null)]},renderTreeSelectionCellByProp:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderSelectionCellByProp(e,r))},renderExpandCell:function(e,r){var t=r.$table,l=r.isHidden,n=r.row,o=r.column,d=t.expandOpts,i=t.rowExpandeds,c=t.expandLazyLoadeds,a=d.lazy,s=d.labelField,u=d.iconLoaded,f=d.iconOpen,C=d.iconClose,x=o.slots,h=!1,p=!1;return x&&x.icon?x.icon(r,e):(l||(h=-1<i.indexOf(r.row),a&&(p=-1<c.indexOf(n))),[e("span",{class:["vxe-table--expanded",{"is--active":h}],on:{click:function(e){t.triggerRowExpandEvent(e,r)}}},[e("i",{class:["vxe-table--expand-btn",p?u||_conf.default.icon.treeLoaded:h?f||_conf.default.icon.expandOpen:C||_conf.default.icon.expandClose]})]),x.content&&x.default?x.default(r,e):s?_xeUtils.default.get(n,s):null])},renderExpandData:function(e,r){var t=r.column.slots;if(t){if(t.content)return t.content(r,e);if(t.default)return t.default(r,e)}return[]},renderHTMLCell:function(e,r){var t=r.row,l=r.column,n=l.slots;return n&&n.default?n.default(r,e):[e("span",{class:"vxe-cell--html",domProps:{innerHTML:_tools.UtilTools.formatText(_tools.UtilTools.getCellLabel(t,l,r),1)}})]},renderSortAndFilterHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderSortIcon(e,r)).concat(Cell.renderFilterIcon(e,r))},renderSortHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderSortIcon(e,r))},renderSortIcon:function(e,r){var t=r.$table,l=r.column,n=t.sortOpts,o=n.showIcon,d=n.iconAsc,i=n.iconDesc;return!1===o?[]:[e("span",{class:"vxe-sort-wrapper"},[e("i",{class:["vxe-sort--asc-btn",d||_conf.default.icon.sortAsc,{"sort--active":"asc"===l.order}],attrs:{title:_conf.default.i18n("vxe.table.sortAsc")},on:{click:function(e){t.triggerSortEvent(e,l,"asc")}}}),e("i",{class:["vxe-sort--desc-btn",i||_conf.default.icon.sortDesc,{"sort--active":"desc"===l.order}],attrs:{title:_conf.default.i18n("vxe.table.sortDesc")},on:{click:function(e){t.triggerSortEvent(e,l,"desc")}}})])]},renderFilterHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderFilterIcon(e,r))},renderFilterIcon:function(e,r){var t=r.$table,l=r.column,n=r.hasFilter,o=t.filterStore,d=t.filterOpts,i=d.showIcon,c=d.iconNone,a=d.iconMatch;return!1===i?[]:[e("span",{class:["vxe-filter-wrapper",{"is--active":o.visible&&o.column===l}]},[e("i",{class:["vxe-filter--btn",n?a||_conf.default.icon.filterMatch:c||_conf.default.icon.filterNone],attrs:{title:_conf.default.i18n("vxe.table.filter")},on:{click:function(e){t.triggerFilterEvent(e,r.column,r)}}})])]},renderEditHeader:function(e,r){var t,l=r.$table,n=r.column,o=l.editRules,d=l.editConfig,i=n.sortable,c=n.remoteSort,a=n.filters;if(o){var s=_xeUtils.default.get(o,r.column.property);s&&(t=s.some(function(e){return e.required}))}return[t?e("i",{class:"vxe-required-icon"}):null,d&&!1===d.showIcon?null:e("i",{class:["vxe-edit-icon",d.icon||_conf.default.icon.edit]})].concat(Cell.renderHeader(e,r)).concat(i||c?Cell.renderSortIcon(e,r):[]).concat(a&&a.length?Cell.renderFilterIcon(e,r):[])},renderRowEdit:function(e,r){var t=r.$table.editStore.actived;return Cell.runRenderer(e,r,this,t&&t.row===r.row)},renderTreeRowEdit:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderRowEdit(e,r))},renderCellEdit:function(e,r){var t=r.$table.editStore.actived;return Cell.runRenderer(e,r,this,t&&t.row===r.row&&t.column===r.column)},renderTreeCellEdit:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderCellEdit(e,r))},runRenderer:function(e,r,t,l){var n=r.$table,o=r.row,d=r.column,i=d.slots,c=d.own,a=d.formatter,s=c.editRender,u=_vXETable.Renderer.get(s.name);return"visible"===s.type||l?i&&i.edit?i.edit(r,e):u&&u.renderEdit?u.renderEdit.call(n,e,s,r,{$type:"edit",$grid:n.$grid,$excel:n.$parent,$table:n,$column:d}):[]:i&&i.default?i.default(r,e):a?[_tools.UtilTools.formatText(_tools.UtilTools.getCellLabel(o,d,r),1)]:Cell.renderCell.call(t,e,r)}},_default=exports.Cell=Cell;exports.default=_default;