"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_body=_interopRequireDefault(require("../../body")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}var printFrame,rowUniqueId=0,browse=_tools.DomTools.browse,debounceScrollYDuration=browse.msie?40:20,fileForm=document.createElement("form"),fileInput=document.createElement("input");function createFrame(){var e=document.createElement("iframe");return e.className="vxe-table--print-frame",e}function getRowUniqueId(){return"xerow_".concat(++rowUniqueId)}function isTargetRadioOrCheckbox(e,t,o,i){var l=e.target;return l&&t.type===o&&"input"===l.tagName.toLowerCase()&&l.type===(i||o)}fileForm.className="vxe-table--file-form",fileInput.name="file",fileInput.type="file",fileForm.appendChild(fileInput);var Rule=function(){function t(e){_classCallCheck(this,t),Object.assign(this,{$options:e,required:e.required,min:e.min,max:e.max,type:e.type,pattern:e.pattern,validator:e.validator,trigger:e.trigger,maxWidth:e.maxWidth})}return _createClass(t,[{key:"message",get:function(){return _tools.UtilTools.getFuncText(this.$options.message)}}]),t}();function renderFixed(e,t,o){var i=t.tableData,l=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.height,c=t.parentHeight,u=t.vSize,h=t.headerHeight,d=t.footerHeight,f=t.showHeader,p=t.showFooter,g=t.tableHeight,v=t.scrollbarWidth,x=t.scrollbarHeight,m=t.scrollRightToLeft,b=t.scrollLeftToRight,w=t.columnStore,C=t.footerData,T="right"===o,R=w["".concat(o,"List")],_=0;a&&(_="auto"===a?c:_tools.DomTools.isScale(a)?Math.floor(parseInt(a)/100*c):_xeUtils.default.toNumber(a),p&&(_+=x+1));var y={height:"".concat((0<_?_-h-d:g)+h+d-x*(p?2:1),"px"),width:"".concat(R.reduce(function(e,t){return e+t.renderWidth},T?v:0),"px")};return e("div",{class:["vxe-table--fixed-".concat(o,"-wrapper"),{"scrolling--middle":T?m:b}],style:y,ref:"".concat(o,"Container")},[f?e("vxe-table-header",{props:{fixedType:o,tableData:i,tableColumn:l,visibleColumn:n,collectColumn:r,size:u,fixedColumn:R,isGroup:s},ref:"".concat(o,"Header")}):null,e("vxe-table-body",{style:{top:"".concat(h,"px")},props:{fixedType:o,tableData:i,tableColumn:l,visibleColumn:n,collectColumn:r,fixedColumn:R,size:u,isGroup:s},ref:"".concat(o,"Body")}),p?e("vxe-table-footer",{style:{top:"".concat(0<_?_-d:g+h,"px")},props:{fixedType:o,footerData:C,tableColumn:l,visibleColumn:n,size:u,fixedColumn:R},ref:"".concat(o,"Footer")}):null])}var headerProps={children:"children"},_default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:[Boolean,String],default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},footerAlign:{type:String,default:function(){return _conf.default.footerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],cellStyle:[Object,Function],headerCellStyle:[Object,Function],footerCellStyle:[Object,Function],rowStyle:[Object,Function],headerRowStyle:[Object,Function],footerRowStyle:[Object,Function],spanMethod:Function,footerSpanMethod:Function,showAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:[Boolean,String],rowId:String,zIndex:Number,keepSource:{type:Boolean,default:function(){return _conf.default.keepSource}},autoResize:Boolean,syncResize:[Boolean,String],seqConfig:Object,sortConfig:Object,filterConfig:Object,radioConfig:Object,selectConfig:Object,checkboxConfig:Object,tooltipConfig:Object,exportConfig:[Boolean,Object],importConfig:[Boolean,Object],printConfig:Object,expandConfig:Object,treeConfig:[Boolean,Object],contextMenu:[Boolean,Object],mouseConfig:Object,keyboardConfig:Object,editConfig:[Boolean,Object],validConfig:Object,editRules:Object,emptyRender:[Boolean,Object],optimization:Object,params:Object},components:{VxeTableBody:_body.default},provide:function(){return{$table:this,$xetable:this}},inject:{$grid:{default:null},$xegrid:{default:null}},data:function(){return{id:"".concat(_xeUtils.default.uniqueId()),tZindex:0,collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,scrollLeftToRight:!1,scrollRightToLeft:!1,rowHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,currentColumn:null,footerData:[],rowExpandeds:[],expandLazyLoadeds:[],treeExpandeds:[],treeLazyLoadeds:[],treeIndeterminates:[],hoverRow:null,isLoading:!1,filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],childPos:null,style:null},scrollXStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,leftSpaceWidth:0,rightSpaceWidth:0},scrollYStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,topSpaceHeight:0,bottomSpaceHeight:0,ySpaceHeight:0},tooltipStore:{visible:!1,row:null,column:null,content:""},editStore:{checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1},importStore:{file:null,type:"",filename:"",visible:!1},importParams:{mode:"",types:null,message:!0},exportStore:{name:"",mode:"",columns:[],selectRecords:[],hasFooter:!1,visible:!1,isTree:!1},exportParams:{filename:"",sheetName:"",type:"",types:[],original:!1,message:!0,isHeader:!1,isFooter:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},rowHeightMaps:function(){return Object.assign({default:48,medium:44,small:40,mini:36},this.optimizeOpts.rHeights)},seqOpts:function(){return Object.assign({startIndex:0},_conf.default.seqConfig,this.seqConfig)},radioOpts:function(){return Object.assign({},_conf.default.radioConfig,this.radioConfig)},checkboxOpts:function(){return Object.assign({},_conf.default.checkboxConfig,this.checkboxConfig||this.selectConfig)},tooltipOpts:function(){return Object.assign({size:this.vSize,leaveDelay:300},_conf.default.tooltipConfig,this.tooltipConfig)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipOpts)},editOpts:function(){return Object.assign({},_conf.default.editConfig,this.editConfig)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},filterOpts:function(){return Object.assign({},_conf.default.filterConfig,this.filterConfig)},mouseOpts:function(){return Object.assign({},_conf.default.mouseConfig,this.mouseConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _vXETable.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.contextMenu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t},exportOpts:function(){return Object.assign({},_conf.default.exportConfig,this.exportConfig)},importOpts:function(){return Object.assign({},_conf.default.importConfig,this.importConfig)},printOpts:function(){return Object.assign({},_conf.default.printConfig,this.printConfig)},expandOpts:function(){return Object.assign({},_conf.default.expandConfig,this.expandConfig)},treeOpts:function(){return Object.assign({children:"children",hasChild:"hasChild",indent:20},_conf.default.treeConfig,this.treeConfig)},emptyOpts:function(){return Object.assign({},_conf.default.emptyRender,this.emptyRender)},cellOffsetWidth:function(){return this.border?Math.max(2,Math.ceil(this.scrollbarWidth/this.tableColumn.length)):1},expandColumn:function(){return this.tableColumn.find(function(e){return"expand"===e.type})},isAllCheckboxDisabled:function(){var e=this.tableFullData,t=(this.treeConfig,this.checkboxOpts),o=t.strict,i=t.checkMethod;return!!o&&(!e.length||!!i&&e.every(function(e,t){return!i({row:e,rowIndex:t,$rowIndex:t})}))}},watch:{data:function(e){var t=this;this.loadTableData(e).then(function(){t.inited||(t.inited=!0,t.handleDefaults())})},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=this,o=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=o,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn().then(function(){t.scrollXLoad&&t.loadScrollXData(!0)}),this.handleTableData(!0),this.$toolbar&&this.$toolbar.updateColumns(o),o.length&&o.some(function(e){return e.columnKey})&&_tools.UtilTools.warn("vxe.error.delProp",["column.column-key","table.column-key"]),o.length){var i=Math.floor((o.length-1)/2);o[i].prop&&_tools.UtilTools.warn("vxe.error.delProp",["prop","field"]),o[i].label&&_tools.UtilTools.warn("vxe.error.delProp",["label","title"])}this.treeConfig&&o.some(function(e){return e.fixed})&&o.some(function(e){return"expand"===e.type})&&_tools.UtilTools.warn("vxe.error.treeFixedExpand")},tableColumn:function(){this.analyColumnWidth()},showHeader:function(){var e=this;this.$nextTick(function(){return e.recalculate(!0)})},showFooter:function(){var e=this;this.$nextTick(function(){return e.recalculate(!0)})},height:function(){var e=this;this.$nextTick(function(){return e.recalculate(!0)})},loading:function(){this.isLoading||(this.isLoading=!0)},syncResize:function(e){var t=this;e&&this.$nextTick(function(){t.$el.clientWidth&&t.$el.clientHeight&&t.recalculate(!0)})}},created:function(){var e=this,t=this.data,o=this.scrollXStore,i=this.scrollYStore,l=this.optimizeOpts,n=this.ctxMenuOpts,r=this.showOverflow,s=this.radioOpts,a=this.checkboxOpts,c=this.treeConfig,u=this.treeOpts,h=this.editConfig,d=this.editOpts,f=this.loading,p=this.showAllOverflow,g=this.showHeaderAllOverflow,v=l.scrollX,x=l.scrollY;f&&(this.isLoading=!0),x&&Object.assign(i,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(x.rSize),offsetSize:_xeUtils.default.toNumber(x.oSize)}),v&&Object.assign(o,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(v.rSize),offsetSize:_xeUtils.default.toNumber(v.oSize)}),_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("vxe.error.emptyProp",["row-id"]),this.startIndex,_xeUtils.default.isBoolean(p)&&_tools.UtilTools.warn("vxe.error.delProp",["show-all-overflow","show-overflow"]),_xeUtils.default.isBoolean(g)&&_tools.UtilTools.warn("vxe.error.delProp",["show-header-all-overflow","show-header-overflow"]),s.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["radio-config.labelProp","radio-config.labelField"]),d.showStatus&&!this.keepSource&&_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.selectConfig,!c||!u.line||this.rowKey&&r||_tools.UtilTools.warn("vxe.error.reqProp",["row-key | show-overflow"]),a.checkProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.checkProp","select-config.checkField"]),a.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.labelProp","select-config.labelField"]),this.customs,this.sortMethod,this.remoteSort,this.remoteFilter,["header","body","footer"].forEach(function(e){n[e]&&n[e].visibleMethod&&_tools.UtilTools.warn("vxe.error.delProp",["context-menu.".concat(e,".visibleMethod"),"context-menu.visibleMethod"])}),this.lastScrollLeft=0,this.lastScrollTop=0,this.afterFullData=[],this.selectReserveRowMap={},this.fullAllDataRowMap=new Map,this.fullAllDataRowIdData={},this.fullDataRowMap=new Map,this.fullDataRowIdData={},this.fullColumnMap=new Map,this.fullColumnIdData={},this.loadTableData(t).then(function(){a.key?_tools.UtilTools.warn("vxe.error.delProp",["select-config.key","row-id"]):c&&u.key?_tools.UtilTools.warn("vxe.error.delProp",["tree-config.key","row-id"]):h&&d.key&&_tools.UtilTools.warn("vxe.error.delProp",["edit-config.key","row-id"]),t&&t.length&&(e.inited=!0,e.handleDefaults())}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent),this.preventEvent(null,"created",{$table:this})},mounted:function(){var e=this;this.autoResize&&_tools.ResizeEvent.on(this,this.getParentElem(),function(){return e.recalculate(!0)}),!this.$grid&&this.customs&&_tools.UtilTools.warn("vxe.error.removeProp",["customs"]),document.body.appendChild(this.$refs.tableWrapper),this.preventEvent(null,"mounted",{$table:this})},activated:function(){this.refreshScroll(),this.preventEvent(null,"activated",{$table:this})},deactivated:function(){this.preventEvent(null,"deactivated",{$table:this})},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.getParentElem()),this.closeFilter(),this.closeMenu(),this.clearAll(),this.preventEvent(null,"beforeDestroy",{$table:this})},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize"),this.preventEvent(null,"destroyed",{$table:this})},render:function(e){var t,o=this._e,i=this.$scopedSlots,l=this.id,n=this.tableData,r=this.tableColumn,s=this.visibleColumn,a=this.collectColumn,c=this.isGroup,u=this.hasFilter,h=this.isResizable,d=this.isCtxMenu,f=this.loading,p=this.stripe,g=this.isLoading,v=this.showHeader,x=this.headerHeight,m=this.height,b=this.border,w=this.treeOpts,C=this.treeConfig,T=this.mouseConfig,R=this.mouseOpts,_=this.vSize,y=this.validOpts,S=this.editRules,E=this.showFooter,k=this.footerMethod,O=this.overflowX,D=this.overflowY,U=this.scrollXLoad,$=this.scrollYLoad,I=this.scrollbarHeight,F=this.highlightHoverRow,M=this.highlightHoverColumn,L=this.editConfig,A=this.checkboxOpts,z=this.optimizeOpts,P=this.vaildTipOpts,j=this.tooltipOpts,H=this.columnStore,B=this.filterStore,N=this.ctxMenuStore,W=this.footerData,X=this.hasTip,q=this.emptyRender,V=this.emptyOpts,Y=H.leftList,G=H.rightList,K=T&&(R.range||R.checked);if(i.empty)t=i.empty.call(this,{$table:this},e);else{var Z=q?_vXETable.default.renderer.get(V.name):null;t=Z?Z.renderEmpty(e,V,{$table:this},{$table:this}):_conf.default.i18n("vxe.table.emptyText")}return e("div",{class:["vxe-table","tid_".concat(l),_?"size--".concat(_):"",b&&_xeUtils.default.isString(b)?"b--style-".concat(b):"",{"vxe-editable":L,"show--head":v,"show--foot":E,"is--group":c,"has--height":m,"has--tree-line":C&&w.line,"fixed--left":Y.length,"fixed--right":G.length,"t--animat":z.animat,"t--stripe":p,"t--border":b,"t--selected":T&&R.selected,"t--checked":K,"row--highlight":F,"column--highlight":M,"is--empty":!f&&!n.length,"scroll--y":D,"scroll--x":O,"virtual--x":U,"virtual--y":$}]},[e("div",{class:"vxe-table-hidden-column",ref:"hideColumn"},this.$slots.default),e("div",{class:"vxe-table--main-wrapper"},[v?e("vxe-table-header",{ref:"tableHeader",props:{tableData:n,tableColumn:r,visibleColumn:s,collectColumn:a,size:_,isGroup:c}}):o(),e("vxe-table-body",{ref:"tableBody",props:{tableData:n,tableColumn:r,visibleColumn:s,collectColumn:a,size:_,isGroup:c}}),E?e("vxe-table-footer",{props:{footerData:W,footerMethod:k,tableColumn:r,visibleColumn:s,size:_},ref:"tableFooter"}):null]),Y&&Y.length&&O?renderFixed(e,this,"left"):o(),G&&G.length&&O?renderFixed(e,this,"right"):o(),e("div",{ref:"emptyPlaceholder",class:"vxe-table--empty-placeholder",style:m?null:{top:"".concat(x,"px")}},[e("div",{class:"vxe-table--empty-content"},t)]),e("div",{class:"vxe-table--border-line"}),h?e("div",{class:"vxe-table--resizable-bar",style:O?{"padding-bottom":"".concat(I,"px")}:null,ref:"resizeBar"}):o(),g?e("vxe-loading",{props:{visible:f}}):o(),u?e("vxe-table-filter",{props:{optimizeOpts:z,filterStore:B},ref:"filterWrapper"}):o(),_vXETable.default._export?e("vxe-import-panel",{props:{defaultOptions:this.importParams,storeData:this.importStore},on:{import:this.confirmImportEvent}}):o(),_vXETable.default._export?e("vxe-export-panel",{props:{defaultOptions:this.exportParams,storeData:this.exportStore},on:{print:this.confirmPrintEvent,export:this.confirmExportEvent}}):o(),e("div",{class:"vxe-table".concat(l,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[A.range?e("div",{class:"vxe-table--checkbox-range",ref:"checkboxRange"}):o(),d?e("vxe-table-context-menu",{props:{ctxMenuStore:N},ref:"ctxWrapper"}):o(),X?e("vxe-tooltip",{ref:"tooltip",props:j,on:j.enterable?{leave:this.handleTooltipLeaveEvent}:null}):o(),X&&S&&("default"===y.message?!m:"tooltip"===y.message)?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===y.message||1===n.length?P:null,ref:"validTip"}):o()])])},methods:{getParentElem:function(){return this.$grid?this.$grid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$grid?this.$grid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$grid?this.$grid.getExcludeHeight():0},clearAll:function(){return this.inited=!1,this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearCheckboxRow(),this.clearCheckboxReserve(),this.clearRowExpand(),this.clearTreeExpand(),this.clearChecked(),this.clearSelected(),this.clearActived(),this.clearScroll()},refreshData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,o=this.scrollYStore,i=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?i.slice(o.startIndex,o.startIndex+o.renderSize):i.slice(0),this.$nextTick()},loadTableData:function(e){var t=this,o=this.keepSource,i=this.height,l=this.maxHeight,n=this.showOverflow,r=this.treeConfig,s=this.editStore,a=this.optimizeOpts,c=this.scrollYStore,u=a.scrollY,h=e?e.slice(0):[],d=!r&&u&&u.gt&&u.gt<h.length;return c.startIndex=0,c.visibleIndex=0,s.insertList=[],s.removeList=[],this.tableFullData=h,this.updateCache(!0),this.tableSynchData=e,o&&(this.tableSourceData=_xeUtils.default.clone(h,!0)),(this.scrollYLoad=d)&&(i||l||_tools.UtilTools.error("vxe.error.reqProp",["height | max-height"]),n||_tools.UtilTools.warn("vxe.error.reqProp",["show-overflow"])),this.handleTableData(!0),this.updateFooter(),this.computeScrollLoad().then(function(){return t.isLoadData=!0,t.computeRowHeight(),t.handleReserveStatus(),t.checkSelectionStatus(),t.$nextTick().then(t.recalculate).then(t.refreshScroll)})},loadData:function(e){return this.inited=!0,this.loadTableData(e)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.inited=!0,t.loadTableData(e)}).then(this.handleDefaults)},reloadRow:function(e,t,o){var i=this.keepSource,l=this.tableSourceData,n=this.tableData;if(i){var r=this.getRowIndex(e),s=l[r];s&&e&&(o?_xeUtils.default.set(s,o,_xeUtils.default.get(t||e,o)):t?(l[r]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(s,_xeUtils.default.clone(e,!0))),this.tableData=n.slice(0)}else _tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]);return this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(l){var n=this,e=this.treeConfig,r=this.treeOpts,t=this.tableFullData,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,u=this.fullAllDataRowIdData,h=_tools.UtilTools.getRowkey(this),d=e&&r.lazy,o=function(e,t){var o=_tools.UtilTools.getRowid(n,e);o||(o=getRowUniqueId(),_xeUtils.default.set(e,h,o)),d&&e[r.hasChild]&&_xeUtils.default.isUndefined(e[r.children])&&(e[r.children]=null);var i={row:e,rowid:o,index:t};l&&(s[o]=i,a.set(e,i)),u[o]=i,c.set(e,i)};l&&(s=this.fullDataRowIdData={},a.clear()),u=this.fullAllDataRowIdData={},c.clear(),e?_xeUtils.default.eachTree(t,o,r):t.forEach(o)},appendTreeCache:function(e,t){var o,l=this,i=this.keepSource,n=this.tableSourceData,r=this.treeOpts,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,u=this.fullAllDataRowIdData,h=r.children,d=r.hasChild,f=_tools.UtilTools.getRowkey(this),p=_tools.UtilTools.getRowid(this,e);i&&(o=_xeUtils.default.findTree(n,function(e){return p===_tools.UtilTools.getRowid(l,e)},r)),_xeUtils.default.eachTree(t,function(e,t){var o=_tools.UtilTools.getRowid(l,e);o||(o=getRowUniqueId(),_xeUtils.default.set(e,f,o)),e[d]&&_xeUtils.default.isUndefined(e[h])&&(e[h]=null);var i={row:e,rowid:o,index:t};s[o]=i,a.set(e,i),u[o]=i,c.set(e,i)},r),o&&(o.item[h]=_xeUtils.default.clone(t,!0))},cacheColumnMap:function(){var e=this.isGroup,t=this.tableFullColumn,o=this.collectColumn,i=this.fullColumnMap,l=this.fullColumnIdData={};i.clear(),e&&_xeUtils.default.eachTree(o,function(e,t){if(e.children&&e.children.length){var o={column:e,colid:e.id,index:t};l[e.id]=o,i.set(e,o)}},headerProps),t.forEach(function(e,t){var o={column:e,colid:e.id,index:t};l[e.id]=o,i.set(e,o)},headerProps)},getRowNode:function(e){var t=this;if(e){var o=this.treeConfig,i=this.treeOpts,l=this.tableFullData,n=this.fullAllDataRowIdData,r=e.getAttribute("data-rowid");if(o){var s=_xeUtils.default.findTree(l,function(e){return _tools.UtilTools.getRowid(t,e)===r},i);if(s)return s}else if(n[r]){var a=n[r];return{item:a.row,index:a.index,items:l}}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData,o=this.tableFullColumn,i=t[e.getAttribute("data-colid")];return{item:i.column,index:i.index,items:o}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},$getRowIndex:function(e){return this.afterFullData.indexOf(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},$getColumnIndex:function(e){return this.visibleColumn.indexOf(e)},isSeqColumn:function(e){return e&&("seq"===e.type||"index"===e.type)},insert:function(e){return this.insertAt(e)},insertAt:function(e,t){var o=this,i=this.afterFullData,l=this.editStore,n=this.scrollYLoad,r=this.tableFullData;if(this.treeConfig)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["insert"]));_xeUtils.default.isArray(e)||(e=[e]);var s=i,a=e.map(function(e){return o.defineField(Object.assign({},e))});if(t)if(-1===t)s.push.apply(s,a),r.push.apply(r,a);else{var c=s.indexOf(t);if(-1===c)throw new Error(_tools.UtilTools.error("vxe.error.unableInsert"));s.splice.apply(s,[c,0].concat(a)),r.splice.apply(r,[r.indexOf(t),0].concat(a))}else s.unshift.apply(s,a),r.unshift.apply(r,a);return[].unshift.apply(l.insertList,a),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),n&&this.updateScrollYSpace(),this.$nextTick().then(function(){return o.recalculate(),{row:a.length?a[a.length-1]:null,rows:a}})},defineField:function(i){var e=this.treeConfig,t=this.treeOpts,o=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,o=e.editRender;t&&!_xeUtils.default.has(i,t)&&_xeUtils.default.set(i,t,o&&!_xeUtils.default.isUndefined(o.defaultValue)?o.defaultValue:null)}),e&&t.lazy&&_xeUtils.default.isUndefined(i[t.children])&&(i[t.children]=null),_xeUtils.default.get(i,o)||_xeUtils.default.set(i,o,getRowUniqueId()),i},createData:function(e){var t=this;return this.$nextTick().then(function(){return e.map(t.defineField)})},createRow:function(t){var o=this,i=_xeUtils.default.isArray(t);return i||(t=[t]),this.$nextTick().then(function(){var e=t.map(function(e){return o.defineField(Object.assign({},e))});return i?e:e[0]})},remove:function(t){var e=this,o=this.afterFullData,i=this.tableFullData,l=this.editStore,n=this.treeConfig,r=this.checkboxOpts,s=this.selection,a=this.hasInsertByRow,c=this.scrollYLoad,u=l.removeList,h=l.insertList,d=r.checkField||r.checkProp,f=[],p=o;if(n)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["remove"]));return t?_xeUtils.default.isArray(t)||(t=[t]):t=i,t.forEach(function(e){a(e)||u.push(e)}),d||_xeUtils.default.remove(s,function(e){return-1<t.indexOf(e)}),i===t?(t=f=i.slice(0),i.length=0,p.length=0):(f=_xeUtils.default.remove(i,function(e){return-1<t.indexOf(e)}),_xeUtils.default.remove(p,function(e){return-1<t.indexOf(e)})),_xeUtils.default.remove(h,function(e){return-1<t.indexOf(e)}),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),c&&this.updateScrollYSpace(),this.$nextTick().then(function(){return e.recalculate(),{row:f&&f.length?f[f.length-1]:null,rows:f}})},removeSelecteds:function(){var t=this;return this.remove(this.getCheckboxRecords()).then(function(e){return t.clearCheckboxRow(),e})},revert:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["revert","revertData"]),this.revertData.apply(this,arguments)},revertData:function(e,i){var t=this.keepSource,l=this.tableSourceData,n=this.tableFullData;return t?arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=n.indexOf(e),o=l[t];o&&e&&(i?_xeUtils.default.set(e,i,_xeUtils.default.clone(_xeUtils.default.get(o,i),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(o,!0)))}),this.$nextTick()):this.reloadData(l):this.$nextTick()},clearData:function(e,t){var o=this.tableFullData,i=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=o,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){i.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var o=this,i=this.visibleColumn,l=this.keepSource,n=this.treeConfig,r=this.treeOpts,s=this.tableSourceData,a=this.fullDataRowIdData;if(l){var c,u,h=_tools.UtilTools.getRowid(this,e);if(!a[h])return!1;if(n){var d=r.children,f=_xeUtils.default.findTree(s,function(e){return h===_tools.UtilTools.getRowid(o,e)},r);e=Object.assign({},e,_defineProperty({},d,null)),f&&(c=Object.assign({},f.item,_defineProperty({},d,null)))}else{c=s[a[h].index]}if(c){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(c,t),_xeUtils.default.get(e,t));for(var p=0,g=i.length;p<g;p++)if((u=i[p].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(c,u),_xeUtils.default.get(e,u)))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColid:function(e){var t=this.fullColumnMap;return t.has(e)?t.get(e).colid:null},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(t){return _xeUtils.default.find(this.tableFullColumn,function(e){return e.property===t})},getTableColumn:function(){return{fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getRecordset:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){var t=this.editStore.insertList,o=[];return t.length&&this.tableFullData.forEach(function(e){-1<t.indexOf(e)&&o.push(e)}),o},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){return this.getCheckboxRecords()},getCheckboxRecords:function(){var e=this.tableFullData,t=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts.checkField,l=[];if(i)l=t?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,i)},o):e.filter(function(e){return _xeUtils.default.get(e,i)});else{var n=this.selection;l=t?_xeUtils.default.filterTree(e,function(e){return-1<n.indexOf(e)},o):e.filter(function(e){return-1<n.indexOf(e)})}return l},getUpdateRecords:function(){var e=this.tableFullData,t=this.isUpdateByRow,o=this.treeConfig,i=this.treeOpts;return o?_xeUtils.default.filterTree(e,function(e){return t(e)},i):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,o=this.remoteSort,c=this.remoteFilter,u=this.filterOpts,i=this.sortOpts,l=t.slice(0),n=_xeUtils.default.find(e,function(e){return e.order}),r=[];if(e.forEach(function(e){if(e.filters&&e.filters.length){var t=[],o=[];e.filters.forEach(function(e){e.checked&&(o.push(e),t.push(e.value))}),r.push({column:e,valueList:t,itemList:o})}}),r.length&&(l=l.filter(function(a){return r.every(function(e){var t=e.column,o=e.valueList,i=e.itemList;if(!o.length||u.remote||c)return!0;var l=t.filterRender,n=t.property,r=t.filterMethod,s=l?_vXETable.default.renderer.get(l.name):null;return!r&&s&&s.renderFilter&&(r=s.filterMethod),r?i.some(function(e){return r({value:e.value,option:e,row:a,column:t})}):-1<o.indexOf(_xeUtils.default.get(a,n))})})),n&&n.order){var s=i.sortMethod||this.sortMethod;if(!(_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:i.remote||o))if(s)l=s({data:l,column:n,property:n.property,order:n.order,$table:this})||l;else{var a=n.sortMethod?l.sort(n.sortMethod):_xeUtils.default.sortBy(l,n.property);l="desc"===n.order?a.reverse():a}}return this.afterFullData=l},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,o=this.tableData,i=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:o.slice(0),footerData:i.slice(0)}},handleDefaults:function(){(this.checkboxConfig||this.selectConfig)&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(o){this.isUpdateCustoms=!0,this.tableFullColumn.forEach(function(t){var e=_xeUtils.default.find(o,function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.$emit("update:customs",this.tableFullColumn)},resetAll:function(){this.resetColumn(!0)},hideColumn:function(e){return this.handleVisibleColumn(e,!1)},showColumn:function(e){return this.handleVisibleColumn(e,!0)},resetColumn:function(e){var t=Object.assign({visible:!0},e);return(!0===e||t.resizable)&&this.handleResetResizable(),t.visible?this.handleVisibleColumn():this.$nextTick()},resetCustoms:function(){return this.resetColumn()},handleVisibleColumn:function(e,t){return arguments.length?e.visible=t:this.tableFullColumn.forEach(function(e){e.visible=!0}),this.$toolbar&&this.$toolbar.handleCustoms(),this.$nextTick()},handleResetResizable:function(){return this.tableFullColumn.forEach(function(e){e.resizeWidth=0}),this.$toolbar&&this.$toolbar.resetResizable(),this.analyColumnWidth(),this.recalculate(!0)},resetResizable:function(){return this.handleResetResizable()},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var o,e=this,i=0,l=[],n=null,r=null,s=[],a=[],t=this.collectColumn,c=this.tableFullColumn,u=this.isGroup,h=this.columnStore,d=this.scrollXStore,f=this.optimizeOpts.scrollX;u&&_xeUtils.default.eachTree(t,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),c.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(null===n&&(n=i),o||(t-i!=0?o=!0:i++),l.push(e)):"right"===e.fixed?(o||(null===r&&(r=t),t-r!=0?o=!0:r++),a.push(e)):s.push(e)});var p=l.concat(s).concat(a),g=f&&f.gt&&f.gt<c.length;return Object.assign(h,{leftList:l,centerList:s,rightList:a}),u&&(o||n||null!==r&&r!==p.length)&&_tools.UtilTools.error("vxe.error.groupFixed"),g&&(this.isGroup&&_tools.UtilTools.warn("vxe.error.scrollXNotGroup"),this.showHeader&&!this.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-header-overflow"]),d.startIndex=0,d.visibleIndex=0,p=p.slice(d.startIndex,d.startIndex+d.renderSize)),this.scrollXLoad=g,this.tableColumn=p,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,o=this.columnMinWidth,i=[],l=[],n=[],r=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),o&&!e.minWidth&&(e.minWidth=o),e.visible&&(e.resizeWidth?i.push(e):_tools.DomTools.isPx(e.width||t)?l.push(e):_tools.DomTools.isScale(e.width||t)?r.push(e):_tools.DomTools.isPx(e.minWidth||o)?n.push(e):_tools.DomTools.isScale(e.minWidth||o)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:i,pxList:l,pxMinList:n,scaleList:r,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,o=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||o)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,o)})},recalculate:function(e){var t=this,o=this.$refs,i=o.tableBody,l=o.tableHeader,n=o.tableFooter,r=i?i.$el:null,s=l?l.$el:null,a=n?n.$el:null;if(r){var c=r.clientWidth;if(this.autoCellWidth(s,r,a,c),!0===e)return this.computeScrollLoad().then(function(){c=r.clientWidth,t.autoCellWidth(s,r,a,c),t.computeScrollLoad()})}return this.computeScrollLoad()},autoCellWidth:function(e,t,o,i){var l,n=0,r=i,s=this.fit,a=this.columnStore,c=a.resizeList,u=a.pxMinList,h=a.pxList,d=a.scaleList,f=a.scaleMinList,p=a.autoList;if(u.forEach(function(e){var t=parseInt(e.minWidth);n+=t,e.renderWidth=t}),l=r/100,f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*l);n+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*l);n+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);n+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);n+=t,e.renderWidth=t}),l=0<(r-=n)?Math.floor(r/(f.length+u.length+p.length)):0,s?0<r&&f.concat(u).forEach(function(e){n+=l,e.renderWidth+=l}):l=40,p.forEach(function(e,t){var o=Math.max(l,40);e.renderWidth=o,n+=o}),s){var g=d.concat(f).concat(u).concat(p),v=g.length-1;if(0<v){var x=i-n;if(0<x){for(;0<x&&0<=v;)x--,g[v--].renderWidth++;n=i}}}var m=t.offsetHeight,b=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=b?t.offsetWidth-i:0,this.overflowY=b,this.tableWidth=n,this.tableHeight=m,this.parentHeight=this.getParentHeight(),this.headerHeight=e?e.clientHeight:0,o){var w=o.offsetHeight;this.scrollbarHeight=Math.max(w-o.clientHeight,0),this.overflowX=n>o.clientWidth,this.footerHeight=w}else this.footerHeight=0,this.scrollbarHeight=Math.max(m-t.clientHeight,0),this.overflowX=i<n;return this.overflowX&&this.checkScrolling(),n},checkScrolling:function(){var e=this.$refs,t=e.tableBody,o=e.leftBody,i=e.rightBody,l=t?t.$el:null;l&&(o&&(this.scrollLeftToRight=0<l.scrollLeft),i&&(this.scrollRightToLeft=l.clientWidth<l.scrollWidth-Math.ceil(l.scrollLeft)))},preventEvent:function(t,e,o,i,l){var n,r=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(o,t,r)})||i&&(n=i()),l&&l(),n},handleGlobalMousedownEvent:function(o){var i=this,l=this.$el,e=this.$refs,t=this.mouseConfig,n=this.mouseOpts,r=this.editStore,s=this.ctxMenuStore,a=this.editOpts,c=this.filterStore,u=this.getRowNode,h=r.actived,d=e.filterWrapper,f=e.validTip,p=t&&(n.range||n.checked);d&&(_tools.DomTools.getEventTargetNode(o,this.$el,"vxe-filter-wrapper").flag||_tools.DomTools.getEventTargetNode(o,d.$el).flag||this.preventEvent(o,"event.clearFilter",c.args,this.closeFilter)),h.row?!1!==a.autoClear&&(f&&_tools.DomTools.getEventTargetNode(o,f.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(o,"event.clearActived",h.args,function(){var e;if("row"===a.mode){var t=_tools.DomTools.getEventTargetNode(o,l,"vxe-body--row");e=!!t.flag&&u(t.targetElem).item!==u(h.args.cell.parentNode).item}else e=!_tools.DomTools.getEventTargetNode(o,l,"col--edit").flag;e||(e=_tools.DomTools.getEventTargetNode(o,l,"vxe-header--row").flag),e||(e=_tools.DomTools.getEventTargetNode(o,l,"vxe-footer--row").flag),!e&&_tools.DomTools.getEventTargetNode(o,i.$el).flag||setTimeout(function(){return i.clearActived(o)})})):t&&(_tools.DomTools.getEventTargetNode(o,l).flag||_tools.DomTools.getEventTargetNode(o,e.tableWrapper).flag||(p&&this.clearChecked(),this.clearSelected())),s.visible&&this.$refs.ctxWrapper&&!_tools.DomTools.getEventTargetNode(o,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=_tools.DomTools.getEventTargetNode(o,(this.$grid||this).$el).flag},handleGlobalBlurEvent:function(e){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(e){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(L){var A=this;this.isActivated&&this.preventEvent(L,"event.keydown",{$table:this},function(){var e,t=A.isCtxMenu,o=A.ctxMenuStore,i=A.editStore,l=A.mouseConfig,n=void 0===l?{}:l,r=A.keyboardConfig,s=void 0===r?{}:r,a=A.treeConfig,c=A.treeOpts,u=A.highlightCurrentRow,h=A.currentRow,d=i.selected,f=i.actived,p=L.keyCode,g=8===p,v=9===p,x=13===p,m=27===p,b=32===p,w=37===p,C=38===p,T=39===p,R=40===p,_=46===p,y=67===p,S=86===p,E=88===p,k=113===p,O=L.ctrlKey,D=L.shiftKey,U=w||C||T||R,$=t&&o.visible&&(x||b||U);if(m)A.closeMenu(),A.closeFilter(),f.row&&(e=f.args,A.clearActived(L),n.selected&&A.handleSelected(e,L));else if(b&&(s.isArrow||s.isTab)&&d.row&&d.column&&("checkbox"===d.column.type||"selection"===d.column.type||"radio"===d.column.type))L.preventDefault(),"checkbox"===d.column.type||"selection"===d.column.type?A.handleToggleCheckRowEvent(d.args,L):A.triggerRadioRowEvent(L,d.args);else if(x&&s.isEnter&&(d.row||f.row||a&&u&&h)){if(d.row||f.row)A.moveSelected(d.row?d.args:f.args,w,C,T,!0,L);else if(a&&u&&h){var I=h[c.children];if(I&&I.length){L.preventDefault();var F=I[0];e={$table:A,row:F},A.setTreeExpansion(h,!0).then(function(){return A.scrollToRow(F)}).then(function(){return A.triggerCurrentRowEvent(L,e)})}}}else if($)L.preventDefault(),o.showChild&&_tools.UtilTools.hasChildrenList(o.selected)?A.moveCtxMenu(L,p,o,"selectChild",37,!1,o.selected.children):A.moveCtxMenu(L,p,o,"selected",39,!0,A.ctxMenuList);else if(k)d.row&&d.column&&(L.preventDefault(),A.handleActived(d.args,L));else if(U&&s.isArrow)d.row&&d.column?A.moveSelected(d.args,w,C,T,R,L):(C||R)&&u&&h&&A.moveCurrentRow(C,R,L);else if(v&&s.isTab)d.row||d.column?A.moveTabSelected(d.args,D,L):(f.row||f.column)&&A.moveTabSelected(f.args,D,L);else if(_||(a&&u&&h?g&&s.isArrow:g)){if(s.isDel&&(d.row||d.column))_tools.UtilTools.setCellValue(d.row,d.column,null),g&&A.handleActived(d.args,L);else if(g&&s.isArrow&&a&&u&&h){var M=_xeUtils.default.findTree(A.afterFullData,function(e){return e===h},c).parent;M&&(L.preventDefault(),e={$table:A,row:M},A.setTreeExpansion(M,!1).then(function(){return A.scrollToRow(M)}).then(function(){return A.triggerCurrentRowEvent(L,e)}))}}else s.isCut&&O&&(E||y||S)?E||y?A.handleCopyed(E,L):A.handlePaste(L):s.isEdit&&!O&&(48<=p&&p<=57||65<=p&&p<=90||96<=p&&p<=111||186<=p&&p<=192||219<=p&&p<=222||32===p)&&(d.row||d.column)&&(s.editMethod&&!1===s.editMethod(d.args,L)||(_tools.UtilTools.setCellValue(d.row,d.column,null),A.handleActived(d.args,L)))})},moveTabSelected:function(e,t,o){var i,l,n,r,s=this.afterFullData,a=this.visibleColumn,c=this.editConfig,u=this.editOpts,h=this.isSeqColumn,d=Object.assign({},e),f=s.indexOf(d.row),p=a.indexOf(d.column);if(o.preventDefault(),t){for(var g=p-1;0<=g;g--)if(!h(a[g])){n=a[r=g];break}if(!n&&0<f){i=s[l=f-1];for(var v=a.length-1;0<=v;v--)if(!h(a[v])){n=a[r=v];break}}}else{for(var x=p+1;x<a.length;x++)if(!h(a[x])){n=a[r=x];break}if(!n&&f<s.length-1){i=s[l=f+1];for(var m=0;m<a.length;m++)if(!h(a[m])){n=a[r=m];break}}}n&&(i?(d.rowIndex=l,d.row=i):d.rowIndex=f,d.columnIndex=r,d.column=n,d.cell=_tools.DomTools.getCell(this,d),c&&("click"!==u.trigger&&"dblclick"!==u.trigger||("row"===u.mode?this.handleActived(d,o):(this.handleSelected(d,o),this.scrollToRow(d.row,d.column)))))},moveCurrentRow:function(e,t,o){var i,l=this,n=this.currentRow,r=this.treeConfig,s=this.treeOpts,a=this.afterFullData;if(o.preventDefault(),r){var c=_xeUtils.default.findTree(a,function(e){return e===n},s),u=c.index,h=c.items;e&&0<u?i=h[u-1]:t&&u<h.length-1&&(i=h[u+1])}else{var d=a.indexOf(n);e&&0<d?i=a[d-1]:t&&d<a.length-1&&(i=a[d+1])}if(i){var f={$table:this,row:i};this.scrollToRow(i).then(function(){return l.triggerCurrentRowEvent(o,f)})}},moveSelected:function(e,t,o,i,l,n){var r=this.afterFullData,s=this.visibleColumn,a=Object.assign({},e);if(n.preventDefault(),o&&a.rowIndex)a.rowIndex-=1,a.row=r[a.rowIndex];else if(l&&a.rowIndex<r.length-1)a.rowIndex+=1,a.row=r[a.rowIndex];else if(t&&a.columnIndex){for(var c=a.columnIndex-1;0<=c;c--)if(s[c].editRender){a.columnIndex=c,a.column=s[c];break}}else if(i&&a.columnIndex)for(var u=a.columnIndex+1;u<s.length;u++)if(s[u].editRender){a.columnIndex=u,a.column=s[u];break}a.cell=_tools.DomTools.getCell(this,a),this.handleSelected(a,n),this.scrollToRow(a.row,a.column)},moveCtxMenu:function(e,t,o,i,l,n,r){var s,a=_xeUtils.default.findIndexOf(r,function(e){return o[i]===e});if(t===l)n&&_tools.UtilTools.hasChildrenList(o.selected)?o.showChild=!0:(o.showChild=!1,o.selectChild=null);else if(38===t){for(var c=a-1;0<=c;c--)if(!1!==r[c].visible){s=r[c];break}o[i]=s||r[r.length-1]}else if(40===t){for(var u=a+1;u<r.length;u++)if(!1!==r[u].visible){s=r[u];break}o[i]=s||r[0]}else!o[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,o[i])},handleGlobalResizeEvent:function(){this.closeMenu(),this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.$refs,o=this.id,i=this.contextMenu,l=this.isCtxMenu,n=this.ctxMenuStore,r=this.ctxMenuOpts,s=["header","body","footer"];if(i&&l){if(n.visible&&n.visible&&t.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,t.ctxWrapper.$el).flag)return void e.preventDefault();for(var a=0;a<s.length;a++){var c=s[a],u=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(c,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===o}),h={type:c,$table:this,columns:this.visibleColumn.slice(0)};if(u.flag){var d=u.targetElem,f=this.getColumnNode(d).item,p="".concat(c,"-");if(Object.assign(h,{column:f,columnIndex:this.getColumnIndex(f),cell:d}),"body"===c){var g=this.getRowNode(d.parentNode).item;p="",h.row=g,h.rowIndex=this.getRowIndex(g)}return this.openContextMenu(e,c,h),void _tools.UtilTools.emitEvent(this,"".concat(p,"cell-context-menu"),[h,e])}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(c,"-wrapper"),function(e){return e.getAttribute("data-tid")===o}).flag)return void("cell"===r.trigger?e.preventDefault():this.openContextMenu(e,c,h))}}t.filterWrapper&&!_tools.DomTools.getEventTargetNode(e,t.filterWrapper.$el).flag&&this.closeFilter(),this.closeMenu()},openContextMenu:function(h,e,t){var d=this,f=this.ctxMenuStore,o=this.ctxMenuOpts,i=o[e],l=o.visibleMethod;if(i){var p=i.options;i.disabled?h.preventDefault():p&&p.length&&(t.options=p,this.preventEvent(h,"event.showMenu",t,null,function(){if(!l||l(t,h)){h.preventDefault(),d.updateZindex();var e=_tools.DomTools.getDomNode(),n=e.scrollTop,r=e.scrollLeft,s=e.visibleHeight,a=e.visibleWidth,c=h.clientY+n,u=h.clientX+r;Object.assign(f,{args:t,visible:!0,list:p,selected:null,selectChild:null,showChild:!1,childPos:null,style:{zIndex:d.tZindex,top:"".concat(c,"px"),left:"".concat(u,"px")}}),d.$nextTick(function(){var e=d.$refs.ctxWrapper.$el,t=e.clientHeight,o=e.clientWidth,i=h.clientY+t-s,l=h.clientX+o-a;-10<i&&(f.style.top="".concat(Math.max(n+2,c-t-2),"px")),-10<l&&(f.style.left="".concat(Math.max(r+2,u-o-2),"px")),-220<l&&(f.childPos="left")})}else d.closeMenu()}))}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,childPos:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,o){var i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=o)||(i.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t,o){var i=this.ctxMenuStore;t.children||(i.selected=null),i.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var o=_vXETable.default.menus.get(t.code),i=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);o&&o.call(this,i,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t,$table:this},this.ctxMenuStore.args),e]),this.closeMenu()}},handleTooltipLeaveEvent:function(e){var t=this,o=this.tooltipOpts;setTimeout(function(){t.tooltipActive||t.clostTooltip()},o.leaveDelay)},handleTargetEnterEvent:function(e){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(e){var t=this,o=this.tooltipOpts;this.tooltipActive=!1,o.enterable?this.tooltipTimeout=setTimeout(function(){t.$refs.tooltip.isHover||t.clostTooltip()},o.leaveDelay):this.clostTooltip()},triggerHeaderTooltipEvent:function(e,t){var o=this.tooltipStore,i=t.column;this.handleTargetEnterEvent(),o.column===i&&o.visible||this.handleTooltip(e,i)},triggerFooterTooltipEvent:function(e,t){var o=t.column,i=this.tooltipStore;this.handleTargetEnterEvent(),i.column===o&&i.visible||this.handleTooltip(e,o)},triggerTooltipEvent:function(e,t){var o=this.editConfig,i=this.editOpts,l=this.editStore,n=this.tooltipStore,r=l.actived,s=t.row,a=t.column;this.handleTargetEnterEvent(),o&&("row"===i.mode&&r.row===s||r.row===s&&r.column===a)||n.column===a&&n.row===s&&n.visible||this.handleTooltip(e,a,s)},handleTooltip:function(e,t,o){var i=e.currentTarget,l=this.$refs.tooltip,n=i.children[0],r=i.innerText;return r&&n.scrollWidth>n.clientWidth&&(Object.assign(this.tooltipStore,{row:o,column:t,visible:!0}),l&&l.toVisible(i,r)),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleDefaultSelectionChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxOpts,o=e.checkAll,i=e.checkRowKeys;if(o)this.setAllCheckboxRow(!0);else if(i){var l=[];i.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setCheckboxRow(l,!0)}},setSelection:function(e,t){return this.setCheckboxRow(e,t)},setCheckboxRow:function(e,t){var o=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return o.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["isCheckedByRow","isCheckedByCheckboxRow"]),this.isCheckedByCheckboxRow(e)},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,o){var i=this,l=e.row,n=this.selection,t=this.tableFullData,r=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,c=this.checkboxOpts,u=c.checkStrictly,h=c.checkMethod,d=c.checkField||c.checkProp;if(d)if(r&&!u){-1===o?(a.push(l),_xeUtils.default.set(l,d,!1)):(_xeUtils.default.eachTree([l],function(e,t){l!==e&&h&&!h({row:e,$rowIndex:t})||(_xeUtils.default.set(e,d,o),i.handleSelectReserveRow(l,o))},s),_xeUtils.default.remove(a,function(e){return e===l}));var f=_xeUtils.default.findTree(t,function(e){return e===l},s);if(f&&f.parent){var p,g=h?f.items.filter(function(e,t){return h({row:e,$rowIndex:t})}):f.items;if(_xeUtils.default.find(f.items,function(e){return-1<a.indexOf(e)}))p=-1;else{var v=f.items.filter(function(e){return _xeUtils.default.get(e,d)});p=v.filter(function(e){return-1<g.indexOf(e)}).length===g.length||!(!v.length&&-1!==o)&&-1}return this.handleSelectRow({row:f.parent},p)}}else _xeUtils.default.set(l,d,o),this.handleSelectReserveRow(l,o);else if(r&&!u){-1===o?(a.push(l),_xeUtils.default.remove(n,function(e){return e===l})):(_xeUtils.default.eachTree([l],function(t,e){l!==t&&h&&!h({row:t,$rowIndex:e})||(o?n.push(t):_xeUtils.default.remove(n,function(e){return e===t}),i.handleSelectReserveRow(l,o))},s),_xeUtils.default.remove(a,function(e){return e===l}));var x=_xeUtils.default.findTree(t,function(e){return e===l},s);if(x&&x.parent){var m,b=h?x.items.filter(function(e,t){return h({row:e,$rowIndex:t})}):x.items;if(_xeUtils.default.find(x.items,function(e){return-1<a.indexOf(e)}))m=-1;else{var w=x.items.filter(function(e){return-1<n.indexOf(e)});m=w.filter(function(e){return-1<b.indexOf(e)}).length===b.length||!(!w.length&&-1!==o)&&-1}return this.handleSelectRow({row:x.parent},m)}}else o?-1===n.indexOf(l)&&n.push(l):_xeUtils.default.remove(n,function(e){return e===l}),this.handleSelectReserveRow(l,o);this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var o=this.selection,i=this.checkboxOpts.checkField,l=e.row,n=i?!_xeUtils.default.get(l,i):-1===o.indexOf(l);t?this.triggerCheckRowEvent(t,e,n):this.handleSelectRow(e,n)},triggerCheckRowEvent:function(e,t,o){var i=this.checkboxOpts.checkMethod;i&&!i({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})||(this.handleSelectRow(t,o),this.$listeners["select-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["select-change","checkbox-change"]),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),checked:o,$table:this},t),e])):_tools.UtilTools.emitEvent(this,"checkbox-change",[Object.assign({selection:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),checked:o,$table:this},t),e]))},toggleRowSelection:function(e){return this.toggleCheckboxRow(e)},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(e){return this.setAllCheckboxRow(e)},setAllCheckboxRow:function(i){var o=this,t=this.afterFullData,e=this.treeConfig,l=this.treeOpts,n=this.selection,r=this.selectReserveRowMap,s=this.checkboxOpts,a=s.reserve,c=s.checkStrictly,u=s.checkMethod,h=s.checkField||s.checkProp,d=[],f=e?[]:n.filter(function(e){return-1===t.indexOf(e)});if(!c){if(h){var p="".concat(e?"$":"","rowIndex"),g=function(e,t){var o;u&&!u((_defineProperty(o={row:e},p,t),_defineProperty(o,"$rowIndex",t),o))||_xeUtils.default.set(e,h,i)},v=function(e,t){var o;(!u||!u((_defineProperty(o={row:e},p,t),_defineProperty(o,"$rowIndex",t),o))&&-1<n.indexOf(e))&&_xeUtils.default.set(e,h,i)};e?_xeUtils.default.eachTree(t,i?g:v,l):t.forEach(i?g:v)}else e?i?_xeUtils.default.eachTree(t,function(e,t){u&&!u({row:e,$rowIndex:t})||d.push(e)},l):u&&_xeUtils.default.eachTree(t,function(e,t){!u({row:e,$rowIndex:t})&&-1<n.indexOf(e)&&d.push(e)},l):i?d=u?t.filter(function(e,t){return-1<n.indexOf(e)||u({row:e,rowIndex:t,$rowIndex:t})}):t.slice(0):u&&(d=t.filter(function(e,t){return u({row:e,rowIndex:t,$rowIndex:t})?0:-1<n.indexOf(e)}));a&&(i?d.forEach(function(e){r[_tools.UtilTools.getRowid(o,e)]=e}):t.forEach(function(e){var t=_tools.UtilTools.getRowid(o,e);r[t]&&delete r[t]})),this.selection=f.concat(d)}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,o=this.selection,t=this.treeIndeterminates,i=this.checkboxOpts,l=i.checkStrictly,n=i.checkMethod,r=i.checkField||i.checkProp;l||(r?(this.isAllSelected=e.length&&e.every(n?function(e,t){return!n({row:e,rowIndex:t,$rowIndex:t})||_xeUtils.default.get(e,r)}:function(e){return _xeUtils.default.get(e,r)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,r)||-1<t.indexOf(e)})):(this.isAllSelected=e.length&&e.every(n?function(e,t){return!n({row:e,rowIndex:t,$rowIndex:t})||-1<o.indexOf(e)}:function(e){return-1<o.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<t.indexOf(e)||-1<o.indexOf(e)})))},handleReserveStatus:function(){var e=this.rowId,t=this.treeConfig,o=this.fullDataRowIdData,i=this.selectReserveRowMap,l=this.checkboxOpts,n=[],r=[],s=[],a=[];e&&this.handleReserveByRowid(this.selection,n),l.reserve&&Object.keys(i).forEach(function(e){o[e]&&-1===n.indexOf(o[e].row)&&n.push(o[e].row)}),this.selection=n,e&&this.handleReserveByRowid(this.rowExpandeds,r),this.rowExpandeds=r,e&&t&&(this.handleReserveByRowid(this.treeIndeterminates,a),this.handleReserveByRowid(this.treeExpandeds,s)),this.treeExpandeds=s,this.treeIndeterminates=a},handleReserveByRowid:function(e,o){var i=this,l=this.fullDataRowIdData;e.forEach(function(e){var t=_tools.UtilTools.getRowid(i,e);l[t]&&o.push(l[t].row)})},getSelectReserveRecords:function(){return this.getCheckboxReserveRecords()},getCheckboxReserveRecords:function(){var t=this.fullDataRowIdData,o=this.selectReserveRowMap,e=this.checkboxOpts,i=[];return e.reserve&&Object.keys(o).forEach(function(e){t[e]||i.push(o[e])}),i},clearSelectReserve:function(){return this.clearCheckboxReserve()},clearCheckboxReserve:function(){return this.selectReserveRowMap={},this.$nextTick()},handleSelectReserveRow:function(e,t){var o=this.selectReserveRowMap;if(this.checkboxOpts.reserve){var i=_tools.UtilTools.getRowid(this,e);t?o[i]=e:o[i]&&delete o[i]}},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t),this.$listeners["select-all"]?(_tools.UtilTools.warn("vxe.error.delEvent",["select-all","checkbox-all"]),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),checked:t,$table:this},e])):_tools.UtilTools.emitEvent(this,"checkbox-all",[{selection:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),checked:t,$table:this},e])},toggleAllSelection:function(){return this.toggleAllCheckboxRow()},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){return this.clearCheckboxRow()},clearCheckboxRow:function(){var e=this.tableFullData,t=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts,l=i.checkField||i.checkProp;return l&&(t?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,l,!1)},o):e.forEach(function(e){return _xeUtils.default.set(e,l,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,o=e.checkRowKey;o&&t[o]&&this.setRadioRow(t[o].row)},triggerRadioRowEvent:function(e,t){var o=this.radioOpts.checkMethod;if(!o||o({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})){var i=this.selectRow!==t.row;this.setRadioRow(t.row),i&&_tools.UtilTools.emitEvent(this,"radio-change",[t,e])}},triggerCurrentRowEvent:function(e,t){var o=this.currentRow!==t.row;this.setCurrentRow(t.row),o&&_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){return this.highlightCurrentRow&&(this.clearCurrentColumn(),this.currentRow=e),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){return this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.getCurrentRecord()},getCurrentRecord:function(){return this.currentRow},getRadioRow:function(){return this.getRadioRecord()},getRadioRecord:function(){return this.selectRow},triggerHoverEvent:function(e,t){var o=t.row;this.hoverRow=o},clearHoverRow:function(){this.hoverRow=null},triggerCellMousedownEvent:function(e,t){var l=this.$el,o=this.tableData,i=this.visibleColumn,n=this.editStore,r=this.checkboxOpts,s=this.mouseConfig,a=this.mouseOpts,c=this.editConfig,u=this.editOpts,h=this.handleSelected,d=this.handleChecked,f=n.checked,p=n.actived,g=t.row,v=t.column,x=t.cell,m=e.button,b=0===m,w=2===m,C=s&&(a.range||a.checked);if(b||w)if(C){if(c&&"dblclick"===u.trigger)if("row"===u.mode&&p.row===g||p.row===g&&p.column===v);else if(b){this.handleSelected(t,e);var T=document.onmousemove,R=document.onmouseup,_=_tools.DomTools.getCellIndexs(x),y=_xeUtils.default.throttle(function(e){var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),o=t.flag,i=t.targetElem;o&&d(_,_tools.DomTools.getCellIndexs(i),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=function(e){e.preventDefault(),e.stopPropagation(),y(e)},document.onmouseup=function(e){document.onmousemove=T,document.onmouseup=R},this.closeFilter(),this.closeMenu()}else{var S=_tools.DomTools.getCellIndexs(x);-1!==f.rows.indexOf(o[S.rowIndex])&&-1!==f.columns.indexOf(i[S.columnIndex])||h(t,e)}}else r.range&&this.handleCheckboxRangeEvent(e,t);this.isActivated=!0},triggerCornerMousedownEvent:function(e,t){t.preventDefault(),t.stopPropagation();var l=this.$el,o=this.tableData,i=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.editOpts,a=this.handleTempChecked,c=n.checked,u=t.button;if((0===u||2===u)&&r&&c.rows.length&&"dblclick"===s.trigger){var h=document.onmousemove,d=document.onmouseup,f={rowIndex:o.indexOf(c.rows[0]),columnIndex:i.indexOf(c.columns[0])},p=_xeUtils.default.throttle(function(e){var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),o=t.flag,i=t.targetElem;o&&a(f,_tools.DomTools.getCellIndexs(i),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=function(e){e.preventDefault(),e.stopPropagation(),p(e)},document.onmouseup=function(e){document.onmousemove=h,document.onmouseup=d,c.rows=c.tRows,c.columns=c.tColumns}}this.isActivated=!0},getCheckboxRangeResult:function(e,t){for(var o=0,i=[],l=0<t?"next":"previous",n=0<t?t:Math.abs(t)+e.offsetHeight;e&&o<n;)i.push(this.getRowNode(e).item),o+=e.offsetHeight,e=e["".concat(l,"ElementSibling")];return i},handleCheckboxRangeEvent:function(e,t){var n=this,o=t.column,i=t.cell;if(-1<["checkbox","selection"].indexOf(o.type)){var r=e.clientX,s=e.clientY,a=this.$refs.checkboxRange,l=document.onmousemove,c=document.onmouseup,u=i.parentNode,h=_tools.DomTools.getAbsolutePos(u),d=this.getCheckboxRecords(),f=[];this.updateZindex(),document.onmousemove=function(e){e.preventDefault(),e.stopPropagation();var t=e.clientX-r,o=e.clientY-s,i=Math.abs(o),l=n.getCheckboxRangeResult(u,e.clientY-h.top);a.style.display="block",a.style.width="".concat(Math.abs(t),"px"),a.style.height="".concat(i,"px"),a.style.left="".concat(r+(0<t?0:t),"px"),a.style.top="".concat(s+(0<o?0:o),"px"),a.style.zIndex="".concat(n.tZindex),10<i&&l.length!==f.length&&(f=l,e.ctrlKey?l.forEach(function(e){n.handleSelectRow({row:e},-1===d.indexOf(e))}):(n.clearCheckboxRow(),n.setCheckboxRow(l,!0)))},document.onmouseup=function(e){a.removeAttribute("style"),document.onmousemove=l,document.onmouseup=c}}},triggerHeaderCellClickEvent:function(e,t){var o=this._lastResizeTime,i=this.sortOpts,l=t.column,n=t.cell,r=o&&o>Date.now()-300,s=_tools.DomTools.getEventTargetNode(e,n,"vxe-sort-wrapper").flag,a=_tools.DomTools.getEventTargetNode(e,n,"vxe-filter-wrapper").flag;return"cell"!==i.trigger||r||s||a||this.triggerSortEvent(e,l,"desc"===l.order?"asc":"desc"),_tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerResizable:r,triggerSort:s,triggerFilter:a},t),e]),this.setCurrentColumn(l)},setCurrentColumn:function(e){return this.highlightCurrentColumn&&(this.clearCurrentRow(),this.currentColumn=e),this.$nextTick()},clearCurrentColumn:function(){this.currentColumn=null},triggerCellClickEvent:function(e,t){var o=this,i=this.$el,l=this.highlightCurrentRow,n=this.editStore,r=this.radioOpts,s=this.expandOpts,a=this.treeOpts,c=this.editConfig,u=this.editOpts,h=this.checkboxOpts,d=n.actived,f=t.column,p=t.row;isTargetRadioOrCheckbox(e,f,"radio")||isTargetRadioOrCheckbox(e,f,"checkbox","checkbox")||isTargetRadioOrCheckbox(e,f,"selection","checkbox")||("row"!==s.trigger&&("expand"!==f.type||"cell"!==s.trigger)||_tools.DomTools.getEventTargetNode(e,i,"vxe-table--expanded").flag||this.triggerRowExpandEvent(e,t),("row"===a.trigger||f.treeNode&&"cell"===a.trigger)&&this.triggerTreeExpandEvent(e,t),f.treeNode&&_tools.DomTools.getEventTargetNode(e,i,"vxe-tree--btn-wrapper").flag||"expand"===f.type&&_tools.DomTools.getEventTargetNode(e,i,"vxe-table--expanded").flag||(l&&("row"!==r.trigger&&(_tools.DomTools.getEventTargetNode(e,i,"vxe-cell--checkbox").flag||_tools.DomTools.getEventTargetNode(e,i,"vxe-cell--radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==r.trigger&&("radio"!==f.type||"cell"!==r.trigger)||_tools.DomTools.getEventTargetNode(e,i,"vxe-cell--radio").flag||this.triggerRadioRowEvent(e,t),"row"!==h.trigger&&("checkbox"!==f.type&&"selection"!==f.type||"cell"!==h.trigger)||_tools.DomTools.getEventTargetNode(e,t.cell,"vxe-cell--checkbox").flag||this.handleToggleCheckRowEvent(t,e),c&&("click"===u.trigger?d.args&&p===d.row&&f===d.column||("row"===u.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):"cell"===u.mode&&this.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})):"dblclick"===u.trigger&&("row"===u.mode&&d.row===p?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):this.handleSelected(t,e)))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e]))},triggerCellDBLClickEvent:function(e,t){var o=this,i=this.editStore,l=this.editConfig,n=this.editOpts,r=i.actived;l&&"dblclick"===n.trigger&&(r.args&&e.currentTarget===r.args.cell||("row"===n.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):"cell"===n.mode&&this.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var o=this,i=this.editStore,l=this.editOpts,n=l.mode,r=l.activeMethod,s=i.actived,a=e.row,c=e.column,u=e.cell;if(c.editRender&&u)if("row"===n?s.row!==a:s.row!==a||s.column!==c){var h="edit-disabled";r&&!r(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(t),this.clearSelected(t),this.clearActived(t),h="edit-actived",c.renderHeight=u.offsetHeight,s.args=e,s.row=a,s.column=c,this.$nextTick(function(){o.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,h,[e,t])}else c.renderHeight=u.offsetHeight,s.args=e,s.column!==c&&this.clearValidate(),setTimeout(function(){o.handleFocus(e,t)});return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,o=t.args,i=t.row,l=t.column;return(i||l)&&(this.updateFooter(),_tools.UtilTools.emitEvent(this,"edit-closed",[o,e])),t.args=null,t.row=null,t.column=null,this.clearValidate()},getActiveRow:function(){return this.getActiveRecord()},getActiveRecord:function(){var e=this.$el,t=this.editStore,o=this.afterFullData,i=t.actived,l=i.args,n=i.row;return l&&-1<o.indexOf(n)&&e.querySelectorAll(".vxe-body--column.col--actived").length?Object.assign({},l):null},hasActiveRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasActiveRow","isActiveByRow"]),this.isActiveByRow(e)},isActiveByRow:function(e){return this.editStore.actived.row===e},clearSelected:function(e){var t=this.editStore.selected;return t.row=null,t.column=null,this.$nextTick()},handleSelected:function(t,o){var i=this,e=this.mouseConfig,l=this.mouseOpts,n=this.editOpts,r=this.editStore,s=r.actived,a=r.selected,c=t.row,u=t.column,h=e&&l.selected,d=e&&(l.range||l.checked);return function(){if((h||d)&&(a.row!==c||a.column!==u)&&(s.row!==c||"cell"===n.mode&&s.column!==u)&&(i.clearChecked(o),i.clearActived(o),a.args=t,a.row=c,a.column=u,d)){var e=_tools.DomTools.getCellIndexs(t.cell);i.handleChecked(e,e,o)}return i.$nextTick()}()},clearChecked:function(e){var t=this.editStore.checked;return t.rows=[],t.columns=[],t.tRows=[],t.tColumns=[],this.$nextTick()},getMouseSelecteds:function(){return this.getSelectedCell()},getMouseCheckeds:function(){return this.getSelectedRanges()},getSelectedCell:function(){var e=this.editStore.selected,t=e.args,o=e.column;return t&&o?Object.assign({},t):null},getSelectedRanges:function(){var e=this.editStore.checked,t=e.rows;return{columns:e.columns,rows:t}},handleChecked:function(e,t,o){var i=this.tableData,l=this.visibleColumn,n=this.editStore.checked,r=e.rowIndex,s=e.columnIndex,a=t.rowIndex,c=t.columnIndex;n.tRows=[],n.tColumns=[],n.rows=r<a?i.slice(r,a+1):i.slice(a,r+1),n.columns=s<c?l.slice(Math.max(s,1),c+1):l.slice(Math.max(c,1),s+1)},handleTempChecked:function(e,t,o){var i=this.tableData,l=this.visibleColumn,n=this.editStore.checked,r=n.rows,s=n.tRows,a=n.columns,c=n.tColumns,u=e.rowIndex,h=e.columnIndex,d=t.rowIndex,f=t.columnIndex;s.length>r.length?f=l.indexOf(a[a.length-1]):c.length>a.length&&(d=i.indexOf(r[r.length-1])),u<d?n.tRows=i.slice(u,d+1):(u+=r.length,n.tRows=i.slice(d,u)),h<f?n.tColumns=l.slice(Math.max(h,1),f+1):(h+=a.length,n.tColumns=l.slice(Math.max(f,1),h))},clearCopyed:function(){var e=this.editStore.copyed;return e.cut=!1,e.rows=[],e.columns=[],this.$nextTick()},handleCopyed:function(e,t){var o=this.editStore,i=o.copyed,l=o.checked;i.cut=e,i.rows=l.rows,i.columns=l.columns},handlePaste:function(e){var t=this.tableData,n=this.visibleColumn,o=this.editStore,i=o.copyed,l=o.selected,r=i.cut,s=i.rows,a=i.columns;if(s.length&&a.length&&l.row&&l.column){var c=l.args,u=c.rowIndex,h=c.columnIndex,d={rowIndex:u,columnIndex:h},f={rowIndex:u+s.length-1,columnIndex:h+a.length-1};s.forEach(function(i,e){var l=t[u+e];l&&a.forEach(function(e,t){var o=n[h+t];o&&_tools.UtilTools.setCellValue(l,o,_tools.UtilTools.getCellValue(i,e)),r&&_tools.UtilTools.setCellValue(i,e,null)})}),r&&this.clearCopyed(),this.handleChecked(d,f,e)}},handleFocus:function(e,t){var o=e.row,i=e.column,l=e.cell,n=i.editRender;if(n){var r,s=_vXETable.default.renderer.get(n.name),a=n.autofocus,c=n.autoselect;if(a&&(r=l.querySelector(a)),!r&&s&&s.autofocus&&(r=l.querySelector(s.autofocus)),r){if(r.focus(),c)r.select();else if(browse.msie){var u=r.createTextRange();u.collapse(!1),u.select()}}else this.scrollToRow(o,i)}},setActiveRow:function(e){return this.setActiveCell(e,_xeUtils.default.find(this.visibleColumn,function(e){return e.editRender}).property)},setActiveCell:function(o,i){var l=this;return this.scrollToRow(o).then(function(){if(o&&i){var e=_xeUtils.default.find(l.visibleColumn,function(e){return e.property===i});if(e&&e.editRender){var t=_tools.DomTools.getCell(l,{row:o,column:e});t&&(l.handleActived({row:o,rowIndex:l.getRowIndex(o),column:e,columnIndex:l.getColumnIndex(e),cell:t,$table:l}),l.lastCallTime=Date.now())}}return l.$nextTick()})},setSelectCell:function(e,t){var o=this.tableData,i=this.editOpts,l=this.visibleColumn;if(e&&t&&"manual"!==i.trigger){var n=_xeUtils.default.find(l,function(e){return e.property===t}),r=o.indexOf(e);if(-1<r&&n){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:r,column:n}),a={row:e,rowIndex:r,column:n,columnIndex:l.indexOf(n),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},handleDefaultSort:function(){var e=this.sortOpts.defaultSort;if(e){var t=e.field,o=e.order;if(t&&o){var i=_xeUtils.default.find(this.visibleColumn,function(e){return e.property===t});i&&!i.order&&this.sort(t,o)}}},triggerSortEvent:function(e,t,o){var i=t.property;if(t.sortable||t.remoteSort){var l={column:t,property:i,field:i,prop:i,order:o,$table:this};t.order===o?(l.order=null,this.clearSort(t.property)):this.sort(i,o),_tools.UtilTools.emitEvent(this,"sort-change",[l,e])}},sort:function(t,e){var o=this.visibleColumn,i=this.tableFullColumn,l=this.remoteSort,n=this.sortOpts,r=_xeUtils.default.find(o,function(e){return e.property===t});if(r){var s=_xeUtils.default.isBoolean(r.remoteSort)?r.remoteSort:n.remote||l;(r.sortable||r.remoteSort)&&(e||(e="desc"===r.order?"asc":"desc"),r.order!==e&&(i.forEach(function(e){e.order=null}),r.order=e,s||this.handleTableData(!0)))}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},getSortColumn:function(){return this.visibleColumn.find(function(e){return e.sortable&&e.order})},filter:function(e,t){_tools.UtilTools.warn("vxe.error.delFunc",["filter","setFilter"]);var o=this.getColumnByField(e);if(o){var i=o.filters;if(i&&t){var l=t(i);return _xeUtils.default.isArray(l)&&(o.filters=_tools.UtilTools.getFilters(l)),this.$nextTick().then(function(){return i})}}return this.$nextTick()},setFilter:function(e,t){return e.filters&&t&&(e.filters=_tools.UtilTools.getFilters(t)),this.$nextTick()},triggerFilterEvent:function(e,s,t){var o=this.$refs,a=this.filterStore;if(a.column===s&&a.visible)a.visible=!1;else{var c=o.filterWrapper,u=o.tableBody.$el,h=e.target,d=e.pageX,f=_tools.DomTools.getDomNode().visibleWidth;Object.assign(a,{args:t,multiple:s.filterMultiple,options:s.filters,column:s,style:null,visible:!0}),a.isAllSelected=a.options.every(function(e){return e.checked}),a.isIndeterminate=!a.isAllSelected&&a.options.some(function(e){return e.checked}),this.$nextTick(function(){var e,t,o=c.$el.offsetWidth,i=o/2,l={top:"".concat(h.offsetTop+h.offsetParent.offsetTop+h.offsetHeight+8,"px")};if("left"===s.fixed?e=h.offsetLeft+h.offsetParent.offsetLeft-i:"right"===s.fixed?t=h.offsetParent.offsetWidth-h.offsetLeft+(h.offsetParent.offsetParent.offsetWidth-h.offsetParent.offsetLeft)-s.renderWidth-i:e=h.offsetLeft+h.offsetParent.offsetLeft-i-u.scrollLeft,e){var n=d+o-i+32-f;0<n&&(e-=n),l.left="".concat(Math.max(32,e),"px")}else if(t){var r=d+o-i+32-f;0<r&&(t+=r),l.right="".concat(t,"px")}a.style=l})}},confirmFilterEvent:function(e){var t=this.visibleColumn,o=this.filterStore,i=this.remoteFilter,l=this.filterOpts,n=this.scrollXLoad,r=this.scrollYLoad,s=o.column,a=s.property,c=[],u=[];s.filters.forEach(function(e){e.checked&&(c.push(e.value),u.push(e.data))}),o.visible=!1,l.remote||i||(this.handleTableData(!0),this.checkSelectionStatus());var h=[];t.filter(function(e){var t=e.property,o=e.filters,i=[],l=[];o&&o.length&&(o.forEach(function(e){e.checked&&(i.push(e.value),l.push(e.data))}),h.push({column:e,property:t,field:t,prop:t,values:i,datas:l}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:s,property:a,field:a,prop:a,values:c,datas:u,filters:h,$table:this}]),this.updateFooter(),(n||r)&&this.clearScroll(),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(e){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){if(e){var t=this.getColumnByField(e);return t.filters&&t.filters.some(function(e){return e.checked})}return this.visibleColumn.some(function(e){return e.filters&&e.filters.some(function(e){return e.checked})})},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(e){var t=arguments.length?this.getColumnByField(e):null,o=this.filterStore,i=function(e){e.filters&&e.filters.forEach(function(e){e.checked=!1,e.data=e._data})};return t?i(t):this.visibleColumn.forEach(i),t&&t===o.column||Object.assign(o,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,o=this.expandLazyLoadeds,i=this.fullAllDataRowMap,l=e.lazy,n=i.get(t);return l&&n&&(n.expandLoaded=!1,_xeUtils.default.remove(o,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,o=this.expandOpts,i=this.expandLazyLoadeds;return o.lazy&&-1===i.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var o=this.$listeners,i=this.expandOpts,l=this.expandLazyLoadeds,n=t.row;if(!i.lazy||-1===l.indexOf(n)){var r=!this.isExpandByRow(n);this.setRowExpansion(n,r),o["toggle-expand-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-expand-change","toggle-row-expand"]),_tools.UtilTools.emitEvent(this,"toggle-expand-change",[{expanded:r,row:n,rowIndex:this.getRowIndex(n),$table:this},e])):_tools.UtilTools.emitEvent(this,"toggle-row-expand",[{expanded:r,row:n,rowIndex:this.getRowIndex(n),$table:this},e])}},toggleRowExpansion:function(e){return this.setRowExpansion(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,o=e.expandAll,i=e.expandRowKeys;if(o)this.setAllRowExpansion(!0);else if(i){var l=[];i.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setRowExpansion(l,!0)}},setAllRowExpansion:function(e){return this.expandOpts.lazy?this.setRowExpansion(this.tableData,!0):(this.rowExpandeds=e?this.tableFullData.slice(0):[],this.$nextTick().then(this.recalculate))},handleAsyncRowExpand:function(t){var o=this,i=this.fullAllDataRowMap.get(t);return new Promise(function(e){o.expandLazyLoadeds.push(t),o.expandOpts.loadMethod({$table:o,row:t}).catch(function(e){return e}).then(function(){i.expandLoaded=!0,_xeUtils.default.remove(o.expandLazyLoadeds,function(e){return e===t}),o.rowExpandeds.push(t),e(o.$nextTick().then(o.recalculate))})})},setRowExpansion:function(t,e){var o=this,i=this.fullAllDataRowMap,l=this.rowExpandeds,n=this.expandLazyLoadeds,r=this.expandOpts,s=r.lazy,a=r.accordion,c=[];return t&&(_xeUtils.default.isArray(t)||(t=[t]),a&&(l=[],t=t.slice(t.length-1,t.length)),e?t.forEach(function(e){if(-1===l.indexOf(e)){var t=i.get(e);s&&!t.expandLoaded&&-1===n.indexOf(e)?c.push(o.handleAsyncRowExpand(e)):l.push(e)}}):_xeUtils.default.remove(l,function(e){return-1<t.indexOf(e)})),this.rowExpandeds=l,Promise.all(c).then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var e=this,t=this.rowExpandeds.length;return this.rowExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,o=this.treeExpandeds,i=this.fullAllDataRowMap,l=e.lazy,n=i.get(t);return l&&n&&(n.treeLoaded=!1,_xeUtils.default.remove(o,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,o=this.treeOpts,i=this.treeLazyLoadeds,l=o.lazy,n=o.hasChild;return l&&e[n]&&-1===i.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var o=this.$listeners,i=this.treeOpts,l=this.treeLazyLoadeds,n=t.row;if(!i.lazy||-1===l.indexOf(n)){var r=!this.isTreeExpandByRow(n);this.setTreeExpansion(n,r),o["toggle-tree-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-tree-change","toggle-tree-expand"]),_tools.UtilTools.emitEvent(this,"toggle-tree-change",[{expanded:r,row:n,rowIndex:this.getRowIndex(n),$table:this},e])):_tools.UtilTools.emitEvent(this,"toggle-tree-expand",[{expanded:r,row:n,rowIndex:this.getRowIndex(n),$table:this},e])}},toggleTreeExpansion:function(e){return this.setTreeExpansion(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,o=this.treeOpts,i=this.tableFullData;if(e){var t=o.expandAll,l=o.expandRowKeys;if(t)this.setAllTreeExpansion(!0);else if(l){var n=[],r=_tools.UtilTools.getRowkey(this);l.forEach(function(t){var e=_xeUtils.default.findTree(i,function(e){return t===_xeUtils.default.get(e,r)},o);e&&n.push(e.item)}),this.setTreeExpansion(n,!0)}}},handleAsyncTreeExpandChilds:function(o){var i=this,e=this.fullAllDataRowMap,l=this.treeExpandeds,t=this.treeOpts,n=this.treeLazyLoadeds,r=t.loadMethod,s=t.children,a=e.get(o);return new Promise(function(t){n.push(o),r({$table:i,row:o}).catch(function(e){return[]}).then(function(e){a.treeLoaded=!0,_xeUtils.default.remove(n,function(e){return e===o}),_xeUtils.default.isArray(e)||(e=[]),e&&(o[s]=e,i.appendTreeCache(o,e),e.length&&-1===l.indexOf(o)&&l.push(o),i.isCheckedByCheckboxRow(o)&&i.setCheckboxRow(e,!0)),t(i.$nextTick().then(i.recalculate))})})},setAllTreeExpansion:function(e){var t=this.tableFullData,o=this.treeOpts,i=o.lazy,l=o.children,n=[];return e?i?(_xeUtils.default.eachTree(t,function(e){n.push(e)},o),this.setTreeExpansion(n,!0)):(_xeUtils.default.eachTree(t,function(e){var t=e[l];t&&t.length&&n.push(e)},o),this.treeExpandeds=n):this.treeExpandeds=n,this.$nextTick().then(this.recalculate)},setTreeExpansion:function(t,e){var o=this,i=this.fullAllDataRowMap,l=this.tableFullData,n=this.treeExpandeds,r=this.treeOpts,s=this.treeLazyLoadeds,a=r.lazy,c=r.hasChild,u=r.children,h=r.accordion,d=[];if(t&&(_xeUtils.default.isArray(t)||(t=[t]),t.length)){if(h){t=t.slice(t.length-1,t.length);var f=_xeUtils.default.findTree(l,function(e){return e===t[0]},r);_xeUtils.default.remove(n,function(e){return-1<f.items.indexOf(e)})}return e?t.forEach(function(e){if(-1===n.indexOf(e)){var t=i.get(e);a&&e[c]&&!t.treeLoaded&&-1===s.indexOf(e)?d.push(o.handleAsyncTreeExpandChilds(e)):e[u]&&e[u].length&&n.push(e)}}):_xeUtils.default.remove(n,function(e){return-1<t.indexOf(e)}),Promise.all(d).then(this.recalculate)}return Promise.resolve()},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var e=this,t=this.treeExpandeds.length;return this.treeExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},isScrollXLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollXLoad","getTableScroll"]),this.scrollXLoad},isScrollYLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollYLoad","getTableScroll"]),this.scrollYLoad},getVirtualScroller:function(){return this.getTableScroll()},getTableScroll:function(){var e=this.$refs,t=this.scrollXLoad,o=this.scrollYLoad,i=e.tableBody.$el;return{scrollX:t,virtualX:t,scrollY:o,virtualY:o,scrollTop:i.scrollTop,scrollLeft:i.scrollLeft}},triggerScrollXEvent:function(e){this.loadScrollXData()},loadScrollXData:function(e){for(var t=this.$refs,o=this.visibleColumn,i=this.scrollXStore,l=i.startIndex,n=i.renderSize,r=i.offsetSize,s=i.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,u=0,h=e||!1,d=o.length,f=0;f<d;f++)if(a<(u+=o[f].renderWidth)){c=f;break}if(e||i.visibleIndex!==c){var p=Math.min(Math.floor((n-s)/2),s);i.visibleIndex===c?i.startIndex=c:i.visibleIndex>c?(h=c-r<=l)&&(i.startIndex=Math.max(0,Math.max(0,c-p))):(h=l+n<=c+s+r)&&(i.startIndex=Math.max(0,Math.min(o.length-n,c-p))),h&&this.updateScrollXData(),i.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:_xeUtils.default.debounce(function(e){var t=this.afterFullData,o=this.scrollYStore,i=this.isLoadData,l=o.startIndex,n=o.renderSize,r=o.offsetSize,s=o.visibleSize,a=o.rowHeight,c=e.target.scrollTop,u=Math.ceil(c/a),h=!1;if(i||o.visibleIndex!==u){var d=Math.min(Math.floor((n-s)/2),s);o.visibleIndex>u?(h=u-r<=l)&&(o.startIndex=Math.max(0,u-Math.max(d,n-s))):(h=l+n<=u+s+r)&&(o.startIndex=Math.max(0,Math.min(t.length-n,u-d))),h&&this.updateScrollYData(),o.visibleIndex=u,this.isLoadData=!1}},debounceScrollYDuration,{leading:!1,trailing:!0}),computeRowHeight:function(){var e,t=this.$refs.tableBody,o=t?t.$el:null,i=this.$refs.tableHeader;if(o){var l=o.querySelector("tbody>tr");!l&&i&&(l=i.$el.querySelector("thead>tr")),l&&(e=l.clientHeight)}e||(e=this.rowHeightMaps[this.vSize||"default"]),this.rowHeight=e},computeScrollLoad:function(){var b=this;return this.$nextTick().then(function(){var e=b.vSize,t=b.scrollXLoad,o=b.scrollYLoad,i=b.scrollYStore,l=b.scrollXStore,n=b.visibleColumn,r=b.optimizeOpts,s=b.rowHeightMaps,a=r.scrollX,c=r.scrollY,u=b.$refs.tableBody,h=u?u.$el:null,d=b.$refs.tableHeader;if(h){if(t){var f=n[0],p=f?f.renderWidth:40,g=_xeUtils.default.toNumber(a.vSize||Math.ceil(h.clientWidth/p));l.visibleSize=g,a.oSize||(l.offsetSize=g),a.rSize||(l.renderSize=g+4),b.updateScrollXData()}else b.updateScrollXSpace();if(o){var v;if(c.rHeight)v=c.rHeight;else{var x=h.querySelector("tbody>tr");!x&&d&&(x=d.$el.querySelector("thead>tr")),x&&(v=x.clientHeight)}v||(v=s[e||"default"]);var m=_xeUtils.default.toNumber(c.vSize||Math.ceil(h.clientHeight/v));i.visibleSize=m,i.rowHeight=v,c.oSize||(i.offsetSize=m),c.rSize||(i.renderSize=m*(browse.edge?10:8)),b.updateScrollYData()}else b.updateScrollYSpace()}return b.$nextTick()})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.visibleColumn,t=this.scrollXStore;t.leftSpaceWidth=e.slice(0,t.startIndex).reduce(function(e,t){return e+t.renderWidth},0),t.rightSpaceWidth=e.slice(t.startIndex+t.renderSize,e.length).reduce(function(e,t){return e+t.renderWidth},0)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var e=this.scrollYStore,t=this.afterFullData,o=t.length*e.rowHeight;e.ySpaceHeight=o,e.topSpaceHeight=Math.max(e.startIndex*e.rowHeight,0),e.bottomSpaceHeight=Math.max((t.length-(e.startIndex+e.renderSize))*e.rowHeight,0)},scrollTo:function(e,t){var o=this,i=this.$refs.tableBody.$el;if(_xeUtils.default.isNumber(e)){var l=this.$refs.tableFooter;l?l.$el.scrollLeft=e:i.scrollLeft=e}if(_xeUtils.default.isNumber(t)){var n=this.$refs.rightBody;n&&(n.$el.scrollTop=t),i.scrollTop=t}return this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(o.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var o=[];return e&&(this.treeConfig?o.push(this.scrollToTreeRow(e)):this.fullAllDataRowMap.has(e)&&o.push(_tools.DomTools.rowToVisible(this,e))),o.push(this.scrollToColumn(t)),Promise.all(o)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var o=this,e=this.tableFullData,i=this.treeConfig,l=this.treeOpts;if(i){var n=_xeUtils.default.findTree(e,function(e){return e===t},l);if(n){var r=n.nodes;r.forEach(function(e,t){t<r.length-1&&!o.hasTreeExpand(e)&&o.setTreeExpansion(e,!0)})}}return this.$nextTick()},clearScroll:function(){var n=this;return this.updateScrollXSpace(),this.updateScrollYSpace(),this.$nextTick().then(function(){var e=n.$refs,t=e.tableBody,o=t?t.$el:null,i=e.tableFooter,l=(i?i.$el:null)||o;return o&&(o.scrollTop=0),l&&(l.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(n.$nextTick())})})})},updateFooter:function(){var e=this.showFooter,t=this.tableColumn,o=this.footerMethod;return e&&o&&(this.footerData=t.length?o({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(a,c){var u=this,h=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=u.$refs,t=u.tableData,o=u.editRules,i=u.validStore;if(a&&e.tableBody&&o){var l=a.row,n=a.column;if(u.hasCellRules("change",l,n)){var r=t.indexOf(l),s=_tools.DomTools.getCell(u,{row:l,rowIndex:r,column:n});if(s)return u.validCellRules("change",l,n,c).then(function(){h&&i.visible&&_tools.UtilTools.setCellValue(l,n,c),u.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(l,n,c),u.showValidTooltip({rule:t,row:l,column:n,cell:s})})}}})},triggerValidate:function(i){var l=this,e=this.editOpts,t=this.editStore,o=this.editRules,n=this.validStore,r=t.actived;if(r.row&&o){var s=r.args,a=s.row,c=s.column,u=s.cell;if(this.hasCellRules(i,a,c))return this.validCellRules(i,a,c).then(function(){"row"===e.mode&&n.visible&&n.row===a&&n.column===c&&l.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&i!==t.trigger)return Promise.resolve();var o={rule:t,row:a,column:c,cell:u};return l.showValidTooltip(o),Promise.reject(o)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,c,u){var h=this,d={},f=!0,t=this.editRules,p=this.afterFullData,g=this.treeConfig,o=this.treeOpts,i=p;e&&(_xeUtils.default.isFunction(e)?c=e:i=_xeUtils.default.isArray(e)?e:[e]);var l=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var n=this.getColumns(),r=function(r){var e=[];n.forEach(function(l,n){_xeUtils.default.has(t,l.property)&&e.push(new Promise(function(o,i){h.validCellRules("all",r,l).then(o).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:h.getRowIndex(r),row:r,columnIndex:n,column:l,$table:h};return u?(d[l.property]||(d[l.property]=[]),d[l.property].push(t),o()):i(t)})}))}),l.push(Promise.all(e))};return g?_xeUtils.default.eachTree(i,r,o):i.forEach(r),Promise.all(l).then(function(){var e=Object.keys(d);if(e.length)return Promise.reject(d[e[0]][0]);c&&c(f)}).catch(function(s){var a=u?d:_defineProperty({},s.column.property,s);return new Promise(function(e,t){var o=function(){f=!1,c?(c(f,a),e()):t(a)},i=function(){s.cell=_tools.DomTools.getCell(h,s),h.handleValidError(s),o()},l=s.row,n=p.indexOf(l),r=0<n?p[n-1]:l;_tools.DomTools.toView(h.$el),!1===h.validOpts.autoPos?o():g?h.scrollToTreeRow(r).then(i):h.scrollToRow(r).then(i)})})}return c&&c(f),Promise.resolve()},hasCellRules:function(t,e,o){var i=this.editRules,l=o.property;if(l&&i){var n=_xeUtils.default.get(i,l);return n&&_xeUtils.default.find(n,function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(n,r,s,e){var a=this,t=this.editRules,c=this.treeConfig,o=s.property,u=[],i=[];if(o&&t){var h=_xeUtils.default.get(t,o);if(h){var d=_xeUtils.default.isUndefined(e)?_xeUtils.default.get(r,o):e;h.forEach(function(l){i.push(new Promise(function(o){if("all"!==n&&l.trigger&&n!==l.trigger)o();else if(_xeUtils.default.isFunction(l.validator)){var e;l.validator(l,d,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:l.trigger,message:e.message,rule:new Rule(l)};u.push(new Rule(t))}return o()},(_defineProperty(e={rules:h,row:r,column:s},"".concat(c?"$":"","rowIndex"),a.getRowIndex(r)),_defineProperty(e,"columnIndex",a.getColumnIndex(s)),e))}else{var t="number"===l.type,i=t?_xeUtils.default.toNumber(d):_xeUtils.default.getSize(d);null==d||""===d?l.required&&u.push(new Rule(l)):(t&&isNaN(d)||!isNaN(l.min)&&i<parseFloat(l.min)||!isNaN(l.max)&&i>parseFloat(l.max)||l.pattern&&!(l.pattern.test?l.pattern:new RegExp(l.pattern)).test(d))&&u.push(new Rule(l)),o()}}))})}}return Promise.all(i).then(function(){if(u.length){var e={rules:u,rule:u[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;!1===this.validOpts.autoPos?_tools.UtilTools.emitEvent(this,"valid-error",[e]):this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,o=this.$refs,i=this.height,l=this.tableData,n=this.validOpts,r=e.rule,s=e.row,a=e.column,c=e.cell,u=o.validTip,h=r.message;this.$nextTick(function(){Object.assign(t.validStore,{row:s,column:a,rule:r,content:h,visible:!0}),u&&("tooltip"===n.message||"default"===n.message&&!i&&l.length<2)&&u.toVisible(c,h),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["exportCsv","exportData"]),this.exportData(e)},exportData:function(e){var t=this.visibleColumn,o=this.tableFullData,i=Object.assign({filename:"",sheetName:"",original:!1,message:!1,isHeader:!0,isFooter:!0,download:!0,type:"csv",data:null,columns:null,columnFilterMethod:e&&e.columns?null:function(e){return-1<["seq","index"].indexOf(e.type)||e.property},dataFilterMethod:null,footerFilterMethod:null},_conf.default.export,e);if(i.filename||(i.filename=_xeUtils.default.template(_conf.default.i18n(i.original?"vxe.table.expOriginFilename":"vxe.table.expFilename"),[_xeUtils.default.toDateString(Date.now(),"yyyyMMddHHmmss")])),i.sheetName||(i.sheetName=_conf.default.i18n("vxe.table.expSheetName")),-1===_vXETable.default.exportTypes.indexOf(i.type))throw new Error(_tools.UtilTools.getLog("vxe.error.notType",[i.type]));return _tools.ExportTools.handleExport(this,i,t,o)},importByFile:function(t,e){var o=this;if(window.FileReader){var i=_tools.UtilTools.parseFile(t),l=i.type,n=i.filename,r=Object.assign({mode:"covering"},e,{type:l,filename:n});-1<(r.types||_vXETable.default.importTypes).indexOf(l)?this.preventEvent(null,"event.import",{$table:this,file:t,options:r,columns:this.tableFullColumn},function(){var e=new FileReader;e.onerror=function(e){_tools.UtilTools.error("vxe.error.notType",[l])},e.onload=function(e){_tools.ExportTools.handleImport(o,e.target.result.trim(),r)},e.readAsText(t,"UTF-8")}):_tools.UtilTools.error("vxe.error.notType",[l])}else _tools.UtilTools.error("vxe.error.notExp")},importData:function(e){var o=this,t=Object.assign({},_conf.default.import,e),i=new Promise(function(e,t){o._importResolve=e,o._importReject=t});return this.readFile(t).then(function(e){return o.importByFile(e.target.files[0],t)}).catch(function(e){o._importReject(e),o._importReject=null}),i},readFile:function(){var o=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};fileForm.parentNode||document.body.appendChild(fileForm);var l=i.types||_vXETable.default.importTypes;return i.multiple&&(fileInput.multiple="multiple"),fileInput.accept=".".concat(l.join(", .")),fileInput.onchange=function(e){var t=_tools.UtilTools.parseFile(e.target.files[0]).type;-1<l.indexOf(t)?o._fileResolve(e):(!1!==i.message&&_vXETable.default.$modal.message({message:_xeUtils.default.template(_conf.default.i18n("vxe.error.notType"),[t]),status:"error"}),o._fileReject(e)),o._fileResolve=null},fileForm.reset(),fileInput.click(),new Promise(function(e,t){o._fileResolve=e,o._fileReject=t})},print:function(e){var t=Object.assign({original:!1},e,{type:"html",download:!1,print:!0});t.sheetName||(t.sheetName=t.filename),this.exportData(t).then(function(e){var t=e.content,o=e.blob;if(_tools.DomTools.browse.msie){if(printFrame){try{printFrame.contentDocument.write(""),printFrame.contentDocument.clear()}catch(e){}document.body.removeChild(printFrame)}printFrame=createFrame(),document.body.appendChild(printFrame),printFrame.contentDocument.write(t),printFrame.contentDocument.execCommand("print")}else printFrame||((printFrame=createFrame()).onload=function(e){e.target.src&&e.target.contentWindow.print()},document.body.appendChild(printFrame)),printFrame.src=URL.createObjectURL(o)})},openImport:function(e){var t=Object.assign({mode:"covering",message:!0},e,this.importOpts);!this.getTreeStatus()?(this.importConfig||_tools.UtilTools.warn("vxe.error.reqProp",["import-config"]),Object.assign(this.importStore,{file:null,type:"",filename:"",visible:!0}),Object.assign(this.importParams,t)):t.message&&_vXETable.default.$modal.message({message:_conf.default.i18n("vxe.error.treeNotImp"),status:"error"})},openExport:function(e){var t=this.$toolbar,o=this.exportConfig,i=this.exportOpts,l=this.treeConfig,n=this.tableFullColumn,r=this.footerData,s=this.getCheckboxRecords(),a=n.filter(function(e){return-1<["seq","index"].indexOf(e.type)||e.property}),c=!!l,u=!!r.length,h=Object.assign({message:!0,isHeader:!0},i,e),d=h.types||_vXETable.default.exportTypes,f=i.checkMethod||(t?t.customOpts.checkMethod:null);return o||_tools.UtilTools.warn("vxe.error.reqProp",["export-config"]),h.types=d.map(function(e){return{value:e,label:"vxe.types.".concat(e)}}),a.forEach(function(e){e.checked=e.visible,e.disabled=!!f&&!f({column:e})}),Object.assign(this.exportStore,{columns:a,selectRecords:s,mode:s.length?"selected":"all",hasFooter:u,visible:!0,isTree:c}),Object.assign(this.exportParams,{filename:h.filename||"",sheetName:h.sheetName||"",type:h.type||h.types[0].value,types:h.types,original:h.original,message:h.message,isHeader:h.isHeader,isFooter:u}),this.$nextTick()},confirmExportEvent:function(e){this.exportData(Object.assign({},this.exportOpts,e))},confirmImportEvent:function(e){this.importByFile(this.importStore.file,Object.assign({},this.importOpts,e))},confirmPrintEvent:function(e){this.print(Object.assign({},this.printOpts,e))},updateZindex:function(){this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex(this))},connect:function(e){var t=e.toolbar;this.$toolbar=t},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;