"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireWildcard(require("../../v-x-e-table")),_tools=require("../../tools");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var n=o?Object.getOwnPropertyDescriptor(e,l):null;n&&(n.get||n.set)?Object.defineProperty(i,l,n):i[l]=e[l]}return i.default=e,t&&t.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var printFrame,rowUniqueId=0,browse=_tools.DomTools.browse,debounceScrollYDuration=browse.msie?40:20,fileForm=document.createElement("form"),fileInput=document.createElement("input");function createFrame(){var e=document.createElement("iframe");return e.className="vxe-table--print-frame",e}function getRowUniqueId(){return"row_".concat(++rowUniqueId)}function isTargetRadioOrCheckbox(e,t,i,o){var l=e.target;return l&&t.type===i&&"input"===l.tagName.toLowerCase()&&l.type===(o||i)}fileForm.className="vxe-table--import-form",fileInput.name="file",fileInput.type="file",fileForm.appendChild(fileInput);var Rule=function(){function t(e){_classCallCheck(this,t),Object.assign(this,{$options:e,required:e.required,min:e.min,max:e.min,type:e.type,pattern:e.pattern,validator:e.validator,trigger:e.trigger,maxWidth:e.maxWidth})}return _createClass(t,[{key:"message",get:function(){return _tools.UtilTools.getFuncText(this.$options.message)}}]),t}();function renderFixed(e,t,i){var o=t.tableData,l=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.border,c=t.height,u=t.parentHeight,h=t.vSize,d=t.headerHeight,f=t.footerHeight,p=t.showHeader,g=t.showFooter,v=t.tableHeight,m=t.scrollbarWidth,x=t.scrollbarHeight,w=t.scrollRightToLeft,b=t.scrollLeftToRight,C=t.columnStore,T=t.footerData,_="right"===i,R=C["".concat(i,"List")],y=0;c&&(y="auto"===c?u:_tools.DomTools.isScale(c)?Math.floor(parseInt(c)/100*u):_xeUtils.default.toNumber(c),g&&(y+=x+1));var S={height:"".concat((0<y?y-d-f:v)+d+f-x*(g?2:1),"px"),width:"".concat(R.reduce(function(e,t){return e+t.renderWidth},_?m:0)-(!0===a?1:0),"px")};return e("div",{class:["vxe-table--fixed-".concat(i,"-wrapper"),{"scrolling--middle":_?w:b}],style:S,ref:"".concat(i,"Container")},[p?e("vxe-table-header",{props:{fixedType:i,tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,size:h,fixedColumn:R,isGroup:s},ref:"".concat(i,"Header")}):null,e("vxe-table-body",{style:{top:"".concat(d,"px")},props:{fixedType:i,tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,fixedColumn:R,size:h,isGroup:s},ref:"".concat(i,"Body")}),g?e("vxe-table-footer",{style:{top:"".concat(0<y?y-f:v+d,"px")},props:{fixedType:i,footerData:T,tableColumn:l,visibleColumn:n,size:h,fixedColumn:R},ref:"".concat(i,"Footer")}):null])}var headerProps={children:"children"},_default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:[Boolean,String],default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},footerAlign:{type:String,default:function(){return _conf.default.footerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],cellStyle:[Object,Function],headerCellStyle:[Object,Function],footerCellStyle:[Object,Function],rowStyle:[Object,Function],headerRowStyle:[Object,Function],footerRowStyle:[Object,Function],spanMethod:Function,footerSpanMethod:Function,showAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:[Boolean,String],rowId:String,zIndex:Number,autoResize:Boolean,syncResize:[Boolean,String],seqConfig:Object,sortConfig:Object,filterConfig:Object,radioConfig:Object,selectConfig:Object,checkboxConfig:Object,tooltipConfig:Object,exportConfig:[Boolean,Object],importConfig:[Boolean,Object],printConfig:Object,expandConfig:Object,treeConfig:[Boolean,Object],contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:[Boolean,Object],validConfig:Object,editRules:Object,optimization:Object,params:Object},provide:function(){return{$table:this}},inject:{$grid:{default:null}},data:function(){return{id:"".concat(_xeUtils.default.uniqueId()),tZindex:0,collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,scrollLeftToRight:!1,scrollRightToLeft:!1,isCoverBody:!1,rowHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,currentColumn:null,footerData:[],rowExpandeds:[],expandLazyLoadeds:[],treeExpandeds:[],treeLazyLoadeds:[],treeIndeterminates:[],hoverRow:null,_isLoading:!1,filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],childPos:null,style:null},scrollXStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,leftSpaceWidth:0,rightSpaceWidth:0},scrollYStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,topSpaceHeight:0,bottomSpaceHeight:0,ySpaceHeight:0},tooltipStore:{visible:!1,row:null,column:null,content:""},editStore:{checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1},importStore:{file:null,type:"",filename:"",visible:!1},importParams:{mode:"",types:null,message:!0},exportStore:{name:"",mode:"",columns:[],selectRecords:[],hasFooter:!1,visible:!1,isTree:!1},exportParams:{filename:"",sheetName:"",type:"",types:[],original:!1,message:!0,isHeader:!1,isFooter:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},rowHeightMaps:function(){return Object.assign({default:48,medium:44,small:40,mini:36},this.optimizeOpts.rHeights)},seqOpts:function(){return Object.assign({startIndex:0},_conf.default.seqConfig,this.seqConfig)},radioOpts:function(){return Object.assign({},_conf.default.radioConfig,this.radioConfig)},checkboxOpts:function(){return Object.assign({},_conf.default.checkboxConfig,this.checkboxConfig||this.selectConfig)},tooltipOpts:function(){return Object.assign({size:this.vSize,leaveDelay:300},_conf.default.tooltipConfig,this.tooltipConfig)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipOpts)},editOpts:function(){return Object.assign({},_conf.default.editConfig,this.editConfig)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},filterOpts:function(){return Object.assign({},_conf.default.filterConfig,this.filterConfig)},mouseOpts:function(){return Object.assign({},_conf.default.mouseConfig,this.mouseConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _vXETable.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t},exportOpts:function(){return Object.assign({},_conf.default.exportConfig,this.exportConfig)},importOpts:function(){return Object.assign({},_conf.default.importConfig,this.importConfig)},printOpts:function(){return Object.assign({},_conf.default.printConfig,this.printConfig)},expandOpts:function(){return Object.assign({},_conf.default.expandConfig,this.expandConfig)},treeOpts:function(){return Object.assign({children:"children",hasChild:"hasChild",indent:20},_conf.default.treeConfig,this.treeConfig)},cellOffsetWidth:function(){return this.border?Math.max(2,Math.ceil(this.scrollbarWidth/this.tableColumn.length)):1},expandColumn:function(){return this.tableColumn.find(function(e){return"expand"===e.type})},isAllCheckboxDisabled:function(){var e=this.tableFullData,t=(this.treeConfig,this.checkboxOpts),i=t.strict,o=t.checkMethod;return!!i&&(!e.length||!!o&&e.every(function(e,t){return!o({row:e,rowIndex:t,$rowIndex:t})}))}},watch:{data:function(e){var t=this;this.loadTableData(e).then(function(){t.inited||(t.inited=!0,t.handleDefaults())})},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=this,i=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=i,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn().then(function(){t.scrollXLoad&&t.updateVirtualScrollX(!0)}),this.handleTableData(!0),this.$toolbar&&this.$toolbar.updateColumn(i),i.length&&i.some(function(e){return e.columnKey})&&_tools.UtilTools.warn("vxe.error.delProp",["column.column-key","table.column-key"]),i.length){var o=Math.floor((i.length-1)/2);i[o].prop&&_tools.UtilTools.warn("vxe.error.delProp",["prop","field"]),i[o].label&&_tools.UtilTools.warn("vxe.error.delProp",["label","title"])}this.treeConfig&&i.some(function(e){return e.fixed})&&i.some(function(e){return"expand"===e.type})&&_tools.UtilTools.warn("vxe.error.treeFixedExpand")},tableColumn:function(){this.analyColumnWidth()},height:function(){var e=this;this.$nextTick(function(){return e.recalculate(!0)})},loading:function(){this._isLoading||(this._isLoading=!0)},syncResize:function(e){var t=this;e&&this.$nextTick(function(){t.$el.clientWidth&&t.$el.clientHeight&&t.recalculate(!0)})}},created:function(){var e=this,t=this.data,i=this.scrollXStore,o=this.scrollYStore,l=this.optimizeOpts,n=this.ctxMenuOpts,r=this.showOverflow,s=this.radioOpts,a=this.checkboxOpts,c=this.treeConfig,u=this.treeOpts,h=this.editConfig,d=this.editOpts,f=this.loading,p=this.showAllOverflow,g=this.showHeaderAllOverflow,v=l.scrollX,m=l.scrollY;f&&(this._isLoading=!0),m&&Object.assign(o,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(m.rSize),offsetSize:_xeUtils.default.toNumber(m.oSize)}),v&&Object.assign(i,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(v.rSize),offsetSize:_xeUtils.default.toNumber(v.oSize)}),_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("vxe.error.emptyProp",["row-id"]),this.startIndex,_xeUtils.default.isBoolean(p)&&_tools.UtilTools.warn("vxe.error.delProp",["show-all-overflow","show-overflow"]),_xeUtils.default.isBoolean(g)&&_tools.UtilTools.warn("vxe.error.delProp",["show-header-all-overflow","show-header-overflow"]),s.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["radio-config.labelProp","radio-config.labelField"]),this.selectConfig,!c||!u.line||this.rowKey&&r||_tools.UtilTools.warn("vxe.error.reqProp",["row-key | show-overflow"]),a.checkProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.checkProp","select-config.checkField"]),a.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.labelProp","select-config.labelField"]),this.sortMethod,this.remoteSort,this.remoteFilter,["header","body","footer"].forEach(function(e){n[e]&&n[e].visibleMethod&&_tools.UtilTools.warn("vxe.error.delProp",["context-menu.".concat(e,".visibleMethod"),"context-menu.visibleMethod"])}),this.lastScrollLeft=0,this.lastScrollTop=0,this.afterFullData=[],this.selectReserveRowMap={},this.fullAllDataRowMap=new Map,this.fullAllDataRowIdData={},this.fullDataRowMap=new Map,this.fullDataRowIdData={},this.fullColumnMap=new Map,this.fullColumnIdData={},this.loadTableData(t).then(function(){a.key?_tools.UtilTools.warn("vxe.error.delProp",["select-config.key","row-id"]):c&&u.key?_tools.UtilTools.warn("vxe.error.delProp",["tree-config.key","row-id"]):h&&d.key&&_tools.UtilTools.warn("vxe.error.delProp",["edit-config.key","row-id"]),t&&t.length&&(e.inited=!0,e.handleDefaults())}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent),this.preventEvent(null,"created",{$table:this})},mounted:function(){var e=this;this.autoResize&&_tools.ResizeEvent.on(this,this.getParentElem(),function(){return e.recalculate(!0)}),document.body.appendChild(this.$refs.tableWrapper),this.preventEvent(null,"mounted",{$table:this})},activated:function(){this.refreshScroll(),this.preventEvent(null,"activated",{$table:this})},deactivated:function(){this.preventEvent(null,"deactivated",{$table:this})},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.getParentElem()),this.closeFilter(),this.closeMenu(),this.clearAll(),this.preventEvent(null,"beforeDestroy",{$table:this})},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize"),this.preventEvent(null,"destroyed",{$table:this})},render:function(e){var t=this._e,i=this.id,o=this.isCoverBody,l=this.tableData,n=this.tableColumn,r=this.visibleColumn,s=this.collectColumn,a=this.isGroup,c=this.hasFilter,u=this.isResizable,h=this.isCtxMenu,d=this.loading,f=this.stripe,p=this._isLoading,g=this.showHeader,v=this.headerHeight,m=this.height,x=this.border,w=this.treeOpts,b=this.treeConfig,C=this.mouseConfig,T=this.mouseOpts,_=this.vSize,R=this.validOpts,y=this.editRules,S=this.showFooter,E=this.footerMethod,O=this.overflowX,k=this.overflowY,D=this.scrollXLoad,U=this.scrollYLoad,I=this.scrollbarHeight,$=this.highlightHoverRow,F=this.highlightHoverColumn,M=this.editConfig,L=this.checkboxOpts,A=this.optimizeOpts,z=this.vaildTipOpts,P=this.tooltipOpts,j=this.columnStore,H=this.filterStore,B=this.ctxMenuStore,N=this.footerData,W=this.hasTip,X=j.leftList,V=j.rightList;return e("div",{class:["vxe-table","tid_".concat(i),_?"size--".concat(_):"",x&&_xeUtils.default.isString(x)?"b--style-".concat(x):"",{"vxe-editable":M,"show--head":g,"show--foot":S,"is--group":a,"has--height":m,"has--tree-line":b&&w.line,"fixed--left":X.length,"fixed--right":V.length,"t--animat":A.animat,"t--stripe":f,"t--border":x,"t--selected":C&&T.selected,"t--checked":C&&T.checked,"row--highlight":$,"column--highlight":F,"is--cover":o,"scroll--y":k,"scroll--x":O,"virtual--x":D,"virtual--y":U}]},[e("div",{class:"vxe-table-hidden-column",ref:"hideColumn"},this.$slots.default),e("div",{class:"vxe-table--main-wrapper"},[g?e("vxe-table-header",{ref:"tableHeader",props:{tableData:l,tableColumn:n,visibleColumn:r,collectColumn:s,size:_,isGroup:a}}):t(),e("vxe-table-body",{ref:"tableBody",props:{tableData:l,tableColumn:n,visibleColumn:r,collectColumn:s,size:_,isGroup:a}}),S?e("vxe-table-footer",{props:{footerData:N,footerMethod:E,tableColumn:n,visibleColumn:r,size:_},ref:"tableFooter"}):null]),X&&X.length&&O?renderFixed(e,this,"left"):t(),V&&V.length&&O?renderFixed(e,this,"right"):t(),d||l.length?t():e("div",{ref:"emptyPlaceholder",class:"vxe-table--empty-placeholder",style:m?null:{top:"".concat(v,"px")}},[e("div",{class:"vxe-table--empty-content"},this.$scopedSlots.empty?this.$scopedSlots.empty.call(this,{$table:this},e):_conf.default.i18n("vxe.table.emptyText"))]),u?e("div",{class:"vxe-table--resizable-bar",style:O?{"padding-bottom":"".concat(I,"px")}:null,ref:"resizeBar"}):t(),e("div",{class:"vxe-table--border-line"}),p?e("vxe-table-loading",{props:{visible:d}}):t(),c?e("vxe-table-filter",{props:{optimizeOpts:A,filterStore:H},ref:"filterWrapper"}):t(),_vXETable.default._export?e("vxe-import-panel",{props:{defaultOptions:this.importParams,storeData:this.importStore},on:{import:this.confirmImportEvent}}):t(),_vXETable.default._export?e("vxe-export-panel",{props:{defaultOptions:this.exportParams,storeData:this.exportStore},on:{print:this.confirmPrintEvent,export:this.confirmExportEvent}}):t(),e("div",{class:"vxe-table".concat(i,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[L.range?e("div",{class:"vxe-table--checkbox-range",ref:"checkboxRange"}):t(),h?e("vxe-table-context-menu",{props:{ctxMenuStore:B},ref:"ctxWrapper"}):t(),W?e("vxe-tooltip",{ref:"tooltip",props:P,on:P.enterable?{leave:this.handleTooltipLeaveEvent}:null}):t(),W&&y&&("default"===R.message?!m:"tooltip"===R.message)?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===R.message||1===l.length?z:null,ref:"validTip"}):t()])])},methods:{getParentElem:function(){return this.$grid?this.$grid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$grid?this.$grid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$grid?this.$grid.getExcludeHeight():0},clearAll:function(){return this.inited=!1,this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearCheckboxRow(),this.clearCheckboxReserve(),this.clearRowExpand(),this.clearTreeExpand(),this.clearChecked(),this.clearSelected(),this.clearActived(),this.clearScroll()},refreshData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,i=this.scrollYStore,o=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?o.slice(i.startIndex,i.startIndex+i.renderSize):o.slice(0),this.$nextTick()},loadTableData:function(e){var t=this,i=this.height,o=this.maxHeight,l=this.showOverflow,n=this.treeConfig,r=this.editStore,s=this.optimizeOpts,a=this.scrollYStore,c=s.scrollY,u=e?e.slice(0):[],h=!n&&c&&c.gt&&c.gt<u.length;return a.startIndex=0,a.visibleIndex=0,r.insertList=[],r.removeList=[],this.tableFullData=u,this.updateCache(!0),this.tableSynchData=e,this.tableSourceData=_xeUtils.default.clone(u,!0),!(this.scrollYLoad=h)||i||o||_tools.UtilTools.error("vxe.error.reqProp",["height | max-height"]),h&&!l&&_tools.UtilTools.warn("vxe.error.reqProp",["show-overflow"]),this.handleTableData(!0),this.computeScrollLoad().then(function(){return t.isLoadData=!0,t.computeRowHeight(),t.handleReserveStatus(),t.checkSelectionStatus(),t.$nextTick().then(t.recalculate).then(t.refreshScroll)})},loadData:function(e){return this.inited=!0,this.loadTableData(e)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.inited=!0,t.loadTableData(e)}).then(this.handleDefaults)},reloadRow:function(e,t,i){var o=this.tableSourceData,l=this.tableData,n=this.getRowIndex(e),r=o[n];return r&&e&&(i?_xeUtils.default.set(r,i,_xeUtils.default.get(t||e,i)):t?(o[n]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(r,_xeUtils.default.clone(e,!0))),this.tableData=l.slice(0),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(l){function e(e,t){var i=_tools.UtilTools.getRowid(n,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,h,i)),d&&e[r.hasChild]&&_xeUtils.default.isUndefined(e[r.children])&&(e[r.children]=null);var o={row:e,rowid:i,index:t};l&&(s[i]=o,a.set(e,o)),u[i]=o,c.set(e,o)}var n=this,t=this.treeConfig,r=this.treeOpts,i=this.tableFullData,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,u=this.fullAllDataRowIdData,h=_tools.UtilTools.getRowkey(this),d=t&&r.lazy;l&&(s=this.fullDataRowIdData={},a.clear()),u=this.fullAllDataRowIdData={},c.clear(),t?_xeUtils.default.eachTree(i,e,r):i.forEach(e)},appendTreeCache:function(e,t){var l=this,i=this.tableSourceData,o=this.treeOpts,n=this.fullDataRowIdData,r=this.fullDataRowMap,s=this.fullAllDataRowMap,a=this.fullAllDataRowIdData,c=o.children,u=o.hasChild,h=_tools.UtilTools.getRowkey(this),d=_tools.UtilTools.getRowid(this,e),f=_xeUtils.default.findTree(i,function(e){return d===_tools.UtilTools.getRowid(l,e)},o);_xeUtils.default.eachTree(t,function(e,t){var i=_tools.UtilTools.getRowid(l,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,h,i)),e[u]&&_xeUtils.default.isUndefined(e[c])&&(e[c]=null);var o={row:e,rowid:i,index:t};n[i]=o,r.set(e,o),a[i]=o,s.set(e,o)},o),f&&(f.item[c]=_xeUtils.default.clone(t,!0))},cacheColumnMap:function(){var e=this.isGroup,t=this.tableFullColumn,i=this.collectColumn,o=this.fullColumnMap,l=this.fullColumnIdData={};o.clear(),e&&_xeUtils.default.eachTree(i,function(e,t){if(e.children&&e.children.length){var i={column:e,colid:e.id,index:t};l[e.id]=i,o.set(e,i)}},headerProps),t.forEach(function(e,t){var i={column:e,colid:e.id,index:t};l[e.id]=i,o.set(e,i)},headerProps)},getRowNode:function(e){var t=this;if(e){var i=this.treeConfig,o=this.treeOpts,l=this.tableFullData,n=this.fullAllDataRowIdData,r=e.getAttribute("data-rowid");if(i){var s=_xeUtils.default.findTree(l,function(e){return _tools.UtilTools.getRowid(t,e)===r},o);if(s)return s}else if(n[r]){var a=n[r];return{item:a.row,index:a.index,items:l}}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData,i=this.tableFullColumn,o=t[e.getAttribute("data-colid")];return{item:o.column,index:o.index,items:i}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},$getRowIndex:function(e){return this.afterFullData.indexOf(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},$getColumnIndex:function(e){return this.visibleColumn.indexOf(e)},isSeqColumn:function(e){return e&&("seq"===e.type||"index"===e.type)},insert:function(e){return this.insertAt(e)},insertAt:function(e,t){var i=this,o=this.afterFullData,l=this.editStore,n=this.scrollYLoad,r=this.tableFullData;if(this.treeConfig)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["insert"]));_xeUtils.default.isArray(e)||(e=[e]);var s=o,a=e.map(function(e){return i.defineField(Object.assign({},e))});if(t)if(-1===t)s.push.apply(s,a),r.push.apply(r,a);else{var c=s.indexOf(t);if(-1===c)throw new Error(_tools.UtilTools.error("vxe.error.unableInsert"));s.splice.apply(s,[c,0].concat(a)),r.splice.apply(r,[r.indexOf(t),0].concat(a))}else s.unshift.apply(s,a),r.unshift.apply(r,a);return[].unshift.apply(l.insertList,a),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),n&&this.updateScrollYSpace(),this.$nextTick().then(function(){return i.recalculate(),{row:a.length?a[a.length-1]:null,rows:a}})},defineField:function(o){var e=this.treeConfig,t=this.treeOpts,i=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,i=e.editRender;t&&!_xeUtils.default.has(o,t)&&_xeUtils.default.set(o,t,i&&!_xeUtils.default.isUndefined(i.defaultValue)?i.defaultValue:null)}),e&&t.lazy&&_xeUtils.default.isUndefined(o[t.children])&&(o[t.children]=null),_xeUtils.default.get(o,i)||_xeUtils.default.set(o,i,getRowUniqueId()),o},createData:function(e){var t=this;return this.$nextTick().then(function(){return e.map(t.defineField)})},createRow:function(t){var i=this,o=_xeUtils.default.isArray(t);return o||(t=[t]),this.$nextTick().then(function(){var e=t.map(function(e){return i.defineField(Object.assign({},e))});return o?e:e[0]})},remove:function(t){var e=this,i=this.afterFullData,o=this.tableFullData,l=this.editStore,n=this.treeConfig,r=this.checkboxOpts,s=this.selection,a=this.hasInsertByRow,c=this.scrollYLoad,u=l.removeList,h=l.insertList,d=r.checkField||r.checkProp,f=[],p=i;if(n)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["remove"]));return t?_xeUtils.default.isArray(t)||(t=[t]):t=o,t.forEach(function(e){a(e)||u.push(e)}),d||_xeUtils.default.remove(s,function(e){return-1<t.indexOf(e)}),o===t?(t=f=o.slice(0),o.length=0,p.length=0):(f=_xeUtils.default.remove(o,function(e){return-1<t.indexOf(e)}),_xeUtils.default.remove(p,function(e){return-1<t.indexOf(e)})),_xeUtils.default.remove(h,function(e){return-1<t.indexOf(e)}),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),c&&this.updateScrollYSpace(),this.$nextTick().then(function(){return e.recalculate(),{row:f&&f.length?f[f.length-1]:null,rows:f}})},removeSelecteds:function(){var t=this;return this.remove(this.getCheckboxRecords()).then(function(e){return t.clearCheckboxRow(),e})},revert:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["revert","revertData"]),this.revertData.apply(this,arguments)},revertData:function(e,o){var l=this.tableSourceData,n=this.tableFullData;return arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=n.indexOf(e),i=l[t];i&&e&&(o?_xeUtils.default.set(e,o,_xeUtils.default.clone(_xeUtils.default.get(i,o),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(i,!0)))}),this.$nextTick()):this.reloadData(l)},clearData:function(e,t){var i=this.tableSourceData,o=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=i,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){o.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},hasInsertByRow:function(t){var e=this.treeConfig,i=this.treeOpts,o=this.tableSourceData;return e?_xeUtils.default.findTree(o,function(e){return e===t},i):-1===this.getRowIndex(t)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var i,o,l=this,n=this.visibleColumn,r=this.treeConfig,s=this.treeOpts,a=this.tableSourceData,c=this.fullDataRowIdData,u=_tools.UtilTools.getRowid(this,e);if(!c[u])return!1;if(r){var h=s.children,d=_xeUtils.default.findTree(a,function(e){return u===_tools.UtilTools.getRowid(l,e)},s);e=Object.assign({},e,_defineProperty({},h,null)),d&&(i=Object.assign({},d.item,_defineProperty({},h,null)))}else{i=a[c[u].index]}if(i){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(i,t),_xeUtils.default.get(e,t));for(var f=0,p=n.length;f<p;f++)if((o=n[f].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(i,o),_xeUtils.default.get(e,o)))return!0}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColid:function(e){var t=this.fullColumnMap;return t.has(e)?t.get(e).colid:null},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(t){return _xeUtils.default.find(this.tableFullColumn,function(e){return e.property===t})},getTableColumn:function(){return{fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getRecordset:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){var t=this.editStore.insertList,i=[];return t.length&&this.tableFullData.forEach(function(e){-1<t.indexOf(e)&&i.push(e)}),i},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){return this.getCheckboxRecords()},getCheckboxRecords:function(){var e=this.tableFullData,t=this.treeConfig,i=this.treeOpts,o=this.checkboxOpts.checkField,l=[];if(o)l=t?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,o)},i):e.filter(function(e){return _xeUtils.default.get(e,o)});else{var n=this.selection;l=t?_xeUtils.default.filterTree(e,function(e){return-1<n.indexOf(e)},i):e.filter(function(e){return-1<n.indexOf(e)})}return l},getUpdateRecords:function(){var e=this.tableFullData,t=this.isUpdateByRow,i=this.treeConfig,o=this.treeOpts;return i?_xeUtils.default.filterTree(e,function(e){return t(e)},o):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,i=this.remoteSort,c=this.remoteFilter,u=this.filterOpts,o=this.sortOpts,l=t.slice(0),n=_xeUtils.default.find(e,function(e){return e.order}),r=[];if(e.forEach(function(e){if(e.filters&&e.filters.length){var t=[],i=[];e.filters.forEach(function(e){e.checked&&(i.push(e),t.push(e.value))}),r.push({column:e,valueList:t,itemList:i})}}),r.length&&(l=l.filter(function(a){return r.every(function(e){var t=e.column,i=e.valueList,o=e.itemList;if(!i.length||u.remote||c)return!0;var l=t.filterRender,n=t.property,r=t.filterMethod,s=l?_vXETable.Renderer.get(l.name):null;return!r&&s&&s.renderFilter&&(r=s.filterMethod),r?o.some(function(e){return r({value:e.value,option:e,row:a,column:t})}):-1<i.indexOf(_xeUtils.default.get(a,n))})})),n&&n.order){var s=o.sortMethod||this.sortMethod;if(!(_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:o.remote||i))if(s)l=s({data:l,column:n,property:n.property,order:n.order,$table:this})||l;else{var a=n.sortMethod?l.sort(n.sortMethod):_xeUtils.default.sortBy(l,n.property);l="desc"===n.order?a.reverse():a}}return this.afterFullData=l},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,i=this.tableData,o=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:i.slice(0),footerData:o.slice(0)}},handleDefaults:function(){(this.checkboxConfig||this.selectConfig)&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(i){this.isUpdateCustoms=!0,this.tableFullColumn.forEach(function(t){var e=_xeUtils.default.find(i,function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.$emit("update:customs",this.tableFullColumn)},resetAll:function(){this.resetCustoms(),this.resetResizable()},hideColumn:function(e){return this.handleVisibleColumn(e,!1)},showColumn:function(e){return this.handleVisibleColumn(e,!0)},resetCustoms:function(){return this.handleVisibleColumn()},handleVisibleColumn:function(e,t){return arguments.length?e.visible=t:this.tableFullColumn.forEach(function(e){e.visible=!0}),this.$toolbar&&this.$toolbar.handleCustoms(),this.$nextTick()},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var i,e=this,o=0,l=[],n=null,r=null,s=[],a=[],t=this.collectColumn,c=this.tableFullColumn,u=this.isGroup,h=this.columnStore,d=this.scrollXStore,f=this.optimizeOpts.scrollX;u&&_xeUtils.default.eachTree(t,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),c.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(null===n&&(n=o),i||(t-o!=0?i=!0:o++),l.push(e)):"right"===e.fixed?(i||(null===r&&(r=t),t-r!=0?i=!0:r++),a.push(e)):s.push(e)});var p=l.concat(s).concat(a),g=f&&f.gt&&f.gt<c.length;return Object.assign(h,{leftList:l,centerList:s,rightList:a}),u&&(i||n||null!==r&&r!==p.length)&&_tools.UtilTools.error("vxe.error.groupFixed"),g&&(this.isGroup&&_tools.UtilTools.warn("vxe.error.scrollXNotGroup"),this.showHeader&&!this.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-header-overflow"]),d.startIndex=0,d.visibleIndex=0,p=p.slice(d.startIndex,d.startIndex+d.renderSize)),this.scrollXLoad=g,this.tableColumn=p,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,i=this.columnMinWidth,o=[],l=[],n=[],r=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),i&&!e.minWidth&&(e.minWidth=i),e.visible&&(e.resizeWidth?o.push(e):_tools.DomTools.isPx(e.width||t)?l.push(e):_tools.DomTools.isScale(e.width||t)?r.push(e):_tools.DomTools.isPx(e.minWidth||i)?n.push(e):_tools.DomTools.isScale(e.minWidth||i)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:o,pxList:l,pxMinList:n,scaleList:r,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,i=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||i)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,i)})},recalculate:function(e){var t=this,i=this.$refs,o=i.tableBody,l=i.tableHeader,n=i.tableFooter,r=o?o.$el:null,s=l?l.$el:null,a=n?n.$el:null;if(r){var c=r.clientWidth;if(this.autoCellWidth(s,r,a,c),!0===e)return this.computeScrollLoad().then(function(){c=r.clientWidth,t.autoCellWidth(s,r,a,c),t.computeScrollLoad()})}return this.computeScrollLoad()},autoCellWidth:function(e,t,i,o){var l,n=0,r=o,s=this.fit,a=this.columnStore,c=a.resizeList,u=a.pxMinList,h=a.pxList,d=a.scaleList,f=a.scaleMinList,p=a.autoList;if(u.forEach(function(e){var t=parseInt(e.minWidth);n+=t,e.renderWidth=t}),l=r/100,f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*l);n+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*l);n+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);n+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);n+=t,e.renderWidth=t}),l=0<(r-=n)?Math.floor(r/(f.length+u.length+p.length)):0,s?0<r&&f.concat(u).forEach(function(e){n+=l,e.renderWidth+=l}):l=40,p.forEach(function(e,t){var i=Math.max(l,40);e.renderWidth=i,n+=i}),s){var g=d.concat(f).concat(u).concat(p),v=g.length-1;if(0<v){var m=o-n;if(0<m){for(;0<m&&0<=v;)m--,g[v--].renderWidth++;n=o}}}var x=t.offsetHeight,w=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=w?t.offsetWidth-o:0,this.overflowY=w,this.tableWidth=n,this.tableHeight=x,this.isCoverBody=o-2<=n,this.parentHeight=this.getParentHeight(),e&&(this.headerHeight=e.clientHeight),i){var b=i.offsetHeight;this.scrollbarHeight=Math.max(b-i.clientHeight,0),this.overflowX=n>i.clientWidth,this.footerHeight=b}else this.scrollbarHeight=Math.max(x-t.clientHeight,0),this.overflowX=o<n;return this.overflowX&&this.checkScrolling(),n},resetResizable:function(){return this.tableFullColumn.forEach(function(e){e.resizeWidth=0}),this.$toolbar&&this.$toolbar.resetResizable(),this.analyColumnWidth(),this.recalculate(!0)},checkScrolling:function(){var e=this.$refs,t=e.tableBody,i=e.leftBody,o=e.rightBody,l=t?t.$el:null;l&&(i&&(this.scrollLeftToRight=0<l.scrollLeft),o&&(this.scrollRightToLeft=l.clientWidth<l.scrollWidth-Math.ceil(l.scrollLeft)))},preventEvent:function(t,e,i,o,l){var n,r=this;return _vXETable.Interceptor.get(e).some(function(e){return!1===e(i,t,r)})||o&&(n=o()),l&&l(),n},handleGlobalMousedownEvent:function(i){var o=this,l=this.$el,e=this.$refs,t=this.mouseConfig,n=this.mouseOpts,r=this.editStore,s=this.ctxMenuStore,a=this.editOpts,c=this.filterStore,u=this.getRowNode,h=r.actived,d=e.filterWrapper,f=e.validTip;d&&(_tools.DomTools.getEventTargetNode(i,this.$el,"vxe-filter-wrapper").flag||_tools.DomTools.getEventTargetNode(i,d.$el).flag||this.preventEvent(i,"event.clearFilter",c.args,this.closeFilter)),h.row?!1!==a.autoClear&&(f&&_tools.DomTools.getEventTargetNode(i,f.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(i,"event.clearActived",h.args,function(){var e;if("row"===a.mode){var t=_tools.DomTools.getEventTargetNode(i,l,"vxe-body--row");e=!!t.flag&&u(t.targetElem).item!==u(h.args.cell.parentNode).item}else e=!_tools.DomTools.getEventTargetNode(i,l,"col--edit").flag;!(e=(e=e||_tools.DomTools.getEventTargetNode(i,l,"vxe-header--row").flag)||_tools.DomTools.getEventTargetNode(i,l,"vxe-footer--row").flag)&&_tools.DomTools.getEventTargetNode(i,o.$el).flag||setTimeout(function(){return o.clearActived(i)})})):t&&(_tools.DomTools.getEventTargetNode(i,l).flag||(n.checked&&(this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked()),this.clearSelected())),s.visible&&this.$refs.ctxWrapper&&!_tools.DomTools.getEventTargetNode(i,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=_tools.DomTools.getEventTargetNode(i,(this.$grid||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(L){var A=this;this.isActivated&&this.preventEvent(L,"event.keydown",{$table:this},function(){var e,t=A.isCtxMenu,i=A.ctxMenuStore,o=A.editStore,l=A.mouseConfig,n=void 0===l?{}:l,r=A.keyboardConfig,s=void 0===r?{}:r,a=A.treeConfig,c=A.treeOpts,u=A.highlightCurrentRow,h=A.currentRow,d=o.selected,f=o.actived,p=L.keyCode,g=8===p,v=9===p,m=13===p,x=27===p,w=32===p,b=37===p,C=38===p,T=39===p,_=40===p,R=46===p,y=67===p,S=86===p,E=88===p,O=113===p,k=L.ctrlKey,D=L.shiftKey,U=b||C||T||_,I=t&&i.visible&&(m||w||U);if(x)A.closeMenu(),A.closeFilter(),f.row&&(e=f.args,A.clearActived(L),n.selected&&A.handleSelected(e,L));else if(w&&(s.isArrow||s.isTab)&&d.row&&d.column&&("checkbox"===d.column.type||"selection"===d.column.type||"radio"===d.column.type))L.preventDefault(),"checkbox"===d.column.type||"selection"===d.column.type?A.handleToggleCheckRowEvent(d.args,L):A.triggerRadioRowEvent(L,d.args);else if(m&&s.isEnter&&(d.row||f.row||a&&u&&h)){if(d.row||f.row)A.moveSelected(d.row?d.args:f.args,b,C,T,!0,L);else if(a&&u&&h){var $=h[c.children];if($&&$.length){L.preventDefault();var F=$[0];e={$table:A,row:F},A.setTreeExpansion(h,!0).then(function(){return A.scrollToRow(F)}).then(function(){return A.triggerCurrentRowEvent(L,e)})}}}else if(I)L.preventDefault(),i.showChild&&_tools.UtilTools.hasChildrenList(i.selected)?A.moveCtxMenu(L,p,i,"selectChild",37,!1,i.selected.children):A.moveCtxMenu(L,p,i,"selected",39,!0,A.ctxMenuList);else if(O)d.row&&d.column&&(L.preventDefault(),A.handleActived(d.args,L));else if(U&&s.isArrow)d.row&&d.column?A.moveSelected(d.args,b,C,T,_,L):(C||_)&&u&&h&&A.moveCurrentRow(C,_,L);else if(v&&s.isTab)d.row||d.column?A.moveTabSelected(d.args,D,L):(f.row||f.column)&&A.moveTabSelected(f.args,D,L);else if(R||(a&&u&&h?g&&s.isArrow:g)){if(s.isDel&&(d.row||d.column))_tools.UtilTools.setCellValue(d.row,d.column,null),g&&A.handleActived(d.args,L);else if(g&&s.isArrow&&a&&u&&h){var M=_xeUtils.default.findTree(A.afterFullData,function(e){return e===h},c).parent;M&&(L.preventDefault(),e={$table:A,row:M},A.setTreeExpansion(M,!1).then(function(){return A.scrollToRow(M)}).then(function(){return A.triggerCurrentRowEvent(L,e)}))}}else s.isCut&&k&&(E||y||S)?E||y?A.handleCopyed(E,L):A.handlePaste(L):s.isEdit&&!k&&(48<=p&&p<=57||65<=p&&p<=90||96<=p&&p<=111||186<=p&&p<=192||219<=p&&p<=222||32===p)&&(d.row||d.column)&&(s.editMethod&&!1===s.editMethod(d.args,L)||(_tools.UtilTools.setCellValue(d.row,d.column,null),A.handleActived(d.args,L)))})},moveTabSelected:function(e,t,i){var o,l,n,r,s=this.afterFullData,a=this.visibleColumn,c=this.editConfig,u=this.editOpts,h=this.isSeqColumn,d=Object.assign({},e),f=s.indexOf(d.row),p=a.indexOf(d.column);if(i.preventDefault(),t){for(var g=p-1;0<=g;g--)if(!h(a[g])){n=a[r=g];break}if(!n&&0<f){o=s[l=f-1];for(var v=a.length-1;0<=v;v--)if(!h(a[v])){n=a[r=v];break}}}else{for(var m=p+1;m<a.length;m++)if(!h(a[m])){n=a[r=m];break}if(!n&&f<s.length-1){o=s[l=f+1];for(var x=0;x<a.length;x++)if(!h(a[x])){n=a[r=x];break}}}n&&(o?(d.rowIndex=l,d.row=o):d.rowIndex=f,d.columnIndex=r,d.column=n,d.cell=_tools.DomTools.getCell(this,d),c&&("click"!==u.trigger&&"dblclick"!==u.trigger||("row"===u.mode?this.handleActived(d,i):(this.handleSelected(d,i),this.scrollToRow(d.row,d.column)))))},moveCurrentRow:function(e,t,i){var o,l=this,n=this.currentRow,r=this.treeConfig,s=this.treeOpts,a=this.afterFullData;if(i.preventDefault(),r){var c=_xeUtils.default.findTree(a,function(e){return e===n},s),u=c.index,h=c.items;e&&0<u?o=h[u-1]:t&&u<h.length-1&&(o=h[u+1])}else{var d=a.indexOf(n);e&&0<d?o=a[d-1]:t&&d<a.length-1&&(o=a[d+1])}if(o){var f={$table:this,row:o};this.scrollToRow(o).then(function(){return l.triggerCurrentRowEvent(i,f)})}},moveSelected:function(e,t,i,o,l,n){var r=this.afterFullData,s=this.visibleColumn,a=Object.assign({},e);if(n.preventDefault(),i&&a.rowIndex)--a.rowIndex,a.row=r[a.rowIndex];else if(l&&a.rowIndex<r.length-1)a.rowIndex+=1,a.row=r[a.rowIndex];else if(t&&a.columnIndex){for(var c=a.columnIndex-1;0<=c;c--)if(s[c].editRender){a.columnIndex=c,a.column=s[c];break}}else if(o&&a.columnIndex)for(var u=a.columnIndex+1;u<s.length;u++)if(s[u].editRender){a.columnIndex=u,a.column=s[u];break}a.cell=_tools.DomTools.getCell(this,a),this.handleSelected(a,n),this.scrollToRow(a.row,a.column)},moveCtxMenu:function(e,t,i,o,l,n,r){var s,a=_xeUtils.default.findIndexOf(r,function(e){return i[o]===e});if(t===l)n&&_tools.UtilTools.hasChildrenList(i.selected)?i.showChild=!0:(i.showChild=!1,i.selectChild=null);else if(38===t){for(var c=a-1;0<=c;c--)if(!1!==r[c].visible){s=r[c];break}i[o]=s||r[r.length-1]}else if(40===t){for(var u=a+1;u<r.length;u++)if(!1!==r[u].visible){s=r[u];break}i[o]=s||r[0]}else!i[o]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,i[o])},handleGlobalResizeEvent:function(){this.closeMenu(),this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.id,i=this.isCtxMenu,o=this.ctxMenuStore,l=this.ctxMenuOpts,n=["header","body","footer"];if(i){if(o.visible&&o.visible&&this.$refs.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var r=0;r<n.length;r++){var s=n[r],a=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(s,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===t}),c={type:s,$table:this,columns:this.visibleColumn.slice(0)};if(a.flag){var u=a.targetElem,h=this.getColumnNode(u).item,d="".concat(s,"-");if(Object.assign(c,{column:h,columnIndex:this.getColumnIndex(h),cell:u}),"body"===s){var f=this.getRowNode(u.parentNode).item;d="",c.row=f,c.rowIndex=this.getRowIndex(f)}return this.openContextMenu(e,s,c),void _tools.UtilTools.emitEvent(this,"".concat(d,"cell-context-menu"),[c,e])}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(s,"-wrapper"),function(e){return e.getAttribute("data-tid")===t}).flag)return void("cell"===l.trigger?e.preventDefault():this.openContextMenu(e,s,c))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(h,e,t){var d=this,f=this.ctxMenuStore,i=this.ctxMenuOpts,o=i[e],l=i.visibleMethod;if(o){var p=o.options;o.disabled?h.preventDefault():p&&p.length&&(t.options=p,this.preventEvent(h,"event.showMenu",t,null,function(){if(!l||l(t,h)){h.preventDefault(),d.updateZindex();var e=_tools.DomTools.getDomNode(),n=e.scrollTop,r=e.scrollLeft,s=e.visibleHeight,a=e.visibleWidth,c=h.clientY+n,u=h.clientX+r;Object.assign(f,{args:t,visible:!0,list:p,selected:null,selectChild:null,showChild:!1,childPos:null,style:{zIndex:d.tZindex,top:"".concat(c,"px"),left:"".concat(u,"px")}}),d.$nextTick(function(){var e=d.$refs.ctxWrapper.$el,t=e.clientHeight,i=e.clientWidth,o=h.clientY+t-s,l=h.clientX+i-a;-10<o&&(f.style.top="".concat(Math.max(n+2,c-t-2),"px")),-10<l&&(f.style.left="".concat(Math.max(r+2,u-i-2),"px")),-220<l&&(f.childPos="left")})}else d.closeMenu()}))}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,childPos:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,i){var o=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),o.selected=t,(o.selectChild=i)||(o.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t){var i=this.ctxMenuStore;t.children||(i.selected=null),i.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var i=_vXETable.Menus.get(t.code),o=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);i&&i.call(this,o,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t,$table:this},this.ctxMenuStore.args),e]),this.closeMenu()}},handleTooltipLeaveEvent:function(){var e=this,t=this.tooltipOpts;setTimeout(function(){e.tooltipActive||e.clostTooltip()},t.leaveDelay)},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts;this.tooltipActive=!1,t.enterable?this.tooltipTimeout=setTimeout(function(){e.$refs.tooltip.isHover||e.clostTooltip()},t.leaveDelay):this.clostTooltip()},triggerHeaderTooltipEvent:function(e,t){var i=this.tooltipStore,o=t.column;this.handleTargetEnterEvent(),i.column===o&&i.visible||this.handleTooltip(e,o)},triggerFooterTooltipEvent:function(e,t){var i=t.column,o=this.tooltipStore;this.handleTargetEnterEvent(),o.column===i&&o.visible||this.handleTooltip(e,i)},triggerTooltipEvent:function(e,t){var i=this.editConfig,o=this.editOpts,l=this.editStore,n=this.tooltipStore,r=l.actived,s=t.row,a=t.column;this.handleTargetEnterEvent(),i&&("row"===o.mode&&r.row===s||r.row===s&&r.column===a)||n.column===a&&n.row===s&&n.visible||this.handleTooltip(e,a,s)},handleTooltip:function(e,t,i){var o=e.currentTarget,l=this.$refs.tooltip,n=o.children[0],r=o.innerText;return r&&n.scrollWidth>n.clientWidth&&(Object.assign(this.tooltipStore,{row:i,column:t,visible:!0}),l&&l.toVisible(o,r)),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleDefaultSelectionChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxOpts,i=e.checkAll,o=e.checkRowKeys;if(i)this.setAllCheckboxRow(!0);else if(o){var l=[];o.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setCheckboxRow(l,!0)}},setSelection:function(e,t){return this.setCheckboxRow(e,t)},setCheckboxRow:function(e,t){var i=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return i.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["isCheckedByRow","isCheckedByCheckboxRow"]),this.isCheckedByCheckboxRow(e)},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,i){var o=this,l=e.row,n=this.selection,t=this.tableFullData,r=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,c=this.checkboxOpts,u=c.checkStrictly,h=c.checkMethod,d=c.checkField||c.checkProp;if(d)if(r&&!u){-1===i?(a.push(l),_xeUtils.default.set(l,d,!1)):(_xeUtils.default.eachTree([l],function(e,t){l!==e&&h&&!h({row:e,$rowIndex:t})||(_xeUtils.default.set(e,d,i),o.handleSelectReserveRow(l,i))},s),_xeUtils.default.remove(a,function(e){return e===l}));var f=_xeUtils.default.findTree(t,function(e){return e===l},s);if(f&&f.parent){var p,g=h?f.items.filter(function(e,t){return h({row:e,$rowIndex:t})}):f.items;if(_xeUtils.default.find(f.items,function(e){return-1<a.indexOf(e)}))p=-1;else{var v=f.items.filter(function(e){return _xeUtils.default.get(e,d)});p=v.filter(function(e){return-1<g.indexOf(e)}).length===g.length||!(!v.length&&-1!==i)&&-1}return this.handleSelectRow({row:f.parent},p)}}else _xeUtils.default.set(l,d,i),this.handleSelectReserveRow(l,i);else if(r&&!u){-1===i?(a.push(l),_xeUtils.default.remove(n,function(e){return e===l})):(_xeUtils.default.eachTree([l],function(t,e){l!==t&&h&&!h({row:t,$rowIndex:e})||(i?n.push(t):_xeUtils.default.remove(n,function(e){return e===t}),o.handleSelectReserveRow(l,i))},s),_xeUtils.default.remove(a,function(e){return e===l}));var m=_xeUtils.default.findTree(t,function(e){return e===l},s);if(m&&m.parent){var x,w=h?m.items.filter(function(e,t){return h({row:e,$rowIndex:t})}):m.items;if(_xeUtils.default.find(m.items,function(e){return-1<a.indexOf(e)}))x=-1;else{var b=m.items.filter(function(e){return-1<n.indexOf(e)});x=b.filter(function(e){return-1<w.indexOf(e)}).length===w.length||!(!b.length&&-1!==i)&&-1}return this.handleSelectRow({row:m.parent},x)}}else i?-1===n.indexOf(l)&&n.push(l):_xeUtils.default.remove(n,function(e){return e===l}),this.handleSelectReserveRow(l,i);this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var i=this.selection,o=this.checkboxOpts.checkField,l=e.row,n=o?!_xeUtils.default.get(l,o):-1===i.indexOf(l);t?this.triggerCheckRowEvent(t,e,n):this.handleSelectRow(e,n)},triggerCheckRowEvent:function(e,t,i){var o=this.checkboxOpts.checkMethod;o&&!o({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})||(this.handleSelectRow(t,i),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),checked:i,$table:this},t),e]))},toggleRowSelection:function(e){return this.toggleCheckboxRow(e)},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(e){return this.setAllCheckboxRow(e)},setAllCheckboxRow:function(o){var i=this,t=this.afterFullData,e=this.treeConfig,l=this.treeOpts,n=this.selection,r=this.selectReserveRowMap,s=this.checkboxOpts,a=s.reserve,c=s.checkStrictly,u=s.checkMethod,h=s.checkField||s.checkProp,d=[],f=e?[]:n.filter(function(e){return-1===t.indexOf(e)});if(!c){if(h){var p="".concat(e?"$":"","rowIndex"),g=function(e,t){var i;u&&!u((_defineProperty(i={row:e},p,t),_defineProperty(i,"$rowIndex",t),i))||_xeUtils.default.set(e,h,o)},v=function(e,t){var i;(!u||!u((_defineProperty(i={row:e},p,t),_defineProperty(i,"$rowIndex",t),i))&&-1<n.indexOf(e))&&_xeUtils.default.set(e,h,o)};e?_xeUtils.default.eachTree(t,o?g:v,l):t.forEach(o?g:v)}else e?o?_xeUtils.default.eachTree(t,function(e,t){u&&!u({row:e,$rowIndex:t})||d.push(e)},l):u&&_xeUtils.default.eachTree(t,function(e,t){!u({row:e,$rowIndex:t})&&-1<n.indexOf(e)&&d.push(e)},l):o?d=u?t.filter(function(e,t){return-1<n.indexOf(e)||u({row:e,rowIndex:t,$rowIndex:t})}):t.slice(0):u&&(d=t.filter(function(e,t){return u({row:e,rowIndex:t,$rowIndex:t})?0:-1<n.indexOf(e)}));a&&(o?d.forEach(function(e){r[_tools.UtilTools.getRowid(i,e)]=e}):t.forEach(function(e){var t=_tools.UtilTools.getRowid(i,e);r[t]&&delete r[t]})),this.selection=f.concat(d)}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,i=this.selection,t=this.treeIndeterminates,o=this.checkboxOpts,l=o.checkStrictly,n=o.checkMethod,r=o.checkField||o.checkProp;l||(r?(this.isAllSelected=e.length&&e.every(n?function(e,t){return!n({row:e,rowIndex:t,$rowIndex:t})||_xeUtils.default.get(e,r)}:function(e){return _xeUtils.default.get(e,r)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,r)||-1<t.indexOf(e)})):(this.isAllSelected=e.length&&e.every(n?function(e,t){return!n({row:e,rowIndex:t,$rowIndex:t})||-1<i.indexOf(e)}:function(e){return-1<i.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<t.indexOf(e)||-1<i.indexOf(e)})))},handleReserveStatus:function(){var e=this.rowId,t=this.treeConfig,i=this.fullDataRowIdData,o=this.selectReserveRowMap,l=this.checkboxOpts,n=[],r=[],s=[],a=[];e&&this.handleReserveByRowid(this.selection,n),l.reserve&&Object.keys(o).forEach(function(e){i[e]&&-1===n.indexOf(i[e].row)&&n.push(i[e].row)}),this.selection=n,e&&this.handleReserveByRowid(this.rowExpandeds,r),this.rowExpandeds=r,e&&t&&(this.handleReserveByRowid(this.treeIndeterminates,a),this.handleReserveByRowid(this.treeExpandeds,s)),this.treeExpandeds=s,this.treeIndeterminates=a},handleReserveByRowid:function(e,i){var o=this,l=this.fullDataRowIdData;e.forEach(function(e){var t=_tools.UtilTools.getRowid(o,e);l[t]&&i.push(l[t].row)})},getSelectReserveRecords:function(){return this.getCheckboxReserveRecords()},getCheckboxReserveRecords:function(){var t=this.fullDataRowIdData,i=this.selectReserveRowMap,e=this.checkboxOpts,o=[];return e.reserve&&Object.keys(i).forEach(function(e){t[e]||o.push(i[e])}),o},clearSelectReserve:function(){return this.clearCheckboxReserve()},clearCheckboxReserve:function(){return this.selectReserveRowMap={},this.$nextTick()},handleSelectReserveRow:function(e,t){var i=this.selectReserveRowMap;if(this.checkboxOpts.reserve){var o=_tools.UtilTools.getRowid(this,e);t?i[o]=e:i[o]&&delete i[o]}},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),checked:t,$table:this},e])},toggleAllSelection:function(){return this.toggleAllCheckboxRow()},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){return this.clearCheckboxRow()},clearCheckboxRow:function(){var e=this.tableFullData,t=this.treeConfig,i=this.treeOpts,o=this.checkboxOpts,l=o.checkField||o.checkProp;return l&&(t?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,l,!1)},i):e.forEach(function(e){return _xeUtils.default.set(e,l,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,i=e.checkRowKey;i&&this.setRadioRow(t[i].row)},triggerRadioRowEvent:function(e,t){var i=this.radioOpts.checkMethod;if(!i||i({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})){var o=this.selectRow!==t.row;this.setRadioRow(t.row),o&&_tools.UtilTools.emitEvent(this,"radio-change",[t,e])}},triggerCurrentRowEvent:function(e,t){var i=this.currentRow!==t.row;this.setCurrentRow(t.row),i&&_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){return this.highlightCurrentRow&&(this.clearCurrentColumn(),this.currentRow=e),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){return this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.getCurrentRecord()},getCurrentRecord:function(){return this.currentRow},getRadioRow:function(){return this.getRadioRecord()},getRadioRecord:function(){return this.selectRow},triggerHoverEvent:function(e,t){var i=t.row;this.hoverRow=i},clearHoverRow:function(){this.hoverRow=null},triggerCellMousedownEvent:function(e,t){var l=this.$el,i=this.tableData,o=this.visibleColumn,n=this.editStore,r=this.checkboxOpts,s=this.mouseConfig,a=void 0===s?{}:s,c=this.editConfig,u=this.editOpts,h=this.handleSelected,d=this.handleChecked,f=n.checked,p=n.actived,g=t.row,v=t.column,m=t.cell,x=e.button,w=0===x;if(w||2===x)if(a.checked){if(c&&"dblclick"===u.trigger&&!("row"===u.mode&&p.row===g||p.row===g&&p.column===v))if(w){this.handleSelected(t,e);var b=document.onmousemove,C=document.onmouseup,T=_tools.DomTools.getCellIndexs(m),_=_xeUtils.default.throttle(function(e){var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),i=t.flag,o=t.targetElem;i&&d(T,_tools.DomTools.getCellIndexs(o),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=function(e){e.preventDefault(),e.stopPropagation(),_(e)},document.onmouseup=function(e){document.onmousemove=b,document.onmouseup=C},this.closeFilter(),this.closeMenu()}else{var R=_tools.DomTools.getCellIndexs(m);-1!==f.rows.indexOf(i[R.rowIndex])&&-1!==f.columns.indexOf(o[R.columnIndex])||h(t,e)}}else r.range&&this.handleCheckboxRangeEvent(e,t);this.isActivated=!0},triggerCornerMousedownEvent:function(e,t){t.preventDefault(),t.stopPropagation();var l=this.$el,i=this.tableData,o=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.editOpts,a=this.handleTempChecked,c=n.checked,u=t.button;if((0===u||2===u)&&r&&c.rows.length&&"dblclick"===s.trigger){var h=document.onmousemove,d=document.onmouseup,f={rowIndex:i.indexOf(c.rows[0]),columnIndex:o.indexOf(c.columns[0])},p=_xeUtils.default.throttle(function(e){var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),i=t.flag,o=t.targetElem;i&&a(f,_tools.DomTools.getCellIndexs(o),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=function(e){e.preventDefault(),e.stopPropagation(),p(e)},document.onmouseup=function(e){document.onmousemove=h,document.onmouseup=d,c.rows=c.tRows,c.columns=c.tColumns}}this.isActivated=!0},getRangeResult:function(e,t){for(var i=0,o=[],l=0<t?"next":"previous",n=0<t?t:Math.abs(t)+e.offsetHeight;e&&i<n;)o.push(this.getRowNode(e).item),i+=e.offsetHeight,e=e["".concat(l,"ElementSibling")];return o},handleCheckboxRangeEvent:function(e,t){var n=this,i=t.column,o=t.cell;if(-1<["checkbox","selection"].indexOf(i.type)){var r=e.clientX,s=e.clientY,a=this.$refs.checkboxRange,l=document.onmousemove,c=document.onmouseup,u=o.parentNode,h=_tools.DomTools.getAbsolutePos(u),d=this.getCheckboxRecords(),f=[];this.updateZindex(),document.onmousemove=function(e){e.preventDefault(),e.stopPropagation();var t=e.clientX-r,i=e.clientY-s,o=Math.abs(i),l=n.getRangeResult(u,e.clientY-h.top);a.style.display="block",a.style.width="".concat(Math.abs(t),"px"),a.style.height="".concat(o,"px"),a.style.left="".concat(r+(0<t?0:t),"px"),a.style.top="".concat(s+(0<i?0:i),"px"),a.style.zIndex="".concat(n.tZindex),10<o&&l.length!==f.length&&(f=l,e.ctrlKey?l.forEach(function(e){n.handleSelectRow({row:e},-1===d.indexOf(e))}):(n.clearCheckboxRow(),n.setCheckboxRow(l,!0)))},document.onmouseup=function(e){a.removeAttribute("style"),document.onmousemove=l,document.onmouseup=c}}},triggerHeaderCellClickEvent:function(e,t){var i=this._lastResizeTime,o=this.sortOpts,l=t.column,n=t.cell,r=i&&i>Date.now()-300,s=_tools.DomTools.getEventTargetNode(e,n,"vxe-sort-wrapper").flag,a=_tools.DomTools.getEventTargetNode(e,n,"vxe-filter-wrapper").flag;return"cell"!==o.trigger||r||s||a||this.triggerSortEvent(e,l,"desc"===l.order?"asc":"desc"),_tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerResizable:r,triggerSort:s,triggerFilter:a},t),e]),this.setCurrentColumn(l,!0)},setCurrentColumn:function(e){return this.highlightCurrentColumn&&(this.clearCurrentRow(),this.currentColumn=e),this.$nextTick()},clearCurrentColumn:function(){this.currentColumn=null},triggerCellClickEvent:function(e,t){var i=this,o=this.$el,l=this.highlightCurrentRow,n=this.editStore,r=this.radioOpts,s=this.expandOpts,a=this.treeOpts,c=this.editConfig,u=this.editOpts,h=this.checkboxOpts,d=n.actived,f=t.column,p=t.row;isTargetRadioOrCheckbox(e,f,"radio")||isTargetRadioOrCheckbox(e,f,"checkbox","checkbox")||isTargetRadioOrCheckbox(e,f,"selection","checkbox")||("row"!==s.trigger&&("expand"!==f.type||"cell"!==s.trigger)||_tools.DomTools.getEventTargetNode(e,o,"vxe-table--expanded").flag||this.triggerRowExpandEvent(e,t),("row"===a.trigger||f.treeNode&&"cell"===a.trigger)&&this.triggerTreeExpandEvent(e,t),f.treeNode&&_tools.DomTools.getEventTargetNode(e,o,"vxe-tree--btn-wrapper").flag||"expand"===f.type&&_tools.DomTools.getEventTargetNode(e,o,"vxe-table--expanded").flag||(l&&("row"!==r.trigger&&(_tools.DomTools.getEventTargetNode(e,o,"vxe-cell--checkbox").flag||_tools.DomTools.getEventTargetNode(e,o,"vxe-cell--radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==r.trigger&&("radio"!==f.type||"cell"!==r.trigger)||_tools.DomTools.getEventTargetNode(e,o,"vxe-cell--radio").flag||this.triggerRadioRowEvent(e,t),"row"!==h.trigger&&("checkbox"!==f.type&&"selection"!==f.type||"cell"!==h.trigger)||_tools.DomTools.getEventTargetNode(e,t.cell,"vxe-cell--checkbox").flag||this.handleToggleCheckRowEvent(t,e),c&&("click"===u.trigger?d.args&&p===d.row&&f===d.column||("row"===u.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===u.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})):"dblclick"===u.trigger&&("row"===u.mode&&d.row===p?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):this.handleSelected(t,e)))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e]))},triggerCellDBLClickEvent:function(e,t){var i=this,o=this.editStore,l=this.editConfig,n=this.editOpts,r=o.actived;l&&"dblclick"===n.trigger&&(r.args&&e.currentTarget===r.args.cell||("row"===n.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===n.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var i=this,o=this.editStore,l=this.editOpts,n=l.mode,r=l.activeMethod,s=o.actived,a=e.row,c=e.column,u=e.cell;if(c.editRender&&u)if("row"===n?s.row!==a:s.row!==a||s.column!==c){var h="edit-disabled";r&&!r(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(t),this.clearSelected(t),this.clearActived(t),h="edit-actived",c.renderHeight=u.offsetHeight,s.args=e,s.row=a,s.column=c,this.$nextTick(function(){i.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,h,[e,t])}else c.renderHeight=u.offsetHeight,s.args=e,s.column!==c&&this.clearValidate(),setTimeout(function(){i.handleFocus(e,t)});return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,i=t.args,o=t.row,l=t.column;return(o||l)&&(this.updateFooter(),_tools.UtilTools.emitEvent(this,"edit-closed",[i,e])),t.args=null,t.row=null,t.column=null,this.clearValidate()},getActiveRow:function(){return this.getActiveRecord()},getActiveRecord:function(){var e=this.$el,t=this.editStore,i=this.afterFullData,o=t.actived,l=o.args,n=o.row;return l&&-1<i.indexOf(n)&&e.querySelectorAll(".vxe-body--column.col--actived").length?Object.assign({},l):null},hasActiveRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasActiveRow","isActiveByRow"]),this.isActiveByRow(e)},isActiveByRow:function(e){return this.editStore.actived.row===e},clearSelected:function(){var e=this.editStore.selected;return e.row=null,e.column=null,this.$nextTick()},handleSelected:function(t,i){var o=this,e=this.mouseConfig,l=void 0===e?{}:e,n=this.editOpts,r=this.editStore,s=r.actived,a=r.selected,c=t.row,u=t.column;return function(){if((l.selected||l.checked)&&(a.row!==c||a.column!==u)&&(s.row!==c||"cell"===n.mode&&s.column!==u)&&(o.clearChecked(i),o.clearActived(i),a.args=t,a.row=c,a.column=u,l.checked)){var e=_tools.DomTools.getCellIndexs(t.cell);o.handleChecked(e,e,i)}return o.$nextTick()}()},clearChecked:function(){var e=this.editStore.checked;return e.rows=[],e.columns=[],e.tRows=[],e.tColumns=[],this.$nextTick()},getMouseSelecteds:function(){var e=this.editStore.selected,t=e.args,i=e.column;return t&&i?Object.assign({},t):null},getMouseCheckeds:function(){var e=this.editStore.checked,t=e.rows;return{columns:e.columns,rows:t}},handleChecked:function(e,t){var i=this.tableData,o=this.visibleColumn,l=this.editStore.checked,n=e.rowIndex,r=e.columnIndex,s=t.rowIndex,a=t.columnIndex;l.tRows=[],l.tColumns=[],l.rows=n<s?i.slice(n,s+1):i.slice(s,n+1),l.columns=r<a?o.slice(Math.max(r,1),a+1):o.slice(Math.max(a,1),r+1)},handleTempChecked:function(e,t){var i=this.tableData,o=this.visibleColumn,l=this.editStore.checked,n=l.rows,r=l.tRows,s=l.columns,a=l.tColumns,c=e.rowIndex,u=e.columnIndex,h=t.rowIndex,d=t.columnIndex;r.length>n.length?d=o.indexOf(s[s.length-1]):a.length>s.length&&(h=i.indexOf(n[n.length-1])),c<h?l.tRows=i.slice(c,h+1):(c+=n.length,l.tRows=i.slice(h,c)),u<d?l.tColumns=o.slice(Math.max(u,1),d+1):(u+=s.length,l.tColumns=o.slice(Math.max(d,1),u))},clearCopyed:function(){var e=this.editStore.copyed;return e.cut=!1,e.rows=[],e.columns=[],this.$nextTick()},handleCopyed:function(e){var t=this.editStore,i=t.copyed,o=t.checked;i.cut=e,i.rows=o.rows,i.columns=o.columns},handlePaste:function(e){var t=this.tableData,n=this.visibleColumn,i=this.editStore,o=i.copyed,l=i.selected,r=o.cut,s=o.rows,a=o.columns;if(s.length&&a.length&&l.row&&l.column){var c=l.args,u=c.rowIndex,h=c.columnIndex,d={rowIndex:u,columnIndex:h},f={rowIndex:u+s.length-1,columnIndex:h+a.length-1};s.forEach(function(o,e){var l=t[u+e];l&&a.forEach(function(e,t){var i=n[h+t];i&&_tools.UtilTools.setCellValue(l,i,_tools.UtilTools.getCellValue(o,e)),r&&_tools.UtilTools.setCellValue(o,e,null)})}),r&&this.clearCopyed(),this.handleChecked(d,f,e)}},handleFocus:function(e){var t=e.row,i=e.column,o=e.cell,l=i.editRender;if(l){var n,r=_vXETable.Renderer.get(l.name),s=l.autofocus,a=l.autoselect;if(s&&(n=o.querySelector(s)),!n&&r&&r.autofocus&&(n=o.querySelector(r.autofocus)),n){if(n[a?"select":"focus"](),browse.msie){var c=n.createTextRange();c.collapse(!1),c.select()}}else this.scrollToRow(t,i)}},setActiveRow:function(e){return this.setActiveCell(e,_xeUtils.default.find(this.visibleColumn,function(e){return e.editRender}).property)},setActiveCell:function(i,o){var l=this;return this.scrollToRow(i).then(function(){if(i&&o){var e=_xeUtils.default.find(l.visibleColumn,function(e){return e.property===o});if(e&&e.editRender){var t=_tools.DomTools.getCell(l,{row:i,column:e});t&&(l.handleActived({row:i,rowIndex:l.getRowIndex(i),column:e,columnIndex:l.getColumnIndex(e),cell:t,$table:l}),l.lastCallTime=Date.now())}}return l.$nextTick()})},setSelectCell:function(e,t){var i=this.tableData,o=this.editOpts,l=this.visibleColumn;if(e&&t&&"manual"!==o.trigger){var n=_xeUtils.default.find(l,function(e){return e.property===t}),r=i.indexOf(e);if(-1<r&&n){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:r,column:n}),a={row:e,rowIndex:r,column:n,columnIndex:l.indexOf(n),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},handleDefaultSort:function(){var e=this.sortOpts.defaultSort;if(e){var t=e.field,i=e.order;if(t&&i){var o=_xeUtils.default.find(this.visibleColumn,function(e){return e.property===t});o&&!o.order&&this.sort(t,i)}}},triggerSortEvent:function(e,t,i){var o=t.property;if(t.sortable||t.remoteSort){var l={column:t,property:o,field:o,prop:o,order:i,$table:this};t.order===i?(l.order=null,this.clearSort(t.property)):this.sort(o,i),_tools.UtilTools.emitEvent(this,"sort-change",[l,e])}},sort:function(t,e){var i=this.visibleColumn,o=this.tableFullColumn,l=this.remoteSort,n=this.sortOpts,r=_xeUtils.default.find(i,function(e){return e.property===t});if(r){var s=_xeUtils.default.isBoolean(r.remoteSort)?r.remoteSort:n.remote||l;(r.sortable||r.remoteSort)&&(e=e||("desc"===r.order?"asc":"desc"),r.order!==e&&(o.forEach(function(e){e.order=null}),r.order=e,s||this.handleTableData(!0)))}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},getSortColumn:function(){return this.visibleColumn.find(function(e){return e.sortable&&e.order})},filter:function(e,t){var i=this.getColumnByField(e);if(i){var o=i.filters;if(t){var l=t(o);_xeUtils.default.isArray(l)&&(i.filters=_tools.UtilTools.getFilters(l))}return this.$nextTick().then(function(){return o})}return this.$nextTick()},triggerFilterEvent:function(e,s,t){var i=this.$refs,a=this.filterStore;if(a.column===s&&a.visible)a.visible=!1;else{var c=i.filterWrapper,u=i.tableBody.$el,h=e.target,d=e.pageX,f=_tools.DomTools.getDomNode().visibleWidth;Object.assign(a,{args:t,multiple:s.filterMultiple,options:s.filters,column:s,style:null,visible:!0}),a.isAllSelected=a.options.every(function(e){return e.checked}),a.isIndeterminate=!a.isAllSelected&&a.options.some(function(e){return e.checked}),this.$nextTick(function(){var e,t,i=c.$el.offsetWidth,o=i/2,l={top:"".concat(h.offsetTop+h.offsetParent.offsetTop+h.offsetHeight+8,"px")};if("left"===s.fixed?e=h.offsetLeft+h.offsetParent.offsetLeft-o:"right"===s.fixed?t=h.offsetParent.offsetWidth-h.offsetLeft+(h.offsetParent.offsetParent.offsetWidth-h.offsetParent.offsetLeft)-s.renderWidth-o:e=h.offsetLeft+h.offsetParent.offsetLeft-o-u.scrollLeft,e){var n=d+i-o+32-f;0<n&&(e-=n),l.left="".concat(Math.max(32,e),"px")}else if(t){var r=d+i-o+32-f;0<r&&(t+=r),l.right="".concat(t,"px")}a.style=l})}},confirmFilterEvent:function(){var e=this.visibleColumn,t=this.filterStore,i=this.remoteFilter,o=this.filterOpts,l=this.scrollXLoad,n=this.scrollYLoad,r=t.column,s=r.property,a=[],c=[];r.filters.forEach(function(e){e.checked&&(a.push(e.value),c.push(e.data))}),t.visible=!1,o.remote||i||(this.handleTableData(!0),this.checkSelectionStatus());var u=[];e.filter(function(e){var t=e.property,i=e.filters,o=[],l=[];i&&i.length&&(i.forEach(function(e){e.checked&&(o.push(e.value),l.push(e.data))}),u.push({column:e,property:t,field:t,prop:t,values:o,datas:l}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:r,property:s,field:s,prop:s,values:a,datas:c,filters:u,$table:this}]),this.updateFooter(),(l||n)&&this.clearScroll(),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){if(e){var t=this.getColumnByField(e);return t.filters&&t.filters.some(function(e){return e.checked})}return this.visibleColumn.some(function(e){return e.filters&&e.filters.some(function(e){return e.checked})})},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(e){function t(e){var t=e.filters;t&&t.length&&t.forEach(function(e){e.checked=!1,e.data=e._data})}var i=arguments.length?this.getColumnByField(e):null,o=this.filterStore;return i?t(i):this.visibleColumn.forEach(t),i&&i===o.column||Object.assign(o,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,i=this.expandLazyLoadeds,o=this.fullAllDataRowMap,l=e.lazy,n=o.get(t);return l&&n&&(n.expandLoaded=!1,_xeUtils.default.remove(i,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,i=this.expandOpts,o=this.expandLazyLoadeds;return i.lazy&&-1===o.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var i=this.$listeners,o=this.expandOpts,l=this.expandLazyLoadeds,n=t.row;if(!o.lazy||-1===l.indexOf(n)){var r=!this.isExpandByRow(n);this.setRowExpansion(n,r),i["toggle-expand-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-expand-change","toggle-row-expand"]),_tools.UtilTools.emitEvent(this,"toggle-expand-change",[{expanded:r,row:n,rowIndex:this.getRowIndex(n),$table:this},e])):_tools.UtilTools.emitEvent(this,"toggle-row-expand",[{expanded:r,row:n,rowIndex:this.getRowIndex(n),$table:this},e])}},toggleRowExpansion:function(e){return this.setRowExpansion(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,i=e.expandAll,o=e.expandRowKeys;if(i)this.setAllRowExpansion(!0);else if(o){var l=[];o.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setRowExpansion(l,!0)}},setAllRowExpansion:function(e){return this.expandOpts.lazy?this.setRowExpansion(this.tableData,!0):(this.rowExpandeds=e?this.tableFullData.slice(0):[],this.$nextTick().then(this.recalculate))},handleAsyncRowExpand:function(t){var i=this,e=this.fullAllDataRowMap,o=this.rowExpandeds,l=this.expandLazyLoadeds,n=this.expandOpts.loadMethod,r=e.get(t);return new Promise(function(e){l.push(t),n({$table:i,row:t}).catch(function(e){return e}).then(function(){r.expandLoaded=!0,_xeUtils.default.remove(l,function(e){return e===t}),o.push(t),e(i.$nextTick().then(i.recalculate))})})},setRowExpansion:function(t,e){var i=this,o=this.fullAllDataRowMap,l=this.rowExpandeds,n=this.expandLazyLoadeds,r=this.expandOpts,s=r.lazy,a=r.accordion,c=[];return t&&(_xeUtils.default.isArray(t)||(t=[t]),a&&(l=[],t=t.slice(t.length-1,t.length)),e?t.forEach(function(e){if(-1===l.indexOf(e)){var t=o.get(e);s&&!t.expandLoaded&&-1===n.indexOf(e)?c.push(i.handleAsyncRowExpand(e)):l.push(e)}}):_xeUtils.default.remove(l,function(e){return-1<t.indexOf(e)})),this.rowExpandeds=l,Promise.all(c).then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var e=this,t=this.rowExpandeds.length;return this.rowExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,i=this.treeExpandeds,o=this.fullAllDataRowMap,l=e.lazy,n=o.get(t);return l&&n&&(n.treeLoaded=!1,_xeUtils.default.remove(i,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,i=this.treeOpts,o=this.treeLazyLoadeds,l=i.lazy,n=i.hasChild;return l&&e[n]&&-1===o.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var i=this.$listeners,o=this.treeOpts,l=this.treeLazyLoadeds,n=t.row;if(!o.lazy||-1===l.indexOf(n)){var r=!this.isTreeExpandByRow(n);this.setTreeExpansion(n,r),i["toggle-tree-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-tree-change","toggle-tree-expand"]),_tools.UtilTools.emitEvent(this,"toggle-tree-change",[{expanded:r,row:n,rowIndex:this.getRowIndex(n),$table:this},e])):_tools.UtilTools.emitEvent(this,"toggle-tree-expand",[{expanded:r,row:n,rowIndex:this.getRowIndex(n),$table:this},e])}},toggleTreeExpansion:function(e){return this.setTreeExpansion(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,i=this.treeOpts,o=this.tableFullData;if(e){var t=i.expandAll,l=i.expandRowKeys;if(t)this.setAllTreeExpansion(!0);else if(l){var n=[],r=_tools.UtilTools.getRowkey(this);l.forEach(function(t){var e=_xeUtils.default.findTree(o,function(e){return t===_xeUtils.default.get(e,r)},i);e&&n.push(e.item)}),this.setTreeExpansion(n,!0)}}},handleAsyncTreeExpandChilds:function(i){var o=this,e=this.fullAllDataRowMap,l=this.treeExpandeds,t=this.treeOpts,n=this.treeLazyLoadeds,r=t.loadMethod,s=t.children,a=e.get(i);return new Promise(function(t){n.push(i),r({$table:o,row:i}).catch(function(e){return[]}).then(function(e){a.treeLoaded=!0,_xeUtils.default.remove(n,function(e){return e===i}),_xeUtils.default.isArray(e)||(e=[]),e&&(i[s]=e,o.appendTreeCache(i,e),e.length&&-1===l.indexOf(i)&&l.push(i),o.isCheckedByCheckboxRow(i)&&o.setCheckboxRow(e,!0)),t(o.$nextTick().then(o.recalculate))})})},setAllTreeExpansion:function(e){var t=this,i=this.tableFullData,o=this.treeOpts,l=o.lazy,n=o.children;if(e)if(l)_xeUtils.default.eachTree(i,function(e){t.setTreeExpansion(e,!0)},o);else{var r=[];_xeUtils.default.eachTree(i,function(e){var t=e[n];t&&t.length&&r.push(e)},o),this.treeExpandeds=r}else this.treeExpandeds=[];return this.$nextTick().then(this.recalculate)},setTreeExpansion:function(t,e){var i=this,o=this.fullAllDataRowMap,l=this.tableFullData,n=this.treeExpandeds,r=this.treeOpts,s=this.treeLazyLoadeds,a=r.lazy,c=r.hasChild,u=r.children,h=r.accordion,d=[];if(t&&(_xeUtils.default.isArray(t)||(t=[t]),t.length)){if(h){t=t.slice(t.length-1,t.length);var f=_xeUtils.default.findTree(l,function(e){return e===t[0]},r);_xeUtils.default.remove(n,function(e){return-1<f.items.indexOf(e)})}return e?t.forEach(function(e){if(-1===n.indexOf(e)){var t=o.get(e);a&&e[c]&&!t.treeLoaded&&-1===s.indexOf(e)?d.push(i.handleAsyncTreeExpandChilds(e)):e[u]&&e[u].length&&n.push(e)}}):_xeUtils.default.remove(n,function(e){return-1<t.indexOf(e)}),Promise.all(d).then(this.recalculate)}return Promise.resolve()},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var e=this,t=this.treeExpandeds.length;return this.treeExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},isScrollXLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollXLoad","getVirtualScroller"]),this.scrollXLoad},isScrollYLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollYLoad","getVirtualScroller"]),this.scrollYLoad},getVirtualScroller:function(){var e=this.$refs,t=this.scrollXLoad,i=this.scrollYLoad,o=e.tableBody.$el;return{scrollX:t,scrollY:i,scrollTop:o.scrollTop,scrollLeft:o.scrollLeft}},triggerScrollXEvent:function(){this.updateVirtualScrollX()},updateVirtualScrollX:function(e){for(var t=this.$refs,i=this.visibleColumn,o=this.scrollXStore,l=o.startIndex,n=o.renderSize,r=o.offsetSize,s=o.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,u=0,h=e||!1,d=i.length,f=0;f<d;f++)if(a<(u+=i[f].renderWidth)){c=f;break}if(e||o.visibleIndex!==c){var p=Math.min(Math.floor((n-s)/2),s);o.visibleIndex===c?o.startIndex=c:o.visibleIndex>c?(h=c-r<=l)&&(o.startIndex=Math.max(0,Math.max(0,c-p))):(h=l+n<=c+s+r)&&(o.startIndex=Math.max(0,Math.min(i.length-n,c-p))),h&&this.updateScrollXData(),o.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:_xeUtils.default.debounce(function(e){var t=this.afterFullData,i=this.scrollYStore,o=this.isLoadData,l=i.startIndex,n=i.renderSize,r=i.offsetSize,s=i.visibleSize,a=i.rowHeight,c=e.target.scrollTop,u=Math.ceil(c/a),h=!1;if(o||i.visibleIndex!==u){var d=Math.min(Math.floor((n-s)/2),s);i.visibleIndex>u?(h=u-r<=l)&&(i.startIndex=Math.max(0,u-Math.max(d,n-s))):(h=l+n<=u+s+r)&&(i.startIndex=Math.max(0,Math.min(t.length-n,u-d))),h&&this.updateScrollYData(),i.visibleIndex=u,this.isLoadData=!1}},debounceScrollYDuration,{leading:!1,trailing:!0}),computeRowHeight:function(){var e,t=this.$refs.tableBody,i=t?t.$el:null,o=this.$refs.tableHeader;if(i){var l=i.querySelector("tbody>tr");!l&&o&&(l=o.$el.querySelector("thead>tr")),l&&(e=l.clientHeight)}e=e||this.rowHeightMaps[this.vSize||"default"],this.rowHeight=e},computeScrollLoad:function(){var w=this;return this.$nextTick().then(function(){var e=w.vSize,t=w.scrollXLoad,i=w.scrollYLoad,o=w.scrollYStore,l=w.scrollXStore,n=w.visibleColumn,r=w.optimizeOpts,s=w.rowHeightMaps,a=r.scrollX,c=r.scrollY,u=w.$refs.tableBody,h=u?u.$el:null,d=w.$refs.tableHeader;if(h){if(t){var f=n[0],p=f?f.renderWidth:40,g=_xeUtils.default.toNumber(a.vSize||Math.ceil(h.clientWidth/p));l.visibleSize=g,a.oSize||(l.offsetSize=g),a.rSize||(l.renderSize=g+4),w.updateScrollXData()}else w.updateScrollXSpace();if(i){var v;if(c.rHeight)v=c.rHeight;else{var m=h.querySelector("tbody>tr");!m&&d&&(m=d.$el.querySelector("thead>tr")),m&&(v=m.clientHeight)}v=v||s[e||"default"];var x=_xeUtils.default.toNumber(c.vSize||Math.ceil(h.clientHeight/v));o.visibleSize=x,o.rowHeight=v,c.oSize||(o.offsetSize=x),c.rSize||(o.renderSize=x*(browse.edge?10:8)),w.updateScrollYData()}else w.updateScrollYSpace()}return w.$nextTick()})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.visibleColumn,t=this.scrollXStore;t.leftSpaceWidth=e.slice(0,t.startIndex).reduce(function(e,t){return e+t.renderWidth},0),t.rightSpaceWidth=e.slice(t.startIndex+t.renderSize,e.length).reduce(function(e,t){return e+t.renderWidth},0)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var e=this.scrollYStore,t=this.afterFullData,i=t.length*e.rowHeight;e.ySpaceHeight=i,e.topSpaceHeight=Math.max(e.startIndex*e.rowHeight,0),e.bottomSpaceHeight=Math.max((t.length-(e.startIndex+e.renderSize))*e.rowHeight,0)},scrollTo:function(e,t){var i=this,o=this.$refs.tableBody.$el;if(_xeUtils.default.isNumber(e)){var l=this.$refs.tableFooter;l?l.$el.scrollLeft=e:o.scrollLeft=e}if(_xeUtils.default.isNumber(t)){var n=this.$refs.rightBody;n&&(n.$el.scrollTop=t),o.scrollTop=t}return this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(i.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var i=[];return e&&(this.treeConfig?i.push(this.scrollToTreeRow(e)):this.fullAllDataRowMap.has(e)&&i.push(_tools.DomTools.rowToVisible(this,e))),i.push(this.scrollToColumn(t)),Promise.all(i)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var i=this,e=this.tableFullData,o=this.treeConfig,l=this.treeOpts;if(o){var n=_xeUtils.default.findTree(e,function(e){return e===t},l);if(n){var r=n.nodes;r.forEach(function(e,t){t<r.length-1&&!i.hasTreeExpand(e)&&i.setTreeExpansion(e,!0)})}}return this.$nextTick()},clearScroll:function(){var n=this;return this.updateScrollXSpace(),this.updateScrollYSpace(),this.$nextTick().then(function(){var e=n.$refs,t=e.tableBody,i=t?t.$el:null,o=e.tableFooter,l=(o?o.$el:null)||i;return i&&(i.scrollTop=0),l&&(l.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(n.$nextTick())})})})},updateFooter:function(){var e=this.showFooter,t=this.tableColumn,i=this.footerMethod;return e&&i&&(this.footerData=t.length?i({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(a,c){var u=this,h=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=u.$refs,t=u.tableData,i=u.editRules,o=u.validStore;if(a&&e.tableBody&&i){var l=a.row,n=a.column;if(u.hasCellRules("change",l,n)){var r=t.indexOf(l),s=_tools.DomTools.getCell(u,{row:l,rowIndex:r,column:n});if(s)return u.validCellRules("change",l,n,c).then(function(){h&&o.visible&&_tools.UtilTools.setCellValue(l,n,c),u.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(l,n,c),u.showValidTooltip({rule:t,row:l,column:n,cell:s})})}}})},triggerValidate:function(o){var l=this,e=this.editOpts,t=this.editStore,i=this.editRules,n=this.validStore,r=t.actived;if(r.row&&i){var s=r.args,a=s.row,c=s.column,u=s.cell;if(this.hasCellRules(o,a,c))return this.validCellRules(o,a,c).then(function(){"row"===e.mode&&n.visible&&n.row===a&&n.column===c&&l.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&o!==t.trigger)return Promise.resolve();var i={rule:t,row:a,column:c,cell:u};return l.showValidTooltip(i),Promise.reject(i)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,c,u){var h=this,d={},f=!0,t=this.editRules,p=this.afterFullData,g=this.treeConfig,i=this.treeOpts,o=p;e&&(_xeUtils.default.isFunction(e)?c=e:o=_xeUtils.default.isArray(e)?e:[e]);var l=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var n=this.getColumns(),r=function(r){var e=[];n.forEach(function(l,n){_xeUtils.default.has(t,l.property)&&e.push(new Promise(function(i,o){h.validCellRules("all",r,l).then(i).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:h.getRowIndex(r),row:r,columnIndex:n,column:l,$table:h};return u?(d[l.property]||(d[l.property]=[]),d[l.property].push(t),i()):o(t)})}))}),l.push(Promise.all(e))};return g?_xeUtils.default.eachTree(o,r,i):o.forEach(r),Promise.all(l).then(function(){var e=Object.keys(d);if(e.length)return Promise.reject(d[e[0]][0]);c&&c(f)}).catch(function(s){var a=u?d:_defineProperty({},s.column.property,s);return new Promise(function(e,t){function i(){f=!1,c?(c(f,a),e()):t(a)}function o(){s.cell=_tools.DomTools.getCell(h,s),h.handleValidError(s),i()}var l=s.row,n=p.indexOf(l),r=0<n?p[n-1]:l;_tools.DomTools.toView(h.$el),!1===h.validOpts.autoPos?i():g?h.scrollToTreeRow(r).then(o):h.scrollToRow(r).then(o)})})}return c&&c(f),Promise.resolve()},hasCellRules:function(t,e,i){var o=this.editRules,l=i.property;if(l&&o){var n=_xeUtils.default.get(o,l);return n&&_xeUtils.default.find(n,function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(s,a,c,u){var h=this,e=this.editRules,t=c.property,d=[],i=[];if(t&&e){var f=_xeUtils.default.get(e,t),p=_xeUtils.default.isUndefined(u)?_xeUtils.default.get(a,t):u;f&&f.forEach(function(r){i.push(new Promise(function(i){var e=!0===r.required;if("all"!==s&&r.trigger&&s!==r.trigger)i();else if(_xeUtils.default.isFunction(r.validator))r.validator(r,p,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:r.trigger,message:e.message,rule:r};d.push(new Rule(t))}return i()},{rules:f,row:a,column:c,rowIndex:h.getRowIndex(a),columnIndex:h.getColumnIndex(c)});else{var t,o=p,l="number"===r.type,n=null==p||""===p;l?o=_xeUtils.default.toNumber(p):t=_xeUtils.default.getSize(o),e&&n?d.push(new Rule(r)):(l&&isNaN(u)||r.pattern&&!(r.pattern.test?r.pattern:new RegExp(r.pattern)).test(u)||_xeUtils.default.isNumber(r.min)&&(l?o<r.min:t<r.min)||_xeUtils.default.isNumber(r.max)&&(l?o>r.max:t>r.max))&&d.push(new Rule(r)),i()}}))})}return Promise.all(i).then(function(){if(d.length){var e={rules:d,rule:d[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;!1===this.validOpts.autoPos?_tools.UtilTools.emitEvent(this,"valid-error",[e]):this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,i=this.$refs,o=this.height,l=this.tableData,n=this.validOpts,r=e.rule,s=e.row,a=e.column,c=e.cell,u=i.validTip,h=r.message;this.$nextTick(function(){Object.assign(t.validStore,{row:s,column:a,rule:r,content:h,visible:!0}),u&&("tooltip"===n.message||"default"===n.message&&!o&&l.length<2)&&u.toVisible(c,h),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["exportCsv","exportData"]),this.exportData(e)},exportData:function(e){var t=this.visibleColumn,i=this.tableFullData,o=Object.assign({filename:"",sheetName:"",original:!1,message:!1,isHeader:!0,isFooter:!0,download:!0,type:"csv",data:null,columns:null,columnFilterMethod:e&&e.columns?null:function(e){return-1<["seq","index"].indexOf(e.type)||e.property},dataFilterMethod:null,footerFilterMethod:null},_conf.default.export,e);if(o.filename||(o.filename=_xeUtils.default.template(_conf.default.i18n(o.original?"vxe.table.expOriginFilename":"vxe.table.expFilename"),[_xeUtils.default.toDateString(Date.now(),"yyyyMMddHHmmss")])),o.sheetName||(o.sheetName=_conf.default.i18n("vxe.table.expSheetName")),-1===_vXETable.default.exportTypes.indexOf(o.type))throw new Error(_tools.UtilTools.getLog("vxe.error.notType",[o.type]));return _tools.ExportTools.handleExport(this,o,t,i)},importByFile:function(t,e){var i=this;if(window.FileReader){var o=_tools.UtilTools.parseFile(t),l=o.type,n=o.filename,r=Object.assign({mode:"covering"},e,{type:l,filename:n});-1<(r.types||_vXETable.default.importTypes).indexOf(l)?this.preventEvent(null,"event.import",{$table:this,file:t,options:r,columns:this.tableFullColumn},function(){var e=new FileReader;e.onerror=function(e){_tools.UtilTools.error("vxe.error.notType",[l])},e.onload=function(e){_tools.ExportTools.handleImport(i,e.target.result.trim(),r)},e.readAsText(t,"UTF-8")}):_tools.UtilTools.error("vxe.error.notType",[l])}else _tools.UtilTools.error("vxe.error.notExp")},importData:function(e){var i=this,t=Object.assign({},_conf.default.import,e),o=new Promise(function(e,t){i._importResolve=e,i._importReject=t});return this.readFile(t).then(function(e){return i.importByFile(e.target.files[0],t)}).catch(function(e){i._importReject(e),i._importReject=null}),o},readFile:function(e){var i=this,o=0<arguments.length&&void 0!==e?e:{};fileForm.parentNode||document.body.appendChild(fileForm);var l=o.types||_vXETable.default.importTypes;return o.multiple&&(fileInput.multiple="multiple"),fileInput.accept=".".concat(l.join(", .")),fileInput.onchange=function(e){var t=_tools.UtilTools.parseFile(e.target.files[0]).type;-1<l.indexOf(t)?i._fileResolve(e):(!1!==o.message&&i.$XModal.message({message:_xeUtils.default.template(_conf.default.i18n("vxe.error.notType"),[t]),status:"error"}),i._fileReject(e)),i._fileResolve=null},fileForm.reset(),fileInput.click(),new Promise(function(e,t){i._fileResolve=e,i._fileReject=t})},print:function(e){var t=Object.assign({original:!1},e,{type:"html",download:!1,print:!0});t.sheetName||(t.sheetName=t.filename),this.exportData(t).then(function(e){var t=e.content,i=e.blob;if(_tools.DomTools.browse.msie){if(printFrame){try{printFrame.contentDocument.write(""),printFrame.contentDocument.clear()}catch(e){}document.body.removeChild(printFrame)}printFrame=createFrame(),document.body.appendChild(printFrame),printFrame.contentDocument.write(t),printFrame.contentDocument.execCommand("print")}else printFrame||((printFrame=createFrame()).onload=function(e){e.target.src&&e.target.contentWindow.print()},document.body.appendChild(printFrame)),printFrame.src=URL.createObjectURL(i)})},openImport:function(e){var t=Object.assign({mode:"covering",message:!0},e,this.importOpts);!this.getTreeStatus()?(this.importConfig||_tools.UtilTools.warn("vxe.error.reqProp",["import-config"]),Object.assign(this.importStore,{file:null,type:"",filename:"",visible:!0}),Object.assign(this.importParams,t)):t.message&&this.$XModal.message({message:_conf.default.i18n("vxe.error.treeNotImp"),status:"error"})},openExport:function(e){var t=this.$toolbar,i=this.exportConfig,o=this.exportOpts,l=this.treeConfig,n=this.tableFullColumn,r=this.footerData,s=this.getCheckboxRecords(),a=n.filter(function(e){return-1<["seq","index"].indexOf(e.type)||e.property}),c=!!l,u=!!r.length,h=Object.assign({message:!0,isHeader:!0},o,e),d=h.types||_vXETable.default.exportTypes,f=o.checkMethod||(t?t.customOpts.checkMethod:null);return i||_tools.UtilTools.warn("vxe.error.reqProp",["export-config"]),h.types=d.map(function(e){return{value:e,label:"vxe.types.".concat(e)}}),a.forEach(function(e){e.checked=e.visible,e.disabled=!!f&&!f({column:e})}),Object.assign(this.exportStore,{columns:a,selectRecords:s,mode:s.length?"selected":"all",hasFooter:u,visible:!0,isTree:c}),Object.assign(this.exportParams,{filename:h.filename||"",sheetName:h.sheetName||"",type:h.type||h.types[0].value,types:h.types,original:h.original,message:h.message,isHeader:h.isHeader,isFooter:u}),this.$nextTick()},confirmExportEvent:function(e){this.exportData(Object.assign({},this.exportOpts,e))},confirmImportEvent:function(e){this.importByFile(this.importStore.file,Object.assign({},this.importOpts,e))},confirmPrintEvent:function(e){this.print(Object.assign({},this.printOpts,e))},updateZindex:function(){this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex(this))},connect:function(e){var t=e.toolbar;this.$toolbar=t},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;