"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireWildcard(require("../../v-x-e-table")),_tools=require("../../tools");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var r=i?Object.getOwnPropertyDescriptor(e,l):null;r&&(r.get||r.set)?Object.defineProperty(o,l,r):o[l]=e[l]}return o.default=e,t&&t.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}var printFrame,rowUniqueId=0,browse=_tools.DomTools.browse,debounceScrollYDuration=browse.msie?40:20,fileForm=document.createElement("form"),fileInput=document.createElement("input");function createFrame(){var e=document.createElement("iframe");return e.className="vxe-table--print-frame",e}function getRowUniqueId(){return"row_".concat(++rowUniqueId)}function isTargetRadioOrCheckbox(e,t,o,i){var l=e.target;return l&&t.type===o&&"input"===l.tagName.toLowerCase()&&l.type===(i||o)}fileForm.className="vxe-table--import-form",fileInput.name="file",fileInput.type="file",fileForm.appendChild(fileInput);var Rule=function(){function t(e){_classCallCheck(this,t),Object.assign(this,{$options:e,required:e.required,min:e.min,max:e.min,type:e.type,pattern:e.pattern,validator:e.validator,trigger:e.trigger,maxWidth:e.maxWidth})}return _createClass(t,[{key:"message",get:function(){return _tools.UtilTools.getFuncText(this.$options.message)}}]),t}();function renderFixed(e,t,o){var i=t.tableData,l=t.tableColumn,r=t.visibleColumn,n=t.collectColumn,s=t.isGroup,a=t.height,c=t.parentHeight,u=t.vSize,h=t.headerHeight,d=t.footerHeight,f=t.showHeader,p=t.showFooter,g=t.tableHeight,v=t.scrollbarWidth,x=t.scrollbarHeight,m=t.scrollRightToLeft,w=t.scrollLeftToRight,b=t.columnStore,T=t.footerData,C="right"===o,_=b["".concat(o,"List")],R=0;a&&(R="auto"===a?c:_tools.DomTools.isScale(a)?Math.floor(parseInt(a)/100*c):_xeUtils.default.toNumber(a),p&&(R+=x+1));var S={height:"".concat((0<R?R-h-d:g)+h+d-x*(p?2:1),"px"),width:"".concat(_.reduce(function(e,t){return e+t.renderWidth},C?v:0),"px")};return e("div",{class:["vxe-table--fixed-".concat(o,"-wrapper"),{"scrolling--middle":C?m:w}],style:S,ref:"".concat(o,"Container")},[f?e("vxe-table-header",{props:{fixedType:o,tableData:i,tableColumn:l,visibleColumn:r,collectColumn:n,size:u,fixedColumn:_,isGroup:s},ref:"".concat(o,"Header")}):null,e("vxe-table-body",{style:{top:"".concat(h,"px")},props:{fixedType:o,tableData:i,tableColumn:l,visibleColumn:r,collectColumn:n,fixedColumn:_,size:u,isGroup:s},ref:"".concat(o,"Body")}),p?e("vxe-table-footer",{style:{top:"".concat(0<R?R-d:g+h,"px")},props:{fixedType:o,footerData:T,tableColumn:l,visibleColumn:r,size:u,fixedColumn:_},ref:"".concat(o,"Footer")}):null])}var headerProps={children:"children"},_default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:[Boolean,String],default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},footerAlign:{type:String,default:function(){return _conf.default.footerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],cellStyle:[Object,Function],headerCellStyle:[Object,Function],footerCellStyle:[Object,Function],rowStyle:[Object,Function],headerRowStyle:[Object,Function],footerRowStyle:[Object,Function],spanMethod:Function,footerSpanMethod:Function,showAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:[Boolean,String],rowId:String,zIndex:Number,autoResize:Boolean,syncResize:Boolean,seqConfig:Object,sortConfig:Object,filterConfig:Object,radioConfig:Object,selectConfig:Object,checkboxConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:[Boolean,Object],contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object,params:Object},provide:function(){return{$table:this}},inject:{$grid:{default:null}},data:function(){return{id:_xeUtils.default.uniqueId(),tZindex:0,collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,scrollLeftToRight:!1,scrollRightToLeft:!1,isCoverBody:!1,rowHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,currentColumn:null,footerData:[],rowExpandeds:[],expandLazyLoadeds:[],treeExpandeds:[],treeLazyLoadeds:[],treeIndeterminates:[],hoverRow:null,_isLoading:!1,filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},scrollXStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,leftSpaceWidth:0,rightSpaceWidth:0},scrollYStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,topSpaceHeight:0,bottomSpaceHeight:0,ySpaceHeight:0},tooltipStore:{visible:!1,row:null,column:null,content:""},editStore:{checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},rowHeightMaps:function(){return Object.assign({default:48,medium:44,small:40,mini:36},this.optimizeOpts.rHeights)},seqOpts:function(){return Object.assign({startIndex:0},_conf.default.seqConfig,this.seqConfig)},radioOpts:function(){return Object.assign({},_conf.default.radioConfig,this.radioConfig)},checkboxOpts:function(){return Object.assign({},_conf.default.checkboxConfig,this.checkboxConfig||this.selectConfig)},tooltipOpts:function(){return Object.assign({leaveDelay:300},_conf.default.tooltipConfig,this.tooltipConfig)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipOpts)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},filterOpts:function(){return Object.assign({},_conf.default.filterConfig,this.filterConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _vXETable.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t},expandOpts:function(){return Object.assign({},_conf.default.expandConfig,this.expandConfig)},treeOpts:function(){return Object.assign({children:"children",hasChild:"hasChild",indent:20},_conf.default.treeConfig,this.treeConfig)},isAllCheckboxDisabled:function(){var e=this.tableFullData,t=(this.treeConfig,this.checkboxOpts),o=t.strict,i=t.checkMethod;return!!o&&(!e.length||!!i&&e.every(function(e,t){return!i({row:e,rowIndex:t,$rowIndex:t})}))}},watch:{data:function(e){this.loadTableData(e,!0).then(this.handleDefault)},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=this,o=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=o,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn().then(function(){t.scrollXLoad&&t.updateVirtualScrollX(!0)}),this.handleTableData(!0),this.$toolbar&&this.$toolbar.updateColumn(o),o.length&&o.some(function(e){return e.columnKey})&&_tools.UtilTools.warn("vxe.error.delProp",["column.column-key","table.column-key"]),o.length){var i=Math.floor((o.length-1)/2);o[i].prop&&_tools.UtilTools.warn("vxe.error.delProp",["prop","field"]),o[i].label&&_tools.UtilTools.warn("vxe.error.delProp",["label","title"])}this.treeConfig&&o.some(function(e){return e.fixed})&&o.some(function(e){return"expand"===e.type})&&_tools.UtilTools.warn("vxe.error.treeFixedExpand")},tableColumn:function(){this.analyColumnWidth()},height:function(){var e=this;this.$nextTick(function(){return e.recalculate(!0)})},loading:function(){this._isLoading||(this._isLoading=!0)},syncResize:function(e){var t=this;e&&this.$nextTick(function(){return t.recalculate(!0)})}},created:function(){var e=this,t=this.scrollXStore,o=this.scrollYStore,i=this.optimizeOpts,l=this.ctxMenuOpts,r=this.showOverflow,n=this.radioOpts,s=this.checkboxOpts,a=this.treeConfig,c=this.treeOpts,u=this.editConfig,h=this.loading,d=this.showAllOverflow,f=this.showHeaderAllOverflow,p=i.scrollX,g=i.scrollY;h&&(this._isLoading=!0),g&&Object.assign(o,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(g.rSize),offsetSize:_xeUtils.default.toNumber(g.oSize)}),p&&Object.assign(t,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(p.rSize),offsetSize:_xeUtils.default.toNumber(p.oSize)}),_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("vxe.error.emptyProp",["row-id"]),this.startIndex&&_tools.UtilTools.warn("vxe.error.delProp",["start-index","seq-config.startIndex"]),_xeUtils.default.isBoolean(d)&&_tools.UtilTools.warn("vxe.error.delProp",["show-all-overflow","show-overflow"]),_xeUtils.default.isBoolean(f)&&_tools.UtilTools.warn("vxe.error.delProp",["show-header-all-overflow","show-header-overflow"]),n.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["radio-config.labelProp","radio-config.labelField"]),this.selectConfig&&_tools.UtilTools.warn("vxe.error.delProp",["select-config","checkbox-config"]),a&&c.line&&!r&&_tools.UtilTools.warn("vxe.error.treeLineReqProp",["show-overflow"]),s.checkProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.checkProp","select-config.checkField"]),s.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.labelProp","select-config.labelField"]),this.sortMethod&&_tools.UtilTools.warn("vxe.error.delProp",["sort-method","sort-config.sortMethod"]),this.remoteSort&&_tools.UtilTools.warn("vxe.error.delProp",["remote-sort","sort-config.remote"]),this.remoteFilter&&_tools.UtilTools.warn("vxe.error.delProp",["remote-filter","filter-config.remote"]),["header","body","footer"].forEach(function(e){l[e]&&l[e].visibleMethod&&_tools.UtilTools.warn("vxe.error.delProp",["context-menu.".concat(e,".visibleMethod"),"context-menu.visibleMethod"])}),this.lastScrollLeft=0,this.lastScrollTop=0,this.afterFullData=[],this.selectReserveRowMap={},this.fullAllDataRowMap=new Map,this.fullAllDataRowIdData={},this.fullDataRowMap=new Map,this.fullDataRowIdData={},this.fullColumnMap=new Map,this.fullColumnIdData={},this.loadTableData(this.data,!0).then(function(){s.key?_tools.UtilTools.warn("vxe.error.delProp",["select-config.key","row-id"]):a&&c.key?_tools.UtilTools.warn("vxe.error.delProp",["tree-config.key","row-id"]):u&&u.key&&_tools.UtilTools.warn("vxe.error.delProp",["edit-config.key","row-id"]),e.handleDefault()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent),this.preventEvent(null,"created",{$table:this})},mounted:function(){var e=this;this.autoResize&&_tools.ResizeEvent.on(this,this.getParentElem(),function(){return e.recalculate(!0)}),document.body.appendChild(this.$refs.tableWrapper),this.preventEvent(null,"mounted",{$table:this})},activated:function(){this.refreshScroll(),this.preventEvent(null,"activated",{$table:this})},deactivated:function(){this.preventEvent(null,"deactivated",{$table:this})},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.getParentElem()),this.closeFilter(),this.closeMenu(),this.clearAll(),this.preventEvent(null,"beforeDestroy",{$table:this})},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize"),this.preventEvent(null,"destroyed",{$table:this})},render:function(e){var t=this._e,o=this.id,i=this.isCoverBody,l=this.tableData,r=this.tableColumn,n=this.visibleColumn,s=this.collectColumn,a=this.isGroup,c=this.hasFilter,u=this.isResizable,h=this.isCtxMenu,d=this.loading,f=this.stripe,p=this._isLoading,g=this.showHeader,v=this.headerHeight,x=this.height,m=this.border,w=this.treeOpts,b=this.treeConfig,T=this.mouseConfig,C=this.vSize,_=this.validOpts,R=this.editRules,S=this.showFooter,y=this.footerMethod,E=this.overflowX,D=this.overflowY,U=this.scrollXLoad,O=this.scrollYLoad,k=this.scrollbarHeight,I=this.highlightHoverRow,$=this.highlightHoverColumn,F=this.editConfig,M=this.optimizeOpts,L=this.vaildTipOpts,A=this.tooltipOpts,z=this.columnStore,P=this.filterStore,H=this.ctxMenuStore,j=this.footerData,B=this.hasTip,W=z.leftList,N=z.rightList;return e("div",{class:["vxe-table",C?"size--".concat(C):"",m&&_xeUtils.default.isString(m)?"b--style-".concat(m):"",{"vxe-editable":F,"show--head":g,"show--foot":S,"is--group":a,"has--height":x,"has--tree-line":b&&w.line,"fixed--left":W.length,"fixed--right":N.length,"t--animat":M.animat,"t--stripe":f,"t--border":m,"t--selected":T&&T.selected,"t--checked":T&&T.checked,"row--highlight":I,"column--highlight":$,"is--cover":i,"scroll--y":D,"scroll--x":E,"virtual--x":U,"virtual--y":O}]},[e("div",{class:"vxe-table-hidden-column",ref:"hideColumn"},this.$slots.default),e("div",{class:"vxe-table--main-wrapper"},[g?e("vxe-table-header",{ref:"tableHeader",props:{tableData:l,tableColumn:r,visibleColumn:n,collectColumn:s,size:C,isGroup:a}}):t(),e("vxe-table-body",{ref:"tableBody",props:{tableData:l,tableColumn:r,visibleColumn:n,collectColumn:s,size:C,isGroup:a}}),S?e("vxe-table-footer",{props:{footerData:j,footerMethod:y,tableColumn:r,visibleColumn:n,size:C},ref:"tableFooter"}):null]),W&&W.length&&E?renderFixed(e,this,"left"):t(),N&&N.length&&E?renderFixed(e,this,"right"):t(),d||l.length?t():e("div",{ref:"emptyPlaceholder",class:"vxe-table--empty-placeholder",style:x?null:{top:"".concat(v,"px")}},[e("div",{class:"vxe-table--empty-content"},this.$scopedSlots.empty?this.$scopedSlots.empty.call(this,{$table:this},e):_conf.default.i18n("vxe.table.emptyText"))]),u?e("div",{class:"vxe-table--resizable-bar",style:E?{"padding-bottom":"".concat(k,"px")}:null,ref:"resizeBar"}):t(),e("div",{class:"vxe-table--border-line"}),p?e("vxe-table-loading",{props:{visible:d}}):t(),c?e("vxe-table-filter",{props:{optimizeOpts:M,filterStore:P},ref:"filterWrapper"}):t(),e("div",{class:"vxe-table".concat(o,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[h?e("vxe-table-context-menu",{props:{ctxMenuStore:H},ref:"ctxWrapper"}):t(),B?e("vxe-tooltip",{ref:"tooltip",props:A,on:A.enterable?{leave:this.handleTooltipLeaveEvent}:null}):t(),B&&R&&("default"===_.message?!x:"tooltip"===_.message)?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===_.message||1===l.length?L:null,ref:"validTip"}):t()])])},methods:{getParentElem:function(){return this.$grid?this.$grid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$grid?this.$grid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$grid?this.$grid.getExcludeHeight():0},clearAll:function(){return this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearSelection(),this.clearSelectReserve(),this.clearRowExpand(),this.clearTreeExpand(),this.clearChecked(),this.clearSelected(),this.clearActived(),this.clearScroll()},refreshData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,o=this.scrollYStore,i=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?i.slice(o.startIndex,o.startIndex+o.renderSize):i.slice(0),this.$nextTick()},loadTableData:function(e,t){var o=this,i=this.height,l=this.maxHeight,r=this.showOverflow,n=this.treeConfig,s=this.editStore,a=this.optimizeOpts,c=this.scrollYStore,u=a.scrollY,h=e?e.slice(0):[],d=!n&&u&&u.gt&&u.gt<h.length;c.startIndex=0,c.visibleIndex=0,s.insertList=[],s.removeList=[],this.tableFullData=h,this.updateCache(!0),this.tableSynchData=e,this.tableSourceData=_xeUtils.default.clone(h,!0),!(this.scrollYLoad=d)||i||l||_tools.UtilTools.error("vxe.error.scrollYReqProp",["height | max-height"]),d&&!r&&_tools.UtilTools.warn("vxe.error.scrollYReqProp",["show-overflow"]);var f=Promise.resolve();return d&&(f=this.computeScrollLoad()),f.then(function(){return o.isLoadData=!0,o.computeRowHeight(),o.handleTableData(!0),o.handleReserveStatus(),o.checkSelectionStatus(),f=o.$nextTick(),t||(f=f.then(o.recalculate)),f.then(o.refreshScroll)})},loadData:function(e){return this.loadTableData(e)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.loadTableData(e)}).then(this.handleDefault)},reloadRow:function(e,t,o){var i=this.tableSourceData,l=this.tableData,r=this.getRowIndex(e),n=i[r];return n&&e&&(o?_xeUtils.default.set(n,o,_xeUtils.default.get(t||e,o)):t?(i[r]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(n,_xeUtils.default.clone(e,!0))),this.tableData=l.slice(0),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(l){function e(e,t){var o=_tools.UtilTools.getRowid(r,e);o||(o=getRowUniqueId(),_xeUtils.default.set(e,h,o)),d&&e[n.hasChild]&&_xeUtils.default.isUndefined(e[n.children])&&(e[n.children]=null);var i={row:e,rowid:o,index:t};l&&(s[o]=i,a.set(e,i)),u[o]=i,c.set(e,i)}var r=this,t=this.treeConfig,n=this.treeOpts,o=this.tableFullData,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,u=this.fullAllDataRowIdData,h=_tools.UtilTools.getRowkey(this),d=t&&n.lazy;l&&(s=this.fullDataRowIdData={},a.clear()),u=this.fullAllDataRowIdData={},c.clear(),t?_xeUtils.default.eachTree(o,e,n):o.forEach(e)},appendTreeCache:function(e,t){var l=this,o=this.tableSourceData,i=this.treeOpts,r=this.fullDataRowIdData,n=this.fullDataRowMap,s=this.fullAllDataRowMap,a=this.fullAllDataRowIdData,c=i.children,u=i.hasChild,h=_tools.UtilTools.getRowkey(this),d=_tools.UtilTools.getRowid(this,e),f=_xeUtils.default.findTree(o,function(e){return d===_tools.UtilTools.getRowid(l,e)},i);_xeUtils.default.eachTree(t,function(e,t){var o=_tools.UtilTools.getRowid(l,e);o||(o=getRowUniqueId(),_xeUtils.default.set(e,h,o)),e[u]&&_xeUtils.default.isUndefined(e[c])&&(e[c]=null);var i={row:e,rowid:o,index:t};r[o]=i,n.set(e,i),a[o]=i,s.set(e,i)},i),f&&(f.item[c]=_xeUtils.default.clone(t,!0))},cacheColumnMap:function(){var e=this.isGroup,t=this.tableFullColumn,o=this.collectColumn,i=this.fullColumnMap,l=this.fullColumnIdData={};i.clear(),e&&_xeUtils.default.eachTree(o,function(e,t){if(e.children&&e.children.length){var o={column:e,colid:e.id,index:t};l[e.id]=o,i.set(e,o)}},headerProps),t.forEach(function(e,t){var o={column:e,colid:e.id,index:t};l[e.id]=o,i.set(e,o)},headerProps)},getRowNode:function(e){var t=this;if(e){var o=this.treeConfig,i=this.treeOpts,l=this.tableFullData,r=this.fullAllDataRowIdData,n=e.getAttribute("data-rowid");if(o){var s=_xeUtils.default.findTree(l,function(e){return _tools.UtilTools.getRowid(t,e)===n},i);if(s)return s}else if(r[n]){var a=r[n];return{item:a.row,index:a.index,items:l}}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData,o=this.tableFullColumn,i=t[e.getAttribute("data-colid")];return{item:i.column,index:i.index,items:o}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},$getRowIndex:function(e){return this.afterFullData.indexOf(e)},getColumnMapIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getColumnIndex:function(e){return this.getColumnMapIndex(e)},$getColumnIndex:function(e){return this.visibleColumn.indexOf(e)},isSeqColumn:function(e){return e&&("seq"===e.type||"index"===e.type)},insert:function(e){return this.insertAt(e)},insertAt:function(e,t){var o=this,i=this.afterFullData,l=this.editStore,r=this.scrollYLoad,n=this.tableFullData;if(this.treeConfig)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["insert"]));_xeUtils.default.isArray(e)||(e=[e]);var s=i,a=e.map(function(e){return o.defineField(Object.assign({},e))});if(t)if(-1===t)s.push.apply(s,a),n.push.apply(n,a);else{var c=s.indexOf(t);if(-1===c)throw new Error(_tools.UtilTools.error("vxe.error.unableInsert"));s.splice.apply(s,[c,0].concat(a)),n.splice.apply(n,[n.indexOf(t),0].concat(a))}else s.unshift.apply(s,a),n.unshift.apply(n,a);return[].unshift.apply(l.insertList,a),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),r&&this.updateScrollYSpace(),this.$nextTick().then(function(){return o.recalculate(),{row:a.length?a[a.length-1]:null,rows:a}})},defineField:function(i){var e=this.treeConfig,t=this.treeOpts,o=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,o=e.editRender;t&&!_xeUtils.default.has(i,t)&&_xeUtils.default.set(i,t,o&&!_xeUtils.default.isUndefined(o.defaultValue)?o.defaultValue:null)}),e&&t.lazy&&_xeUtils.default.isUndefined(i[t.children])&&(i[t.children]=null),_xeUtils.default.get(i,o)||_xeUtils.default.set(i,o,getRowUniqueId()),i},createData:function(e){var t=this;return this.$nextTick().then(function(){return e.map(t.defineField)})},createRow:function(t){var o=this,i=_xeUtils.default.isArray(t);return i||(t=[t]),this.$nextTick().then(function(){var e=t.map(function(e){return o.defineField(Object.assign({},e))});return i?e:e[0]})},remove:function(t){var e=this,o=this.afterFullData,i=this.tableFullData,l=this.editStore,r=this.treeConfig,n=this.checkboxOpts,s=this.selection,a=this.hasInsertByRow,c=this.scrollYLoad,u=l.removeList,h=l.insertList,d=n.checkField||n.checkProp,f=[],p=o;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["remove"]));return t?_xeUtils.default.isArray(t)||(t=[t]):t=i,t.forEach(function(e){a(e)||u.push(e)}),d||_xeUtils.default.remove(s,function(e){return-1<t.indexOf(e)}),i===t?(t=f=i.slice(0),i.length=0,p.length=0):(f=_xeUtils.default.remove(i,function(e){return-1<t.indexOf(e)}),_xeUtils.default.remove(p,function(e){return-1<t.indexOf(e)})),_xeUtils.default.remove(h,function(e){return-1<t.indexOf(e)}),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),c&&this.updateScrollYSpace(),this.$nextTick().then(function(){return e.recalculate(),{row:f&&f.length?f[f.length-1]:null,rows:f}})},removeSelecteds:function(){var t=this;return this.remove(this.getSelectRecords()).then(function(e){return t.clearSelection(),e})},revert:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["revert","revertData"]),this.revertData.apply(this,arguments)},revertData:function(e,i){var l=this.tableSourceData,r=this.tableFullData;return arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=r.indexOf(e),o=l[t];o&&e&&(i?_xeUtils.default.set(e,i,_xeUtils.default.clone(_xeUtils.default.get(o,i),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(o,!0)))}),this.$nextTick()):this.reloadData(l)},clearData:function(e,t){var o=this.tableSourceData,i=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=o,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){i.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},hasInsertByRow:function(t){var e=this.treeConfig,o=this.treeOpts,i=this.tableSourceData;return e?_xeUtils.default.findTree(i,function(e){return e===t},o):-1===this.getRowIndex(t)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var o,i,l=this,r=this.visibleColumn,n=this.treeConfig,s=this.treeOpts,a=this.tableSourceData,c=this.fullDataRowIdData,u=_tools.UtilTools.getRowid(this,e);if(!c[u])return!1;if(n){var h=s.children,d=_xeUtils.default.findTree(a,function(e){return u===_tools.UtilTools.getRowid(l,e)},s);e=Object.assign({},e,_defineProperty({},h,null)),d&&(o=Object.assign({},d.item,_defineProperty({},h,null)))}else{o=a[c[u].index]}if(o){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(o,t),_xeUtils.default.get(e,t));for(var f=0,p=r.length;f<p;f++)if((i=r[f].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(o,i),_xeUtils.default.get(e,i)))return!0}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColid:function(e){var t=this.fullColumnMap;return t.has(e)?t.get(e).colid:null},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(t){return _xeUtils.default.find(this.tableFullColumn,function(e){return e.property===t})},getTableColumn:function(){return{fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getRecordset:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){var t=this.editStore.insertList,o=[];return t.length&&this.tableFullData.forEach(function(e){-1<t.indexOf(e)&&o.push(e)}),o},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){var e=this.tableFullData,t=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts.checkField,l=[];if(i)l=t?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,i)},o):e.filter(function(e){return _xeUtils.default.get(e,i)});else{var r=this.selection;l=t?_xeUtils.default.filterTree(e,function(e){return-1<r.indexOf(e)},o):e.filter(function(e){return-1<r.indexOf(e)})}return l},getUpdateRecords:function(){var e=this.tableFullData,t=this.isUpdateByRow,o=this.treeConfig,i=this.treeOpts;return o?_xeUtils.default.filterTree(e,function(e){return t(e)},i):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,o=this.remoteSort,c=this.remoteFilter,u=this.filterOpts,i=this.sortOpts,l=t.slice(0),r=_xeUtils.default.find(e,function(e){return e.order}),n=[];if(e.forEach(function(e){if(e.filters&&e.filters.length){var t=[],o=[];e.filters.forEach(function(e){e.checked&&(o.push(e),t.push(e.value))}),n.push({column:e,valueList:t,itemList:o})}}),n.length&&(l=l.filter(function(a){return n.every(function(e){var t=e.column,o=e.valueList,i=e.itemList;if(!o.length||u.remote||c)return!0;var l=t.filterRender,r=t.property,n=t.filterMethod,s=l?_vXETable.Renderer.get(l.name):null;return!n&&s&&s.renderFilter&&(n=s.filterMethod),n?i.some(function(e){return n({value:e.value,option:e,row:a,column:t})}):-1<o.indexOf(_xeUtils.default.get(a,r))})})),r&&r.order){var s=i.sortMethod||this.sortMethod;if(!(_xeUtils.default.isBoolean(r.remoteSort)?r.remoteSort:i.remote||o))if(s)l=s({data:l,column:r,property:r.property,order:r.order,$table:this})||l;else{var a=r.sortMethod?l.sort(r.sortMethod):_xeUtils.default.sortBy(l,r.property);l="desc"===r.order?a.reverse():a}}return this.afterFullData=l},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,o=this.tableData,i=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:o.slice(0),footerData:i.slice(0)}},handleDefault:function(){(this.checkboxConfig||this.selectConfig)&&this.handleSelectionDefChecked(),this.radioConfig&&this.handleRadioDefChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(o){this.isUpdateCustoms=!0,this.tableFullColumn.forEach(function(t){var e=_xeUtils.default.find(o,function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.$emit("update:customs",this.tableFullColumn)},resetAll:function(){this.resetCustoms(),this.resetResizable()},hideColumn:function(e){return this.handleVisibleColumn(e,!1)},showColumn:function(e){return this.handleVisibleColumn(e,!0)},resetCustoms:function(){return this.handleVisibleColumn()},handleVisibleColumn:function(e,t){return arguments.length?e.visible=t:this.tableFullColumn.forEach(function(e){e.visible=!0}),this.$toolbar&&this.$toolbar.handleCustoms(),this.$nextTick()},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var o,e=this,i=0,l=[],r=null,n=null,s=[],a=[],t=this.collectColumn,c=this.tableFullColumn,u=this.isGroup,h=this.columnStore,d=this.scrollXStore,f=this.optimizeOpts.scrollX;u&&_xeUtils.default.eachTree(t,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),c.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(null===r&&(r=i),o||(t-i!=0?o=!0:i++),l.push(e)):"right"===e.fixed?(o||(null===n&&(n=t),t-n!=0?o=!0:n++),a.push(e)):s.push(e)});var p=l.concat(s).concat(a),g=f&&f.gt&&f.gt<c.length;return Object.assign(h,{leftList:l,centerList:s,rightList:a}),u&&(o||r||null!==n&&n!==p.length)&&_tools.UtilTools.error("vxe.error.groupFixed"),g&&(this.isGroup&&_tools.UtilTools.warn("vxe.error.scrollXNotGroup"),this.showHeaderOverflow||_tools.UtilTools.warn("vxe.error.scrollXReqProp",["show-header-overflow"]),d.startIndex=0,d.visibleIndex=0,p=p.slice(d.startIndex,d.startIndex+d.renderSize)),this.scrollXLoad=g,this.tableColumn=p,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,o=this.columnMinWidth,i=[],l=[],r=[],n=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),o&&!e.minWidth&&(e.minWidth=o),e.visible&&(e.resizeWidth?i.push(e):_tools.DomTools.isPx(e.width||t)?l.push(e):_tools.DomTools.isScale(e.width||t)?n.push(e):_tools.DomTools.isPx(e.minWidth||o)?r.push(e):_tools.DomTools.isScale(e.minWidth||o)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:i,pxList:l,pxMinList:r,scaleList:n,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,o=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||o)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,o)})},recalculate:function(e){var t=this,o=this.$refs,i=o.tableBody,l=o.tableHeader,r=o.tableFooter,n=i?i.$el:null,s=l?l.$el:null,a=r?r.$el:null;if(n){var c=n.clientWidth;if(this.autoCellWidth(s,n,a,c),!0===e)return this.computeScrollLoad().then(function(){c=n.clientWidth,t.autoCellWidth(s,n,a,c),t.computeScrollLoad()})}return this.computeScrollLoad()},autoCellWidth:function(e,t,o,i){var l,r=0,n=i,s=this.fit,a=this.columnStore,c=a.resizeList,u=a.pxMinList,h=a.pxList,d=a.scaleList,f=a.scaleMinList,p=a.autoList;if(u.forEach(function(e){var t=parseInt(e.minWidth);r+=t,e.renderWidth=t}),l=n/100,f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*l);r+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*l);r+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);r+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);r+=t,e.renderWidth=t}),l=0<(n-=r)?Math.floor(n/(f.length+u.length+p.length)):0,s?0<n&&f.concat(u).forEach(function(e){r+=l,e.renderWidth+=l}):l=40,p.forEach(function(e,t){var o=Math.max(l,40);e.renderWidth=o,r+=o}),s){var g=d.concat(f).concat(u).concat(p),v=g.length-1;if(0<v){var x=i-r;if(0<x){for(;0<x&&0<=v;)x--,g[v--].renderWidth++;r=i}}}var m=t.offsetHeight,w=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=w?t.offsetWidth-i:0,this.overflowY=w,this.tableWidth=r,this.tableHeight=m,this.isCoverBody=i-2<=r,this.parentHeight=this.getParentHeight(),e&&(this.headerHeight=e.offsetHeight),o){var b=o.offsetHeight;this.scrollbarHeight=Math.max(b-o.clientHeight,0),this.overflowX=r>o.clientWidth,this.footerHeight=b}else this.scrollbarHeight=Math.max(m-t.clientHeight,0),this.overflowX=i<r;return this.overflowX&&this.checkScrolling(),r},resetResizable:function(){return this.tableFullColumn.forEach(function(e){e.resizeWidth=0}),this.$toolbar&&this.$toolbar.resetResizable(),this.analyColumnWidth(),this.recalculate(!0)},checkScrolling:function(){var e=this.$refs,t=e.tableBody,o=e.leftBody,i=e.rightBody,l=t?t.$el:null;l&&(o&&(this.scrollLeftToRight=0<l.scrollLeft),i&&(this.scrollRightToLeft=l.clientWidth<l.scrollWidth-l.scrollLeft))},preventEvent:function(t,e,o,i,l){var r,n=this;return _vXETable.Interceptor.get(e).some(function(e){return!1===e(o,t,n)})||i&&(r=i()),l&&l(),r},handleGlobalMousedownEvent:function(o){var i=this,l=this.$el,e=this.$refs,t=this.editStore,r=this.ctxMenuStore,n=this.editConfig,s=void 0===n?{}:n,a=this.filterStore,c=this.getRowNode,u=t.actived,h=e.filterWrapper,d=e.validTip;h&&(_tools.DomTools.getEventTargetNode(o,this.$el,"vxe-filter-wrapper").flag||_tools.DomTools.getEventTargetNode(o,h.$el).flag||this.preventEvent(o,"event.clearFilter",a.args,this.closeFilter)),u.row&&!1!==s.autoClear&&(d&&_tools.DomTools.getEventTargetNode(o,d.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(o,"event.clearActived",u.args,function(){var e;if("row"===s.mode){var t=_tools.DomTools.getEventTargetNode(o,l,"vxe-body--row");e=t.flag?c(t.targetElem).item!==c(u.args.cell.parentNode).item:0}else e=!_tools.DomTools.getEventTargetNode(o,l,"col--edit").flag;!e&&_tools.DomTools.getEventTargetNode(o,i.$el).flag||setTimeout(function(){return i.clearActived(o)})})),r.visible&&this.$refs.ctxWrapper&&!_tools.DomTools.getEventTargetNode(o,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=_tools.DomTools.getEventTargetNode(o,(this.$grid||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(L){var A=this;this.isActivated&&this.preventEvent(L,"event.keydown",{$table:this},function(){var e,t=A.isCtxMenu,o=A.ctxMenuStore,i=A.editStore,l=A.mouseConfig,r=void 0===l?{}:l,n=A.keyboardConfig,s=void 0===n?{}:n,a=A.treeConfig,c=A.treeOpts,u=A.highlightCurrentRow,h=A.currentRow,d=i.selected,f=i.actived,p=L.keyCode,g=8===p,v=9===p,x=13===p,m=27===p,w=32===p,b=37===p,T=38===p,C=39===p,_=40===p,R=46===p,S=67===p,y=86===p,E=88===p,D=113===p,U=L.ctrlKey,O=L.shiftKey,k=b||T||C||_,I=t&&o.visible&&(x||w||k);if(m)A.closeMenu(),A.closeFilter(),f.row&&(e=f.args,A.clearActived(L),r.selected&&A.handleSelected(e,L));else if(w&&(s.isArrow||s.isTab)&&d.row&&d.column&&("checkbox"===d.column.type||"selection"===d.column.type||"radio"===d.column.type))L.preventDefault(),"checkbox"===d.column.type||"selection"===d.column.type?A.handleToggleCheckRowEvent(d.args,L):A.triggerRadioRowEvent(L,d.args);else if(x&&(s.isArrow||s.isTab)&&(d.row||f.row||a&&u&&h)){if(d.row||f.row)A.moveSelected(d.row?d.args:f.args,b,T,C,!0,L);else if(a&&u&&h){var $=h[c.children];if($&&$.length){L.preventDefault();var F=$[0];e={$table:A,row:F},A.setTreeExpansion(h,!0).then(function(){return A.scrollToRow(F)}).then(function(){return A.triggerCurrentRowEvent(L,e)})}}}else if(I)L.preventDefault(),o.showChild&&_tools.UtilTools.hasChildrenList(o.selected)?A.moveCtxMenu(L,p,o,"selectChild",37,!1,o.selected.children):A.moveCtxMenu(L,p,o,"selected",39,!0,A.ctxMenuList);else if(D)d.row&&d.column&&(L.preventDefault(),A.handleActived(d.args,L));else if(k&&s.isArrow)d.row&&d.column?A.moveSelected(d.args,b,T,C,_,L):(T||_)&&u&&h&&A.moveCurrentRow(T,_,L);else if(v&&s.isTab)d.row||d.column?A.moveTabSelected(d.args,O,L):(f.row||f.column)&&A.moveTabSelected(f.args,O,L);else if(R||(a&&u&&h?g&&s.isArrow:g)){if(s.isDel&&(d.row||d.column))_tools.UtilTools.setCellValue(d.row,d.column,null),g&&A.handleActived(d.args,L);else if(g&&s.isArrow&&a&&u&&h){var M=_xeUtils.default.findTree(A.afterFullData,function(e){return e===h},c).parent;M&&(L.preventDefault(),e={$table:A,row:M},A.setTreeExpansion(M,!1).then(function(){return A.scrollToRow(M)}).then(function(){return A.triggerCurrentRowEvent(L,e)}))}}else s.isCut&&U&&(E||S||y)?E||S?A.handleCopyed(E,L):A.handlePaste(L):s.isEdit&&!U&&(48<=p&&p<=57||65<=p&&p<=90||96<=p&&p<=111||186<=p&&p<=192||219<=p&&p<=222||32===p)&&(d.row||d.column)&&(s.editMethod&&!1===s.editMethod(d.args,L)||(_tools.UtilTools.setCellValue(d.row,d.column,null),A.handleActived(d.args,L)))})},moveTabSelected:function(e,t,o){var i,l,r,n,s=this.afterFullData,a=this.visibleColumn,c=this.editConfig,u=this.isSeqColumn,h=Object.assign({},e),d=s.indexOf(h.row),f=a.indexOf(h.column);if(o.preventDefault(),t){for(var p=f-1;0<=p;p--)if(!u(a[p])){r=a[n=p];break}if(!r&&0<d){i=s[l=d-1];for(var g=a.length-1;0<=g;g--)if(!u(a[g])){r=a[n=g];break}}}else{for(var v=f+1;v<a.length;v++)if(!u(a[v])){r=a[n=v];break}if(!r&&d<s.length-1){i=s[l=d+1];for(var x=0;x<a.length;x++)if(!u(a[x])){r=a[n=x];break}}}r&&(i?(h.rowIndex=l,h.row=i):h.rowIndex=d,h.columnIndex=n,h.column=r,h.cell=_tools.DomTools.getCell(this,h),c&&("click"!==c.trigger&&"dblclick"!==c.trigger||("row"===c.mode?this.handleActived(h,o):(this.handleSelected(h,o),this.scrollToRow(h.row,h.column)))))},moveCurrentRow:function(e,t,o){var i,l=this,r=this.currentRow,n=this.treeConfig,s=this.treeOpts,a=this.afterFullData;if(o.preventDefault(),n){var c=_xeUtils.default.findTree(a,function(e){return e===r},s),u=c.index,h=c.items;e&&0<u?i=h[u-1]:t&&u<h.length-1&&(i=h[u+1])}else{var d=a.indexOf(r);e&&0<d?i=a[d-1]:t&&d<a.length-1&&(i=a[d+1])}if(i){var f={$table:this,row:i};this.scrollToRow(i).then(function(){return l.triggerCurrentRowEvent(o,f)})}},moveSelected:function(e,t,o,i,l,r){var n=this.afterFullData,s=this.visibleColumn,a=Object.assign({},e);if(r.preventDefault(),o&&a.rowIndex)--a.rowIndex,a.row=n[a.rowIndex];else if(l&&a.rowIndex<n.length-1)a.rowIndex+=1,a.row=n[a.rowIndex];else if(t&&a.columnIndex){for(var c=a.columnIndex-1;0<=c;c--)if(s[c].editRender){a.columnIndex=c,a.column=s[c];break}}else if(i&&a.columnIndex)for(var u=a.columnIndex+1;u<s.length;u++)if(s[u].editRender){a.columnIndex=u,a.column=s[u];break}a.cell=_tools.DomTools.getCell(this,a),this.handleSelected(a,r),this.scrollToRow(a.row,a.column)},moveCtxMenu:function(e,t,o,i,l,r,n){var s,a=_xeUtils.default.findIndexOf(n,function(e){return o[i]===e});if(t===l)r&&_tools.UtilTools.hasChildrenList(o.selected)?o.showChild=!0:(o.showChild=!1,o.selectChild=null);else if(38===t){for(var c=a-1;0<=c;c--)if(!1!==n[c].visible){s=n[c];break}o[i]=s||n[n.length-1]}else if(40===t){for(var u=a+1;u<n.length;u++)if(!1!==n[u].visible){s=n[u];break}o[i]=s||n[0]}else!o[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,o[i])},handleGlobalResizeEvent:function(){this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,o=this.ctxMenuStore,i=this.ctxMenuOpts,l=["header","body","footer"];if(t){if(o.visible&&o.visible&&this.$refs.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var r=0;r<l.length;r++){var n=l[r],s=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(n,"--column")),a={type:n,$table:this,columns:this.visibleColumn.slice(0)};if(s.flag){var c=s.targetElem,u=this.getColumnNode(c).item,h="".concat(n,"-");if(Object.assign(a,{column:u,columnIndex:this.getColumnIndex(u),cell:c}),"body"===n){var d=this.getRowNode(c.parentNode).item;h="",a.row=d,a.rowIndex=this.getRowIndex(d)}return this.openContextMenu(e,n,a),void _tools.UtilTools.emitEvent(this,"".concat(h,"cell-context-menu"),[a,e])}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(n,"-wrapper")).flag)return void("cell"===i.trigger?e.preventDefault():this.openContextMenu(e,n,a))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(c,e,i){var u=this,h=this.ctxMenuStore,t=this.ctxMenuOpts,o=t[e];if(o){var l=o.options,r=o.disabled,d=o.visibleMethod||t.visibleMethod;r?c.preventDefault():l&&l.length&&(i.options=l,this.preventEvent(c,"event.showMenu",i,null,function(){if(!d||d(i,c)){c.preventDefault(),u.updateZindex();var e=_tools.DomTools.getDomNode(),t=e.scrollTop,o=e.scrollLeft,r=e.visibleHeight,n=e.visibleWidth,s=c.clientY+t,a=c.clientX+o;Object.assign(h,{args:i,visible:!0,list:l,selected:null,selectChild:null,showChild:!1,style:{zIndex:u.tZindex,top:"".concat(s,"px"),left:"".concat(a,"px")}}),u.$nextTick(function(){var e=u.$refs.ctxWrapper.$el,t=e.clientHeight,o=e.clientWidth,i=c.clientY+t-r,l=c.clientX+o-n;-10<i&&(h.style.top="".concat(s-t,"px")),-10<l&&(h.style.left="".concat(a-o,"px"))})}else u.closeMenu()}))}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,o){var i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=o)||(i.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t){var o=this.ctxMenuStore;t.children||(o.selected=null),o.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var o=_vXETable.Menus.get(t.code),i=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);o&&o.call(this,i,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t,$table:this},this.ctxMenuStore.args),e]),this.closeMenu()}},handleTooltipLeaveEvent:function(){var e=this,t=this.tooltipOpts;setTimeout(function(){e.tooltipActive||e.clostTooltip()},t.leaveDelay)},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts;this.tooltipActive=!1,t.enterable?this.tooltipTimeout=setTimeout(function(){e.$refs.tooltip.isHover||e.clostTooltip()},t.leaveDelay):this.clostTooltip()},triggerHeaderTooltipEvent:function(e,t){var o=this.tooltipStore,i=t.column;this.handleTargetEnterEvent(),o.column===i&&o.visible||this.handleTooltip(e,i)},triggerFooterTooltipEvent:function(e,t){var o=t.column,i=this.tooltipStore;this.handleTargetEnterEvent(),i.column===o&&i.visible||this.handleTooltip(e,o)},triggerTooltipEvent:function(e,t){var o=this.editConfig,i=this.editStore,l=this.tooltipStore,r=i.actived,n=t.row,s=t.column;this.handleTargetEnterEvent(),o&&("row"===o.mode&&r.row===n||r.row===n&&r.column===s)||l.column===s&&l.row===n&&l.visible||this.handleTooltip(e,s,n)},handleTooltip:function(e,t,o){var i=e.currentTarget,l=this.$refs.tooltip,r=i.children[0],n=i.innerText;return n&&r.scrollWidth>r.clientWidth&&(Object.assign(this.tooltipStore,{row:o,column:t,visible:!0}),l&&l.toVisible(i,n)),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleSelectionDefChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxOpts,o=e.checkAll,i=e.checkRowKeys;if(o)this.setAllSelection(!0);else if(i){var l=[];i.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setSelection(l,!0)}},setSelection:function(e,t){var o=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return o.handleSelectRow(null,{row:e},!!t)}),this.$nextTick()},isCheckedByRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,t,o){var i=this,l=t.row,r=this.selection,n=this.tableFullData,s=this.treeConfig,a=this.treeOpts,c=this.treeIndeterminates,u=this.checkboxOpts,h=u.checkStrictly,d=u.checkMethod,f=u.checkField||u.checkProp;if(f)if(s&&!h){-1===o?(c.push(l),_xeUtils.default.set(l,f,!1)):(_xeUtils.default.eachTree([l],function(e,t){l!==e&&d&&!d({row:e,$rowIndex:t})||(_xeUtils.default.set(e,f,o),i.handleSelectReserveRow(l,o))},a),_xeUtils.default.remove(c,function(e){return e===l}));var p=_xeUtils.default.findTree(n,function(e){return e===l},a);if(p&&p.parent){var g,v=d?p.items.filter(function(e,t){return d({row:e,$rowIndex:t})}):p.items;if(_xeUtils.default.find(p.items,function(e){return-1<c.indexOf(e)}))g=-1;else{var x=p.items.filter(function(e){return _xeUtils.default.get(e,f)});g=x.filter(function(e){return-1<v.indexOf(e)}).length===v.length||!(!x.length&&-1!==o)&&-1}return this.handleSelectRow(e,{row:p.parent},g)}}else _xeUtils.default.set(l,f,o),this.handleSelectReserveRow(l,o);else if(s&&!h){-1===o?(c.push(l),_xeUtils.default.remove(r,function(e){return e===l})):(_xeUtils.default.eachTree([l],function(t,e){l!==t&&d&&!d({row:t,$rowIndex:e})||(o?r.push(t):_xeUtils.default.remove(r,function(e){return e===t}),i.handleSelectReserveRow(l,o))},a),_xeUtils.default.remove(c,function(e){return e===l}));var m=_xeUtils.default.findTree(n,function(e){return e===l},a);if(m&&m.parent){var w,b=d?m.items.filter(function(e,t){return d({row:e,$rowIndex:t})}):m.items;if(_xeUtils.default.find(m.items,function(e){return-1<c.indexOf(e)}))w=-1;else{var T=m.items.filter(function(e){return-1<r.indexOf(e)});w=T.filter(function(e){return-1<b.indexOf(e)}).length===b.length||!(!T.length&&-1!==o)&&-1}return this.handleSelectRow(e,{row:m.parent},w)}}else o?-1===r.indexOf(l)&&r.push(l):_xeUtils.default.remove(r,function(e){return e===l}),this.handleSelectReserveRow(l,o);this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var o=this.selection,i=this.checkboxOpts.checkField,l=e.row,r=i?!_xeUtils.default.get(l,i):-1===o.indexOf(l);t?this.triggerCheckRowEvent(t,e,r):this.handleSelectRow(null,e,r)},triggerCheckRowEvent:function(e,t,o){var i=this.checkboxOpts.checkMethod;i&&!i({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})||(this.handleSelectRow(e,t,o),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getSelectRecords(),reserves:this.getSelectReserveRecords(),checked:o,$table:this},t),e]))},toggleRowSelection:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(i){var o=this,e=this.tableFullData,t=this.editStore,l=this.treeConfig,r=this.treeOpts,n=this.selection,s=this.selectReserveRowMap,a=this.checkboxOpts,c=a.reserve,u=a.checkStrictly,h=a.checkMethod,d=t.insertList,f=a.checkField||a.checkProp,p=[];if(d.length&&(e=e.concat(d)),!u){if(f){var g="".concat(l?"$":"","rowIndex"),v=function(e,t){var o;h&&!h((_defineProperty(o={row:e},g,t),_defineProperty(o,"$rowIndex",t),o))||_xeUtils.default.set(e,f,i)},x=function(e,t){var o;(!h||!h((_defineProperty(o={row:e},g,t),_defineProperty(o,"$rowIndex",t),o))&&-1<n.indexOf(e))&&_xeUtils.default.set(e,f,i)};l?_xeUtils.default.eachTree(e,i?v:x,r):e.forEach(i?v:x)}else l?i?_xeUtils.default.eachTree(e,function(e,t){h&&!h({row:e,$rowIndex:t})||p.push(e)},r):h&&_xeUtils.default.eachTree(e,function(e,t){!h({row:e,$rowIndex:t})&&-1<n.indexOf(e)&&p.push(e)},r):i?p=h?e.filter(function(e,t){return-1<n.indexOf(e)||h({row:e,rowIndex:t,$rowIndex:t})}):e.slice(0):h&&(p=e.filter(function(e,t){return h({row:e,rowIndex:t,$rowIndex:t})?0:-1<n.indexOf(e)}));c&&(i?p.forEach(function(e){s[_tools.UtilTools.getRowid(o,e)]=e}):e.forEach(function(e){var t=_tools.UtilTools.getRowid(o,e);s[t]&&delete s[t]})),this.selection=p}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.tableFullData,t=this.editStore,o=this.selection,i=this.treeIndeterminates,l=this.checkboxOpts,r=l.checkStrictly,n=l.checkMethod,s=l.checkField||l.checkProp,a=t.insertList;a.length&&(e=e.concat(a)),r||(s?(this.isAllSelected=e.length&&e.every(n?function(e,t){return!n({row:e,rowIndex:t,$rowIndex:t})||_xeUtils.default.get(e,s)}:function(e){return _xeUtils.default.get(e,s)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,s)||-1<i.indexOf(e)})):(this.isAllSelected=e.length&&e.every(n?function(e,t){return!n({row:e,rowIndex:t,$rowIndex:t})||-1<o.indexOf(e)}:function(e){return-1<o.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<i.indexOf(e)||-1<o.indexOf(e)})))},handleReserveStatus:function(){var e=this.rowId,t=this.treeConfig,o=this.fullDataRowIdData,i=this.selectReserveRowMap,l=this.checkboxOpts,r=[],n=[],s=[],a=[];e&&this.handleReserveByRowid(this.selection,r),l.reserve&&Object.keys(i).forEach(function(e){o[e]&&-1===r.indexOf(o[e].row)&&r.push(o[e].row)}),this.selection=r,e&&this.handleReserveByRowid(this.rowExpandeds,n),this.rowExpandeds=n,e&&t&&(this.handleReserveByRowid(this.treeIndeterminates,a),this.handleReserveByRowid(this.treeExpandeds,s)),this.treeExpandeds=s,this.treeIndeterminates=a},handleReserveByRowid:function(e,o){var i=this,l=this.fullDataRowIdData;e.forEach(function(e){var t=_tools.UtilTools.getRowid(i,e);l[t]&&o.push(l[t].row)})},getSelectReserveRecords:function(){var t=this.fullDataRowIdData,o=this.selectReserveRowMap,e=this.checkboxOpts,i=[];return e.reserve&&Object.keys(o).forEach(function(e){t[e]||i.push(o[e])}),i},clearSelectReserve:function(){this.selectReserveRowMap={}},handleSelectReserveRow:function(e,t){var o=this.selectReserveRowMap;if(this.checkboxOpts.reserve){var i=_tools.UtilTools.getRowid(this,e);t?o[i]=e:o[i]&&delete o[i]}},triggerCheckAllEvent:function(e,t){this.setAllSelection(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getSelectRecords(),reserves:this.getSelectReserveRecords(),checked:t,$table:this},e])},toggleAllSelection:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){var e=this.tableFullData,t=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts,l=i.checkField||i.checkProp;return l&&(t?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,l,!1)},o):e.forEach(function(e){return _xeUtils.default.set(e,l,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleRadioDefChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,o=e.checkRowKey;o&&this.setRadioRow(t[o].row)},triggerRadioRowEvent:function(e,t){var o=this.radioOpts.checkMethod;if(!o||o({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})){var i=this.selectRow!==t.row;this.setRadioRow(t.row),i&&_tools.UtilTools.emitEvent(this,"radio-change",[t,e])}},triggerCurrentRowEvent:function(e,t){var o=this.currentRow!==t.row;this.setCurrentRow(t.row),o&&_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){return this.highlightCurrentRow&&(this.clearCurrentColumn(),this.currentRow=e),this.$nextTick()},setRadioRow:function(e){return this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.currentRow},getRadioRow:function(){return this.selectRow},triggerHoverEvent:function(e,t){var o=t.row;this.hoverRow=o},clearHoverRow:function(){this.hoverRow=null},triggerCellMousedownEvent:function(e,t){var l=this.$el,o=this.tableData,i=this.visibleColumn,r=this.editStore,n=this.editConfig,s=this.handleSelected,a=this.handleChecked,c=r.checked,u=r.actived,h=t.row,d=t.column,f=t.cell,p=e.button,g=0===p;if((g||2===p)&&n&&"dblclick"===n.trigger&&!("row"===n.mode&&u.row===h||u.row===h&&u.column===d))if(g){e.preventDefault(),e.stopPropagation(),this.handleSelected(t,e);var v=document.onmousemove,x=document.onmouseup,m=_tools.DomTools.getCellIndexs(f),w=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),o=t.flag,i=t.targetElem;o&&a(m,_tools.DomTools.getCellIndexs(i),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=w,document.onmouseup=function(e){document.onmousemove=v,document.onmouseup=x},this.closeFilter(),this.closeMenu()}else{var b=_tools.DomTools.getCellIndexs(f);-1!==c.rows.indexOf(o[b.rowIndex])&&-1!==c.columns.indexOf(i[b.columnIndex])||s(t,e)}this.isActivated=!0},triggerCornerMousedownEvent:function(e,t){t.preventDefault(),t.stopPropagation();var l=this.$el,o=this.tableData,i=this.visibleColumn,r=this.editStore,n=this.editConfig,s=this.handleTempChecked,a=r.checked,c=t.button;if((0===c||2===c)&&n&&a.rows.length&&"dblclick"===n.trigger){var u=document.onmousemove,h=document.onmouseup,d={rowIndex:o.indexOf(a.rows[0]),columnIndex:i.indexOf(a.columns[0])},f=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),o=t.flag,i=t.targetElem;o&&s(d,_tools.DomTools.getCellIndexs(i),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=f,document.onmouseup=function(e){document.onmousemove=u,document.onmouseup=h,a.rows=a.tRows,a.columns=a.tColumns}}this.isActivated=!0},triggerHeaderCellClickEvent:function(e,t){var o=this._lastResizeTime,i=this.sortOpts,l=t.column,r=t.cell,n=o&&o>Date.now()-300,s=_tools.DomTools.getEventTargetNode(e,r,"vxe-sort-wrapper").flag,a=_tools.DomTools.getEventTargetNode(e,r,"vxe-filter-wrapper").flag;return"cell"!==i.trigger||n||s||a||this.triggerSortEvent(e,l,"desc"===l.order?"asc":"desc"),_tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerResizable:n,triggerSort:s,triggerFilter:a},t),e]),this.setCurrentColumn(l,!0)},setCurrentColumn:function(e){return this.highlightCurrentColumn&&(this.clearCurrentRow(),this.currentColumn=e),this.$nextTick()},clearCurrentColumn:function(){this.currentColumn=null},triggerCellClickEvent:function(e,t){var o=this,i=this.$el,l=this.highlightCurrentRow,r=this.editStore,n=this.radioOpts,s=this.expandOpts,a=this.treeOpts,c=this.editConfig,u=this.checkboxOpts,h=r.actived,d=t.column,f=t.row;isTargetRadioOrCheckbox(e,d,"radio")||isTargetRadioOrCheckbox(e,d,"checkbox","checkbox")||isTargetRadioOrCheckbox(e,d,"selection","checkbox")||("row"!==s.trigger&&("expand"!==d.type||"cell"!==s.trigger)||_tools.DomTools.getEventTargetNode(e,i,"vxe-table--expanded").flag||this.triggerRowExpandEvent(e,t),("row"===a.trigger||d.treeNode&&"cell"===a.trigger)&&this.triggerTreeExpandEvent(e,t),d.treeNode&&_tools.DomTools.getEventTargetNode(e,i,"vxe-tree-wrapper").flag||"expand"===d.type&&_tools.DomTools.getEventTargetNode(e,i,"vxe-table--expanded").flag||(l&&("row"!==n.trigger&&(_tools.DomTools.getEventTargetNode(e,i,"vxe-checkbox").flag||_tools.DomTools.getEventTargetNode(e,i,"vxe-radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==n.trigger&&("radio"!==d.type||"cell"!==n.trigger)||_tools.DomTools.getEventTargetNode(e,i,"vxe-radio").flag||this.triggerRadioRowEvent(e,t),"row"!==u.trigger&&("checkbox"!==d.type&&"selection"!==d.type||"cell"!==u.trigger)||_tools.DomTools.getEventTargetNode(e,t.cell,"vxe-checkbox").flag||this.handleToggleCheckRowEvent(t,e),c&&("click"===c.trigger?h.args&&f===h.row&&d===h.column||("row"===c.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):"cell"===c.mode&&this.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})):"dblclick"===c.trigger&&("row"===c.mode&&h.row===f?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):this.handleSelected(t,e)))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e]))},triggerCellDBLClickEvent:function(e,t){var o=this,i=this.editStore,l=this.editConfig,r=i.actived;l&&"dblclick"===l.trigger&&(r.args&&e.currentTarget===r.args.cell||("row"===l.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):"cell"===l.mode&&this.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var o=this,i=this.editStore,l=this.editConfig,r=l.activeMethod,n=i.actived,s=e.row,a=e.column,c=e.cell;if(a.editRender&&c)if("row"===l.mode?n.row!==s:n.row!==s||n.column!==a){var u="edit-disabled";r&&!r(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(t),this.clearSelected(t),this.clearActived(t),u="edit-actived",a.renderHeight=c.offsetHeight,n.args=e,n.row=s,n.column=a,this.$nextTick(function(){o.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,u,[e,t])}else a.renderHeight=c.offsetHeight,n.args=e,n.column!==a&&this.clearValidate(),setTimeout(function(){o.handleFocus(e,t)});return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,o=t.args,i=t.row,l=t.column;return(i||l)&&(this.updateFooter(),_tools.UtilTools.emitEvent(this,"edit-closed",[o,e])),t.args=null,t.row=null,t.column=null,this.clearValidate()},getActiveRow:function(){var e=this.$el,t=this.editStore,o=this.afterFullData,i=t.actived,l=i.args,r=i.row;return l&&-1<o.indexOf(r)&&e.querySelectorAll(".vxe-body--column.col--actived").length?Object.assign({},l):null},hasActiveRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasActiveRow","isActiveByRow"]),this.isActiveByRow(e)},isActiveByRow:function(e){return this.editStore.actived.row===e},clearSelected:function(){var e=this.editStore.selected;return e.row=null,e.column=null,this.$nextTick()},handleSelected:function(t,o){var i=this,e=this.mouseConfig,l=void 0===e?{}:e,r=this.editConfig,n=this.editStore,s=n.actived,a=n.selected,c=t.row,u=t.column;return function(){if((l.selected||l.checked)&&(a.row!==c||a.column!==u)&&(s.row!==c||"cell"===r.mode&&s.column!==u)&&(i.clearChecked(o),i.clearActived(o),a.args=t,a.row=c,a.column=u,l.checked)){var e=_tools.DomTools.getCellIndexs(t.cell);i.handleChecked(e,e,o)}return i.$nextTick()}()},clearChecked:function(){var e=this.editStore.checked;return e.rows=[],e.columns=[],e.tRows=[],e.tColumns=[],this.$nextTick()},getMouseSelecteds:function(){var e=this.editStore.selected,t=e.args,o=e.column;return t&&o?Object.assign({},t):null},getMouseCheckeds:function(){var e=this.editStore.checked,t=e.rows;return{columns:e.columns,rows:t}},handleChecked:function(e,t){var o=this.tableData,i=this.visibleColumn,l=this.editStore.checked,r=e.rowIndex,n=e.columnIndex,s=t.rowIndex,a=t.columnIndex;l.tRows=[],l.tColumns=[],l.rows=r<s?o.slice(r,s+1):o.slice(s,r+1),l.columns=n<a?i.slice(Math.max(n,1),a+1):i.slice(Math.max(a,1),n+1)},handleTempChecked:function(e,t){var o=this.tableData,i=this.visibleColumn,l=this.editStore.checked,r=l.rows,n=l.tRows,s=l.columns,a=l.tColumns,c=e.rowIndex,u=e.columnIndex,h=t.rowIndex,d=t.columnIndex;n.length>r.length?d=i.indexOf(s[s.length-1]):a.length>s.length&&(h=o.indexOf(r[r.length-1])),c<h?l.tRows=o.slice(c,h+1):(c+=r.length,l.tRows=o.slice(h,c)),u<d?l.tColumns=i.slice(Math.max(u,1),d+1):(u+=s.length,l.tColumns=i.slice(Math.max(d,1),u))},clearCopyed:function(){var e=this.editStore.copyed;return e.cut=!1,e.rows=[],e.columns=[],this.$nextTick()},handleCopyed:function(e){var t=this.editStore,o=t.copyed,i=t.checked;o.cut=e,o.rows=i.rows,o.columns=i.columns},handlePaste:function(e){var t=this.tableData,r=this.visibleColumn,o=this.editStore,i=o.copyed,l=o.selected,n=i.cut,s=i.rows,a=i.columns;if(s.length&&a.length&&l.row&&l.column){var c=l.args,u=c.rowIndex,h=c.columnIndex,d={rowIndex:u,columnIndex:h},f={rowIndex:u+s.length-1,columnIndex:h+a.length-1};s.forEach(function(i,e){var l=t[u+e];l&&a.forEach(function(e,t){var o=r[h+t];o&&_tools.UtilTools.setCellValue(l,o,_tools.UtilTools.getCellValue(i,e)),n&&_tools.UtilTools.setCellValue(i,e,null)})}),n&&this.clearCopyed(),this.handleChecked(d,f,e)}},handleFocus:function(e){var t=e.row,o=e.column,i=e.cell,l=o.editRender;if(l){var r,n=_vXETable.Renderer.get(l.name),s=l.autofocus,a=l.autoselect;if(s&&(r=i.querySelector(s)),!r&&n&&n.autofocus&&(r=i.querySelector(n.autofocus)),r){if(r[a?"select":"focus"](),browse.msie){var c=r.createTextRange();c.collapse(!1),c.select()}}else this.scrollToRow(t,o)}},setActiveRow:function(e){return this.setActiveCell(e,_xeUtils.default.find(this.visibleColumn,function(e){return e.editRender}).property)},setActiveCell:function(o,i){var l=this;return this.scrollToRow(o).then(function(){if(o&&i){var e=_xeUtils.default.find(l.visibleColumn,function(e){return e.property===i});if(e&&e.editRender){var t=_tools.DomTools.getCell(l,{row:o,column:e});t&&(l.handleActived({row:o,rowIndex:l.getRowIndex(o),column:e,columnIndex:l.getColumnIndex(e),cell:t,$table:l}),l.lastCallTime=Date.now())}}return l.$nextTick()})},setSelectCell:function(e,t){var o=this.tableData,i=this.editConfig,l=this.visibleColumn;if(e&&t&&"manual"!==i.trigger){var r=_xeUtils.default.find(l,function(e){return e.property===t}),n=o.indexOf(e);if(-1<n&&r){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:n,column:r}),a={row:e,rowIndex:n,column:r,columnIndex:l.indexOf(r),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},handleDefaultSort:function(){var e=this.sortOpts.defaultSort;if(e){var t=e.field,o=e.order;t&&o&&this.sort(t,o)}},triggerSortEvent:function(e,t,o){var i=t.property;if(t.sortable||t.remoteSort){var l={column:t,property:i,field:i,prop:i,order:o,$table:this};t.order===o?(l.order=null,this.clearSort(t.property)):this.sort(i,o),_tools.UtilTools.emitEvent(this,"sort-change",[l,e])}},sort:function(t,e){var o=this.visibleColumn,i=this.tableFullColumn,l=this.remoteSort,r=this.sortOpts,n=_xeUtils.default.find(o,function(e){return e.property===t});if(n){var s=_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:r.remote||l;(n.sortable||n.remoteSort)&&(e=e||("desc"===n.order?"asc":"desc"),n.order!==e&&(i.forEach(function(e){e.order=null}),n.order=e,s||this.handleTableData(!0)))}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},getSortColumn:function(){return this.visibleColumn.fild(function(e){return e.sortable&&e.order})},filter:function(e,t){var o=this.getColumnByField(e);if(o){var i=o.filters;if(t){var l=t(i);_xeUtils.default.isArray(l)&&(o.filters=_tools.UtilTools.getFilters(l))}return this.$nextTick().then(function(){return i})}return this.$nextTick()},triggerFilterEvent:function(e,s,t){var o=this.$refs,a=this.filterStore;if(a.column===s&&a.visible)a.visible=!1;else{var c=o.filterWrapper,u=o.tableBody.$el,h=e.target,d=e.pageX,f=_tools.DomTools.getDomNode().visibleWidth;Object.assign(a,{args:t,multiple:s.filterMultiple,options:s.filters,column:s,style:null,visible:!0}),a.isAllSelected=a.options.every(function(e){return e.checked}),a.isIndeterminate=!a.isAllSelected&&a.options.some(function(e){return e.checked}),this.$nextTick(function(){var e,t,o=c.$el.offsetWidth,i=o/2,l={top:"".concat(h.offsetTop+h.offsetParent.offsetTop+h.offsetHeight+8,"px")};if("left"===s.fixed?e=h.offsetLeft+h.offsetParent.offsetLeft-i:"right"===s.fixed?t=h.offsetParent.offsetWidth-h.offsetLeft+(h.offsetParent.offsetParent.offsetWidth-h.offsetParent.offsetLeft)-s.renderWidth-i:e=h.offsetLeft+h.offsetParent.offsetLeft-i-u.scrollLeft,e){var r=d+o-i+32-f;0<r&&(e-=r),l.left="".concat(Math.max(32,e),"px")}else if(t){var n=d+o-i+32-f;0<n&&(t+=n),l.right="".concat(t,"px")}a.style=l})}},confirmFilterEvent:function(){var e=this.visibleColumn,t=this.filterStore,o=this.remoteFilter,i=this.filterOpts,l=this.scrollXLoad,r=this.scrollYLoad,n=t.column,s=n.property,a=[],c=[];n.filters.forEach(function(e){e.checked&&(a.push(e.value),c.push(e.data))}),t.visible=!1,i.remote||o||this.handleTableData(!0);var u=[];e.filter(function(e){var t=e.property,o=e.filters,i=[],l=[];o&&o.length&&(o.forEach(function(e){e.checked&&(i.push(e.value),l.push(e.data))}),u.push({column:e,property:t,field:t,prop:t,values:i,datas:l}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:n,property:s,field:s,prop:s,values:a,datas:c,filters:u,$table:this}]),this.updateFooter(),(l||r)&&this.clearScroll(),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){if(e){var t=this.getColumnByField(e);return t.filters&&t.filters.some(function(e){return e.checked})}return this.visibleColumn.some(function(e){return e.filters&&e.filters.some(function(e){return e.checked})})},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(e){function t(e){var t=e.filters;t&&t.length&&t.forEach(function(e){e.checked=!1,e.data=e._data})}var o=arguments.length?this.getColumnByField(e):null,i=this.filterStore;return o?t(o):this.visibleColumn.forEach(t),o&&o===i.column||Object.assign(i,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,o=this.expandLazyLoadeds,i=this.fullAllDataRowMap,l=e.lazy,r=i.get(t);return l&&r&&(r.expandLoaded=!1,_xeUtils.default.remove(o,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,o=this.expandOpts,i=this.expandLazyLoadeds;return o.lazy&&-1===i.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var o=this.$listeners,i=this.expandOpts,l=this.expandLazyLoadeds,r=t.row;if(!i.lazy||-1===l.indexOf(r)){var n=!this.isExpandByRow(r);this.setRowExpansion(r,n),o["toggle-expand-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-expand-change","toggle-row-expand"]),_tools.UtilTools.emitEvent(this,"toggle-expand-change",[{expanded:n,row:r,rowIndex:this.getRowIndex(r),$table:this},e])):_tools.UtilTools.emitEvent(this,"toggle-row-expand",[{expanded:n,row:r,rowIndex:this.getRowIndex(r),$table:this},e])}},toggleRowExpansion:function(e){return this.setRowExpansion(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,o=e.expandAll,i=e.expandRowKeys;if(o)this.setAllRowExpansion(!0);else if(i){var l=[];i.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setRowExpansion(l,!0)}},setAllRowExpansion:function(e){return this.expandOpts.lazy?this.setRowExpansion(this.tableData,!0):(this.rowExpandeds=e?this.tableFullData.slice(0):[],this.$nextTick().then(this.recalculate))},handleAsyncRowExpand:function(t){var o=this,e=this.fullAllDataRowMap,i=this.rowExpandeds,l=this.expandLazyLoadeds,r=this.expandOpts.loadMethod,n=e.get(t);return new Promise(function(e){l.push(t),r({$table:o,row:t}).catch(function(e){return e}).then(function(){n.expandLoaded=!0,_xeUtils.default.remove(l,function(e){return e===t}),i.push(t),e(o.$nextTick().then(o.recalculate))})})},setRowExpansion:function(t,e){var o=this,i=this.fullAllDataRowMap,l=this.rowExpandeds,r=this.expandLazyLoadeds,n=this.expandOpts,s=n.lazy,a=n.accordion,c=[];return t&&(_xeUtils.default.isArray(t)||(t=[t]),a&&(l=[],t=t.slice(t.length-1,t.length)),e?t.forEach(function(e){if(-1===l.indexOf(e)){var t=i.get(e);s&&!t.expandLoaded&&-1===r.indexOf(e)?c.push(o.handleAsyncRowExpand(e)):l.push(e)}}):_xeUtils.default.remove(l,function(e){return-1<t.indexOf(e)})),this.rowExpandeds=l,Promise.all(c).then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var e=this,t=this.rowExpandeds.length;return this.rowExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,o=this.treeExpandeds,i=this.fullAllDataRowMap,l=e.lazy,r=i.get(t);return l&&r&&(r.treeLoaded=!1,_xeUtils.default.remove(o,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,o=this.treeOpts,i=this.treeLazyLoadeds,l=o.lazy,r=o.hasChild;return l&&e[r]&&-1===i.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var o=this.$listeners,i=this.treeOpts,l=this.treeLazyLoadeds,r=t.row;if(!i.lazy||-1===l.indexOf(r)){var n=!this.isTreeExpandByRow(r);this.setTreeExpansion(r,n),o["toggle-tree-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-tree-change","toggle-tree-expand"]),_tools.UtilTools.emitEvent(this,"toggle-tree-change",[{expanded:n,row:r,rowIndex:this.getRowIndex(r),$table:this},e])):_tools.UtilTools.emitEvent(this,"toggle-tree-expand",[{expanded:n,row:r,rowIndex:this.getRowIndex(r),$table:this},e])}},toggleTreeExpansion:function(e){return this.setTreeExpansion(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,o=this.treeOpts,i=this.tableFullData;if(e){var t=o.expandAll,l=o.expandRowKeys;if(t)this.setAllTreeExpansion(!0);else if(l){var r=[],n=_tools.UtilTools.getRowkey(this);l.forEach(function(t){var e=_xeUtils.default.findTree(i,function(e){return t===_xeUtils.default.get(e,n)},o);e&&r.push(e.item)}),this.setTreeExpansion(r,!0)}}},handleAsyncTreeExpandChilds:function(o){var i=this,e=this.fullAllDataRowMap,l=this.treeExpandeds,t=this.treeOpts,r=this.treeLazyLoadeds,n=t.loadMethod,s=t.children,a=e.get(o);return new Promise(function(t){r.push(o),n({$table:i,row:o}).catch(function(e){return[]}).then(function(e){a.treeLoaded=!0,_xeUtils.default.remove(r,function(e){return e===o}),_xeUtils.default.isArray(e)||(e=[]),e&&(o[s]=e,i.appendTreeCache(o,e),e.length&&-1===l.indexOf(o)&&l.push(o),i.isCheckedByRow(o)&&i.setSelection(e,!0)),t(i.$nextTick().then(i.recalculate))})})},setAllTreeExpansion:function(e){var t=this,o=this.tableFullData,i=this.treeOpts,l=i.lazy,r=i.children;if(e)if(l)_xeUtils.default.eachTree(o,function(e){t.setTreeExpansion(e,!0)},i);else{var n=[];_xeUtils.default.eachTree(o,function(e){var t=e[r];t&&t.length&&n.push(e)},i),this.treeExpandeds=n}else this.treeExpandeds=[];return this.$nextTick().then(this.recalculate)},setTreeExpansion:function(t,e){var o=this,i=this.fullAllDataRowMap,l=this.tableFullData,r=this.treeExpandeds,n=this.treeOpts,s=this.treeLazyLoadeds,a=n.lazy,c=n.hasChild,u=n.children,h=n.accordion,d=[];if(t&&(_xeUtils.default.isArray(t)||(t=[t]),t.length)){if(h){t=t.slice(t.length-1,t.length);var f=_xeUtils.default.findTree(l,function(e){return e===t[0]},n);_xeUtils.default.remove(r,function(e){return-1<f.items.indexOf(e)})}return e?t.forEach(function(e){if(-1===r.indexOf(e)){var t=i.get(e);a&&e[c]&&!t.treeLoaded&&-1===s.indexOf(e)?d.push(o.handleAsyncTreeExpandChilds(e)):e[u]&&e[u].length&&r.push(e)}}):_xeUtils.default.remove(r,function(e){return-1<t.indexOf(e)}),Promise.all(d).then(this.recalculate)}return Promise.resolve()},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var e=this,t=this.treeExpandeds.length;return this.treeExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},isScrollXLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollXLoad","getVirtualScroller"]),this.scrollXLoad},isScrollYLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollYLoad","getVirtualScroller"]),this.scrollYLoad},getVirtualScroller:function(){var e=this.$refs,t=this.scrollXLoad,o=this.scrollYLoad,i=e.tableBody.$el;return{scrollX:t,scrollY:o,scrollTop:i.scrollTop,scrollLeft:i.scrollLeft}},triggerScrollXEvent:function(){this.updateVirtualScrollX()},updateVirtualScrollX:function(e){for(var t=this.$refs,o=this.visibleColumn,i=this.scrollXStore,l=i.startIndex,r=i.renderSize,n=i.offsetSize,s=i.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,u=0,h=e||!1,d=o.length,f=0;f<d;f++)if(a<(u+=o[f].renderWidth)){c=f;break}if(e||i.visibleIndex!==c){var p=Math.min(Math.floor((r-s)/2),s);i.visibleIndex===c?i.startIndex=c:i.visibleIndex>c?(h=c-n<=l)&&(i.startIndex=Math.max(0,Math.max(0,c-p))):(h=l+r<=c+s+n)&&(i.startIndex=Math.max(0,Math.min(o.length-r,c-p))),h&&this.updateScrollXData(),i.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:_xeUtils.default.debounce(function(e){var t=this.afterFullData,o=this.scrollYStore,i=this.isLoadData,l=o.startIndex,r=o.renderSize,n=o.offsetSize,s=o.visibleSize,a=o.rowHeight,c=e.target.scrollTop,u=Math.ceil(c/a),h=!1;if(i||o.visibleIndex!==u){var d=Math.min(Math.floor((r-s)/2),s);o.visibleIndex>u?(h=u-n<=l)&&(o.startIndex=Math.max(0,u-Math.max(d,r-s))):(h=l+r<=u+s+n)&&(o.startIndex=Math.max(0,Math.min(t.length-r,u-d))),h&&this.updateScrollYData(),o.visibleIndex=u,this.isLoadData=!1}},debounceScrollYDuration,{leading:!1,trailing:!0}),computeRowHeight:function(){var e,t=this.$refs.tableBody,o=t?t.$el:null,i=this.$refs.tableHeader;if(o){var l=o.querySelector("tbody>tr");!l&&i&&(l=i.$el.querySelector("thead>tr")),l&&(e=l.clientHeight)}e=e||this.rowHeightMaps[this.vSize||"default"],this.rowHeight=e},computeScrollLoad:function(){var w=this;return this.$nextTick().then(function(){var e=w.vSize,t=w.scrollXLoad,o=w.scrollYLoad,i=w.scrollYStore,l=w.scrollXStore,r=w.visibleColumn,n=w.optimizeOpts,s=w.rowHeightMaps,a=n.scrollX,c=n.scrollY,u=w.$refs.tableBody,h=u?u.$el:null,d=w.$refs.tableHeader;if(h){if(t){var f=r[0],p=f?f.renderWidth:40,g=_xeUtils.default.toNumber(a.vSize||Math.ceil(h.clientWidth/p));l.visibleSize=g,a.oSize||(l.offsetSize=g),a.rSize||(l.renderSize=g+4),w.updateScrollXData()}else w.updateScrollXSpace();if(o){var v;if(c.rHeight)v=c.rHeight;else{var x=h.querySelector("tbody>tr");!x&&d&&(x=d.$el.querySelector("thead>tr")),x&&(v=x.clientHeight)}v=v||s[e||"default"];var m=_xeUtils.default.toNumber(c.vSize||Math.ceil(h.clientHeight/v));i.visibleSize=m,i.rowHeight=v,c.oSize||(i.offsetSize=m),c.rSize||(i.renderSize=m*(browse.edge?10:8)),w.updateScrollYData()}else w.updateScrollYSpace()}return w.$nextTick()})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.visibleColumn,t=this.scrollXStore;t.leftSpaceWidth=e.slice(0,t.startIndex).reduce(function(e,t){return e+t.renderWidth},0),t.rightSpaceWidth=e.slice(t.startIndex+t.renderSize,e.length).reduce(function(e,t){return e+t.renderWidth},0)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var e=this.scrollYStore,t=this.afterFullData,o=t.length*e.rowHeight;e.ySpaceHeight=o,e.topSpaceHeight=Math.max(e.startIndex*e.rowHeight,0),e.bottomSpaceHeight=Math.max((t.length-(e.startIndex+e.renderSize))*e.rowHeight,0)},scrollTo:function(e,t){var o=this,i=this.$refs.tableBody.$el;if(_xeUtils.default.isNumber(e)){var l=this.$refs.tableFooter;l?l.$el.scrollLeft=e:i.scrollLeft=e}if(_xeUtils.default.isNumber(t)){var r=this.$refs.rightBody;r&&(r.$el.scrollTop=t),i.scrollTop=t}return this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(o.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var o=[];return e&&(this.treeConfig?o.push(this.scrollToTreeRow(e)):this.fullAllDataRowMap.has(e)&&o.push(_tools.DomTools.rowToVisible(this,e))),o.push(this.scrollToColumn(t)),Promise.all(o)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var o=this,e=this.tableFullData,i=this.treeConfig,l=this.treeOpts;if(i){var r=_xeUtils.default.findTree(e,function(e){return e===t},l);if(r){var n=r.nodes;n.forEach(function(e,t){t<n.length-1&&!o.hasTreeExpand(e)&&o.setTreeExpansion(e,!0)})}}return this.$nextTick()},clearScroll:function(){var r=this;return this.updateScrollXSpace(),this.updateScrollYSpace(),this.$nextTick().then(function(){var e=r.$refs,t=e.tableBody,o=t?t.$el:null,i=e.tableFooter,l=(i?i.$el:null)||o;return o&&(o.scrollTop=0),l&&(l.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(r.$nextTick())})})})},updateFooter:function(){var e=this.showFooter,t=this.tableColumn,o=this.footerMethod;return e&&o&&(this.footerData=t.length?o({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(a,c){var u=this,h=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=u.$refs,t=u.tableData,o=u.editRules,i=u.validStore;if(a&&e.tableBody&&o){var l=a.row,r=a.column;if(u.hasCellRules("change",l,r)){var n=t.indexOf(l),s=_tools.DomTools.getCell(u,{row:l,rowIndex:n,column:r});if(s)return u.validCellRules("change",l,r,c).then(function(){h&&i.visible&&_tools.UtilTools.setCellValue(l,r,c),u.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(l,r,c),u.showValidTooltip({rule:t,row:l,column:r,cell:s})})}}})},triggerValidate:function(i){var l=this,e=this.editConfig,t=this.editStore,o=this.editRules,r=this.validStore,n=t.actived;if(n.row&&o){var s=n.args,a=s.row,c=s.column,u=s.cell;if(this.hasCellRules(i,a,c))return this.validCellRules(i,a,c).then(function(){"row"===e.mode&&r.visible&&r.row===a&&r.column===c&&l.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&i!==t.trigger)return Promise.resolve();var o={rule:t,row:a,column:c,cell:u};return l.showValidTooltip(o),Promise.reject(o)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,c,u){var h=this,d={},f=!0,t=this.editRules,p=this.afterFullData,g=this.treeConfig,o=this.treeOpts,i=p;e&&(_xeUtils.default.isFunction(e)?c=e:i=_xeUtils.default.isArray(e)?e:[e]);var l=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var r=this.getColumns(),n=function(n){var e=[];r.forEach(function(l,r){_xeUtils.default.has(t,l.property)&&e.push(new Promise(function(o,i){h.validCellRules("all",n,l).then(o).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:h.getRowIndex(n),row:n,columnIndex:r,column:l,$table:h};return u?(d[l.property]||(d[l.property]=[]),d[l.property].push(t),o()):i(t)})}))}),l.push(Promise.all(e))};return g?_xeUtils.default.eachTree(i,n,o):i.forEach(n),Promise.all(l).then(function(){var e=Object.keys(d);if(e.length)return Promise.reject(d[e[0]][0]);c&&c(f)}).catch(function(s){var a=u?d:_defineProperty({},s.column.property,s);return new Promise(function(e,t){function o(){f=!1,c?(c(f,a),e()):t(a)}function i(){s.cell=_tools.DomTools.getCell(h,s),h.handleValidError(s),o()}var l=s.row,r=p.indexOf(l),n=0<r?p[r-1]:l;_tools.DomTools.toView(h.$el),!1===h.validOpts.autoPos?o():g?h.scrollToTreeRow(n).then(i):h.scrollToRow(n).then(i)})})}return c&&c(f),Promise.resolve()},hasCellRules:function(t,e,o){var i=this.editRules,l=o.property;if(l&&i){var r=_xeUtils.default.get(i,l);return r&&_xeUtils.default.find(r,function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(s,a,c,e){var u=this,t=this.editRules,o=c.property,h=[],i=[];if(o&&t){var d=_xeUtils.default.get(t,o),f=_xeUtils.default.isUndefined(e)?_xeUtils.default.get(a,o):e;d&&d.forEach(function(n){i.push(new Promise(function(o){var e=!0===n.required;if("all"!==s&&n.trigger&&s!==n.trigger)o();else if(_xeUtils.default.isFunction(n.validator))n.validator(n,f,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:n.trigger,message:e.message,rule:n};h.push(new Rule(t))}return o()},{rules:d,row:a,column:c,rowIndex:u.getRowIndex(a),columnIndex:u.getColumnMapIndex(c)});else{var t,i=f,l="number"===n.type,r=null==f||""===f;l?i=_xeUtils.default.toNumber(f):t=_xeUtils.default.getSize(i),e&&r?h.push(new Rule(n)):(l&&isNaN(f)||_xeUtils.default.isRegExp(n.pattern)&&!n.pattern.test(f)||_xeUtils.default.isNumber(n.min)&&(l?i<n.min:t<n.min)||_xeUtils.default.isNumber(n.max)&&(l?i>n.max:t>n.max))&&h.push(new Rule(n)),o()}}))})}return Promise.all(i).then(function(){if(h.length){var e={rules:h,rule:h[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;!1===this.validOpts.autoPos?_tools.UtilTools.emitEvent(this,"valid-error",[e]):this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,o=this.$refs,i=this.height,l=this.tableData,r=this.validOpts,n=e.rule,s=e.row,a=e.column,c=e.cell,u=o.validTip,h=n.message;this.$nextTick(function(){Object.assign(t.validStore,{row:s,column:a,rule:n,content:h,visible:!0}),u&&("tooltip"===r.message||"default"===r.message&&!i&&l.length<2)&&u.toVisible(c,h),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["exportCsv","exportData"]),this.exportData(e)},openExport:function(e){if(this.$toolbar)return this.$toolbar.openExport(e);throw new Error(_tools.UtilTools.getLog("vxe.error.barUnableLink"))},exportData:function(e){var t=this.visibleColumn,o=this.scrollXLoad,i=this.scrollYLoad,l=this.treeConfig,r=this.treeOpts,n=Object.assign({filename:"",sheetName:"",original:!!l,message:!1,isHeader:!0,isFooter:!0,download:!0,type:"csv",data:null,columns:null,columnFilterMethod:e.columns?null:function(e){return-1<["seq","index"].indexOf(e.type)||e.property},dataFilterMethod:null,footerFilterMethod:null},_conf.default.export,e);if(n.filename||(n.filename="export"),n.sheetName||(n.sheetName="Sheet1"),!_xeUtils.default.includes(_vXETable.default.exportTypes,n.type))throw new Error(_tools.UtilTools.getLog("vxe.error.notType",[n.type]));n.original||(o||i)&&(n.original=!0,_tools.UtilTools.warn("vxe.error.scrollOriginal"));var s=t,a=this.tableFullData;return l&&(a=_xeUtils.default.toTreeArray(a,r)),_tools.ExportTools.handleExport(this,n,s,a)},openImport:function(e){if(this.$toolbar)return this.$toolbar.openImport(e);throw new Error(_tools.UtilTools.getLog("vxe.error.barUnableLink"))},importByFile:function(t,e){var o=this;if(window.FileReader){var i=_tools.UtilTools.parseFile(t),l=i.type,r=i.filename,n=Object.assign({mode:"covering"},e,{type:l,filename:r}),s=n.types||_vXETable.default.importTypes;_xeUtils.default.includes(s,l)?this.preventEvent(null,"event.import",{$table:this,file:t,options:n,columns:this.tableFullColumn},function(){var e=new FileReader;e.onerror=function(e){_tools.UtilTools.error("vxe.error.notType",[l])},e.onload=function(e){_tools.ExportTools.handleImport(o,e.target.result.trim(),n)},e.readAsText(t,"UTF-8")}):_tools.UtilTools.error("vxe.error.notType",[l])}else _tools.UtilTools.error("vxe.error.notExp")},importData:function(e){var o=this,t=Object.assign({},_conf.default.import,e),i=new Promise(function(e,t){o._importResolve=e,o._importReject=t});return this.readFile(t).then(function(e){return o.importByFile(e.target.files[0],t)}).catch(function(e){o._importReject(e),o._importReject=null}),i},readFile:function(e){var o=this,i=0<arguments.length&&void 0!==e?e:{};fileForm.parentNode||document.body.appendChild(fileForm);var l=i.types||_vXETable.default.importTypes;return i.multiple&&(fileInput.multiple="multiple"),fileInput.accept=".".concat(l.join(", .")),fileInput.onchange=function(e){var t=_tools.UtilTools.parseFile(e.target.files[0]).type;_xeUtils.default.includes(l,t)?o._fileResolve(e):(!1!==i.message&&o.$XModal.message({message:_xeUtils.default.template(_conf.default.i18n("vxe.error.notType"),[t]),status:"error"}),o._fileReject(e)),o._fileResolve=null},fileForm.reset(),fileInput.click(),new Promise(function(e,t){o._fileResolve=e,o._fileReject=t})},print:function(e){this.exportData(Object.assign({original:this.scrollXLoad||this.scrollYLoad},e,{type:"html",download:!1})).then(function(e){var t=e.content,o=e.blob;if(_tools.DomTools.browse.msie){if(printFrame){try{printFrame.contentDocument.write(""),printFrame.contentDocument.clear()}catch(e){}document.body.removeChild(printFrame)}printFrame=createFrame(),document.body.appendChild(printFrame),printFrame.contentDocument.write(t),printFrame.contentDocument.execCommand("print")}else printFrame||((printFrame=createFrame()).onload=function(e){e.target.src&&e.target.contentWindow.print()},document.body.appendChild(printFrame)),printFrame.src=URL.createObjectURL(o)})},updateZindex:function(){this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex(this))},connect:function(e){var t=e.toolbar;this.$toolbar=t},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;