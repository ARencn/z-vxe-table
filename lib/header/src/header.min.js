"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,l=new Array(e.length);t<e.length;t++)l[t]=e[t];return l}}var getAllColumns=function t(e){var l=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(l.push(e),l.push.apply(l,_toConsumableArray(t(e.children)))):l.push(e))}),l},convertToRows=function(e){var r=1;e.forEach(function(e){e.level=1,function t(l,e){if(e&&(l.level=e.level+1,r<l.level&&(r=l.level)),l.children&&l.children.length&&l.children.some(function(e){return e.visible})){var n=0;l.children.forEach(function(e){e.visible&&(t(e,l),n+=e.colSpan)}),l.colSpan=n}else l.colSpan=1}(e)});for(var t=[],l=0;l<r;l++)t.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=r-e.level+1,t[e.level-1].push(e)}),t},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},render:function($){var W=this,A=this.$parent,S=this.fixedType,e=this.headerColumn,t=this.fixedColumn,l=this.tableColumn,I=A.$listeners,n=A.id,P=A.resizable,U=A.border,z=A.overflowX,E=A.columnKey,r=A.headerRowClassName,k=A.headerCellClassName,o=A.headerRowStyle,H=A.headerCellStyle,i=A.showHeaderOverflow,a=A.showHeaderAllOverflow,O=A.headerAlign,D=A.align,M=A.highlightCurrentColumn,R=A.currentColumn,q=A.scrollXLoad,s=A.scrollXStore,d=A.scrollbarWidth,L=A.cellOffsetWidth,X=A.getColumnIndex,j=A.sortOpts,c=A.tableWidth,B=_xeUtils.default.isBoolean(a)?a:i;return q&&(S&&(l=t),c=l.reduce(function(e,t){return e+t.renderWidth},0)),$("div",{class:["vxe-table--header-wrapper",S?"fixed--".concat(S,"-wrapper"):"body--wrapper"],attrs:{"data-tid":n}},[!S&&q?$("div",{class:["vxe-body--x-space"],style:{width:q?"".concat(A.tableWidth+d,"px"):""}}):null,$("table",{class:"vxe-table--header",attrs:{"data-tid":n,cellspacing:0,cellpadding:0,border:0},style:{width:c?"".concat(c+d,"px"):null,"margin-left":S?null:"".concat(s.leftSpaceWidth,"px")}},[$("colgroup",l.map(function(e,t){var l=e.children&&e.children.length;return $("col",{attrs:{name:e.id},style:{width:e.renderWidth?"".concat(e.renderWidth,"px"):null},key:E||l?e.id:t})}).concat(d?[$("col",{style:{width:"".concat(d,"px")}})]:[])),$("thead",e.map(function(C,T){return $("tr",{class:["vxe-header--row",r?_xeUtils.default.isFunction(r)?r({$table:A,$rowIndex:T,fixed:S}):r:""],style:o?_xeUtils.default.isFunction(o)?o({$table:A,$rowIndex:T,fixed:S}):o:null},C.map(function(t,l){var e,n=t.showHeaderOverflow,r=t.headerAlign,o=t.align,i=t.headerClassName,a=t.renderWidth,s=t.children&&t.children.length,d=S?t.fixed!==S&&!s:t.fixed&&z,c=_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?B:n,u=r||o||O||D,f="ellipsis"===c,h="title"===c,p=!0===c||"tooltip"===c,m=h||p||f,x={},v=t.filters&&t.filters.some(function(e){return e.checked}),y=X(t),b={$table:A,$rowIndex:T,column:t,columnIndex:y,$columnIndex:l,fixed:S,isHidden:d,hasFilter:v};if(q&&!m&&(f=m=!0),(h||p)&&(x.mouseenter=function(e){h?_tools.DomTools.updateCellTitle(e):p&&A.triggerHeaderTooltipEvent(e,{$table:A,$rowIndex:T,column:t,columnIndex:y,$columnIndex:l,fixed:S})}),p&&(x.mouseleave=function(e){p&&A.handleTargetLeaveEvent(e)}),m&&s){var g=0,_=0;_xeUtils.default.eachTree(t.children,function(e){e.children&&t.children.length||_++,g+=e.renderWidth}),a=g-_}(M||I["header-cell-click"]||"cell"===j.trigger)&&(x.click=function(e){return A.triggerHeaderCellClickEvent(e,{$table:A,$rowIndex:T,column:t,columnIndex:y,$columnIndex:l,fixed:S,cell:e.currentTarget})}),I["header-cell-dblclick"]&&(x.dblclick=function(e){return _tools.UtilTools.emitEvent(A,"header-cell-dblclick",[{$table:A,$rowIndex:T,column:t,columnIndex:y,$columnIndex:l,fixed:S,cell:e.currentTarget},e])});var w="seq"===t.type||"index"===t.type?"seq":t.type;return $("th",{class:["vxe-header--column",t.id,(e={},_defineProperty(e,"col--".concat(u),u),_defineProperty(e,"col--".concat(w),w),_defineProperty(e,"col--last",l===C.length-1),_defineProperty(e,"col--fixed",t.fixed),_defineProperty(e,"col--group",s),_defineProperty(e,"col--ellipsis",m),_defineProperty(e,"fixed--hidden",d),_defineProperty(e,"is--sortable",t.sortable),_defineProperty(e,"is--filter",t.filters),_defineProperty(e,"filter--active",v),_defineProperty(e,"col--current",R===t),e),_tools.UtilTools.getClass(i,b),_tools.UtilTools.getClass(k,b)],attrs:{"data-colid":t.id,colspan:t.colSpan,rowspan:t.rowSpan},style:H?_xeUtils.default.isFunction(H)?H(b):H:null,on:x,key:E||s?t.id:y},[$("div",{class:["vxe-cell",{"c--title":h,"c--tooltip":p,"c--ellipsis":f}],style:{width:m?"".concat(a-L,"px"):null}},t.renderHeader($,b)),!d&&!s&&(_xeUtils.default.isBoolean(t.resizable)?t.resizable:P)?$("div",{class:["vxe-resizable",{"is--line":!U}],on:{mousedown:function(e){return W.resizeMousedown(e,b)}}}):null])}).concat(d?[$("th",{class:["col--gutter"],style:{width:"".concat(d,"px")}})]:[]))}))]),$("div",{class:["vxe-table--repair"],style:{width:null===c?c:"".concat(c,"px")}})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,t){var l=t.column,n=this.$parent,r=this.$el,o=this.fixedType,i=n.$refs,a=i.tableBody,s=i.leftContainer,d=i.rightContainer,c=i.resizeBar,u=e.target,f=e.clientX,h=u.parentNode,p=0,m=a.$el,x=_tools.DomTools.getOffsetPos(u,r),v=u.clientWidth,y=x.left-h.clientWidth+v+36,b=x.left+Math.floor(v/2),g=document.onmousemove,_=document.onmouseup,w="left"===o,C="right"===o,T=0;if(w||C){for(var $=w?"nextElementSibling":"previousElementSibling",W=h[$];W&&!_tools.DomTools.hasClass(W,"fixed--hidden");)_tools.DomTools.hasClass(W,"col--group")||(T+=W.offsetWidth),W=W[$];C&&d&&(b=d.offsetLeft+T)}var A=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-f,l=b+t,n=o?0:m.scrollLeft;w?l=Math.min(l,(d?d.offsetLeft:m.clientWidth)-T-36):C&&(y=(s?s.clientWidth:0)+T+36,l=Math.min(l,b+h.clientWidth-36)),p=Math.max(l,y),c.style.left="".concat(p-n,"px")};c.style.display="block",document.onmousemove=A,document.onmouseup=function(){document.onmousemove=g,document.onmouseup=_,l.resizeWidth=l.renderWidth+(C?b-p:p-b),c.style.display="none",n._lastResizeTime=Date.now(),n.analyColumnWidth(),n.recalculate(!0),n.$toolbar&&n.$toolbar.updateResizable(),_tools.UtilTools.emitEvent(n,"resizable-change",[t])},A(e)}}};exports.default=_default;