"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}var getAllColumns=function l(e){var t=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(t.push(e),t.push.apply(t,l(e.children))):t.push(e))}),t},convertToRows=function(e){var o=1;e.forEach(function(e){e.level=1,function l(t,e){if(e&&(t.level=e.level+1,o<t.level&&(o=t.level)),t.children&&t.children.length&&t.children.some(function(e){return e.visible})){var n=0;t.children.forEach(function(e){e.visible&&(l(e,t),n+=e.colSpan)}),t.colSpan=n}else t.colSpan=1}(e)});for(var l=[],t=0;t<o;t++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=o-e.level+1,l[e.level-1].push(e)}),l},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},render:function(T){var W=this,P=this.$parent,I=this.fixedType,e=this.headerColumn,l=this.tableColumn,t=this.fixedColumn,S=P.$listeners,n=P.id,U=P.resizable,z=P.border,E=P.overflowX,k=P.columnKey,o=P.headerRowClassName,A=P.headerCellClassName,i=P.headerRowStyle,D=P.headerCellStyle,r=P.showHeaderOverflow,a=P.showHeaderAllOverflow,H=P.headerAlign,M=P.align,O=P.highlightCurrentColumn,R=P.currentColumn,s=P.tableWidth,L=P.scrollXLoad,q=P.scrollYLoad,d=P.scrollXStore,c=P.scrollbarWidth,X=P.cellOffsetWidth,B=P.getColumnIndex,N=P.sortOpts,F=_xeUtils.default.isBoolean(a)?a:r;return L&&(I&&(l=t),s=l.reduce(function(e,l){return e+l.renderWidth},0)),T("div",{class:["vxe-table--header-wrapper",I?"fixed--".concat(I,"-wrapper"):"body--wrapper"],attrs:{"data-tid":n}},[!I&&L?T("div",{class:["vxe-body--x-space"],style:{width:L?"".concat(P.tableWidth+c,"px"):""}}):null,T("table",{class:"vxe-table--header",attrs:{"data-tid":n,cellspacing:0,cellpadding:0,border:0},style:{width:null===s?s:"".concat(s+c,"px"),"margin-left":I?null:"".concat(d.leftSpaceWidth,"px")}},[T("colgroup",l.map(function(e,l){var t=e.children&&e.children.length;return T("col",{attrs:{name:e.id},style:{width:"".concat(e.renderWidth,"px")},key:k||t?e.id:l})}).concat(c?[T("col",{style:{width:"".concat(c,"px")}})]:[])),T("thead",e.map(function(C,$){return T("tr",{class:["vxe-header--row",o?_xeUtils.default.isFunction(o)?o({$table:P,$rowIndex:$,fixed:I}):o:""],style:i?_xeUtils.default.isFunction(i)?i({$table:P,$rowIndex:$,fixed:I}):i:null},C.map(function(l,t){var e,n=l.showHeaderOverflow,o=l.headerAlign,i=l.align,r=l.renderWidth,a=l.headerClassName,s=l.children&&l.children.length,d=I?l.fixed!==I&&!s:l.fixed&&E,c=_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?F:n,u=o||i||H||M,f="ellipsis"===c,h="title"===c,p=!0===c||"tooltip"===c,m=h||p||f,x={},v=l.filters&&l.filters.some(function(e){return e.checked}),b=B(l),y={$table:P,$rowIndex:$,column:l,columnIndex:b,$columnIndex:t,fixed:I,isHidden:d,hasFilter:v};if(!L&&!q||m||(f=m=!0),(h||p)&&(x.mouseenter=function(e){h?_tools.DomTools.updateCellTitle(e):p&&P.triggerHeaderTooltipEvent(e,{$table:P,$rowIndex:$,column:l,columnIndex:b,$columnIndex:t,fixed:I})}),p&&(x.mouseleave=function(e){p&&P.handleTargetLeaveEvent(e)}),m&&s){var g=0,_=0;_xeUtils.default.eachTree(l.children,function(e){e.children&&l.children.length||_++,g+=e.renderWidth}),r=g-_}(O||S["header-cell-click"]||"cell"===N.trigger)&&(x.click=function(e){return P.triggerHeaderCellClickEvent(e,{$table:P,$rowIndex:$,column:l,columnIndex:b,$columnIndex:t,fixed:I,cell:e.currentTarget})}),S["header-cell-dblclick"]&&(x.dblclick=function(e){return _tools.UtilTools.emitEvent(P,"header-cell-dblclick",[{$table:P,$rowIndex:$,column:l,columnIndex:b,$columnIndex:t,fixed:I,cell:e.currentTarget},e])});var w="seq"===l.type||"index"===l.type?"seq":l.type;return T("th",{class:["vxe-header--column",l.id,(_defineProperty(e={},"col--".concat(u),u),_defineProperty(e,"col--".concat(w),w),_defineProperty(e,"col--last",t===C.length-1),_defineProperty(e,"col--fixed",l.fixed),_defineProperty(e,"col--group",s),_defineProperty(e,"col--ellipsis",m),_defineProperty(e,"fixed--hidden",d),_defineProperty(e,"is--sortable",l.sortable),_defineProperty(e,"is--filter",l.filters),_defineProperty(e,"filter--active",v),_defineProperty(e,"col--current",R===l),e),_tools.UtilTools.getClass(a,y),_tools.UtilTools.getClass(A,y)],attrs:{"data-colid":l.id,colspan:l.colSpan,rowspan:l.rowSpan},style:D?_xeUtils.default.isFunction(D)?D(y):D:null,on:x,key:k||s?l.id:b},[T("div",{class:["vxe-cell",{"c--title":h,"c--tooltip":p,"c--ellipsis":f}],style:{width:m?"".concat(r-X,"px"):null}},l.renderHeader(T,y)),!d&&!s&&(_xeUtils.default.isBoolean(l.resizable)?l.resizable:U)?T("div",{class:["vxe-resizable",{"is--line":!z}],on:{mousedown:function(e){return W.resizeMousedown(e,y)}}}):null])}).concat(c?[T("th",{class:["col--gutter"],style:{width:"".concat(c,"px")}})]:[]))}))]),T("div",{class:["vxe-table--repair"],style:{width:null===s?s:"".concat(s,"px")}})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var t=l.column,n=this.$parent,o=this.$el,i=this.fixedType,r=n.$refs,a=r.tableBody,s=r.leftContainer,d=r.rightContainer,c=r.resizeBar,u=e.target,f=e.clientX,h=u.parentNode,p=0,m=a.$el,x=_tools.DomTools.getOffsetPos(u,o),v=u.clientWidth,b=x.left-h.clientWidth+v+36,y=x.left+Math.floor(v/2),g=document.onmousemove,_=document.onmouseup,w="left"===i,C="right"===i,$=0;if(w||C){for(var T=w?"nextElementSibling":"previousElementSibling",W=h[T];W&&!_tools.DomTools.hasClass(W,"fixed--hidden");)_tools.DomTools.hasClass(W,"col--group")||($+=W.offsetWidth),W=W[T];C&&d&&(y=d.offsetLeft+$)}function P(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-f,t=y+l,n=i?0:m.scrollLeft;w?t=Math.min(t,(d?d.offsetLeft:m.clientWidth)-$-36):C&&(b=(s?s.clientWidth:0)+$+36,t=Math.min(t,y+h.clientWidth-36)),p=Math.max(t,b),c.style.left="".concat(p-n,"px")}c.style.display="block",document.onmousemove=P,document.onmouseup=function(e){document.onmousemove=g,document.onmouseup=_,t.resizeWidth=t.renderWidth+(C?y-p:p-y),c.style.display="none",n._lastResizeTime=Date.now(),n.analyColumnWidth(),n.recalculate(!0),n.$toolbar&&n.$toolbar.updateResizable(),_tools.UtilTools.emitEvent(n,"resizable-change",[l])},P(e)}}};exports.default=_default;