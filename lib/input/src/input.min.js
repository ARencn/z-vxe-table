"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function getNumberDecimal(e){return((""+e).split(".")[1]||"").length}function addition(e,t){var a=Math.pow(10,Math.max(getNumberDecimal(e),getNumberDecimal(t)));return(e*a+t*a)/a}function subtraction(e,t){var a=getNumberDecimal(e),n=getNumberDecimal(t),i=Math.pow(10,Math.max(a,n));return parseFloat(((e*i-t*i)/i).toFixed(n<=a?a:n))}function renderDefaultInput(e,t){var a=t.inpAttrs,n=t.inpEvents;return e("input",{ref:"input",class:"vxe-input--inner",domProps:{value:t.value},attrs:a,on:n})}function renderDateInput(e,t){var a=t.inpAttrs,n=t.inpEvents;return e("input",{ref:"input",class:"vxe-input--inner",domProps:{value:t.inputValue},attrs:a,on:n})}function renderDateDayTable(t,a){var e=a.datePanelType,n=a.dateValue,i=a.datePanelValue,s=a.weekDatas,l=a.dayDatas;return[t("table",{class:"vxe-input--date-".concat(e,"-view"),attrs:{cellspacing:0,cellpadding:0,border:0}},[t("thead",[t("tr",s.map(function(e){return t("th",_conf.default.i18n("vxe.input.date.weeks.w".concat(e)))}))]),t("tbody",l.map(function(e){return t("tr",e.map(function(e){return t("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--today":e.isToday,"is--next":e.isNext,"is--selected":_xeUtils.default.isDateSame(n,e.date,"yyyy-MM-dd"),"is--hover":_xeUtils.default.isDateSame(i,e.date,"yyyy-MM-dd")},on:{click:function(){return a.dateSelectEvent(e)},mouseenter:function(){return a.dateMouseenterEvent(e)}}},e.label)}))}))])]}function renderDateMonthTable(t,a){var e=a.datePanelType,n=a.monthDatas,i=a.datePanelValue;return[t("table",{class:"vxe-input--date-".concat(e,"-view"),attrs:{cellspacing:0,cellpadding:0,border:0}},[t("tbody",n.map(function(e){return t("tr",e.map(function(e){return t("td",{class:{"is--hover":_xeUtils.default.isDateSame(i,e.date,"MM")},on:{click:function(){return a.dateSelectEvent(e)},mouseenter:function(){return a.dateMouseenterEvent(e)}}},_conf.default.i18n("vxe.input.date.months.m".concat(e.month)))}))}))])]}function renderDateYearTable(t,a){var e=a.datePanelType,n=a.yearDatas,i=a.datePanelValue;return[t("table",{class:"vxe-input--date-".concat(e,"-view"),attrs:{cellspacing:0,cellpadding:0,border:0}},[t("tbody",n.map(function(e){return t("tr",e.map(function(e){return t("td",{class:{"is--hover":_xeUtils.default.isDateSame(i,e.date,"yyyy")},on:{click:function(){return a.dateSelectEvent(e)},mouseenter:function(){return a.dateMouseenterEvent(e)}}},e.year)}))}))])]}function renderDateTable(e,t){var a=t.datePanelType;return"month"===a?renderDateMonthTable(e,t):"year"===a?renderDateYearTable(e,t):renderDateDayTable(e,t)}function rendeDatePanel(e,t){var a=t.datePanelType,n=t.selectDatePanelLabel;return[e("div",{class:"vxe-input--date-picker-header"},[e("div",{class:"vxe-input--date-picker-type-wrapper"},[e("span","year"===a?{class:"vxe-input--date-picker-label"}:{class:"vxe-input--date-picker-btn",on:{click:t.dateToggleTypeEvent}},n)]),e("div",{class:"vxe-input--date-picker-btn-wrapper"},[e("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-prev-btn",attrs:{title:_conf.default.i18n("vxe.input.date.prevMonth")},on:{click:t.datePrevMonthEvent}},[e("i",{class:"vxe-icon--caret-left"})]),e("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-current-btn",attrs:{title:_conf.default.i18n("vxe.input.date.today")},on:{click:t.dateTodayMonthEvent}},[e("i",{class:"vxe-icon--dot"})]),e("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-next-btn",attrs:{title:_conf.default.i18n("vxe.input.date.nextMonth")},on:{click:t.dateNextMonthEvent}},[e("i",{class:"vxe-icon--caret-right"})])])]),e("div",{class:"vxe-input--date-picker-body"},renderDateTable(e,t))]}function renderPanel(e,t){var a,n=t.type,i=t.vSize,s=t.isDatePicker,l=t.transfer,r=t.animatVisible,o=t.visiblePanel,u=t.panelPlacement,d=t.panelStyle;return s?e("div",{ref:"panel",class:["vxe-dropdown--panel vxe-input--panel","type--".concat(n),(a={},_defineProperty(a,"size--".concat(i),i),_defineProperty(a,"is--transfer",l),_defineProperty(a,"animat--leave",r),_defineProperty(a,"animat--enter",o),a)],attrs:{"data-placement":u},style:d},[e("div",{class:"vxe-input--panel-wrapper"},rendeDatePanel(e,t))]):null}function renderNumberIcon(e,t){return e("span",{class:"vxe-input--number"},[e("span",{class:"vxe-input--number-prev",on:{click:t.numberPrevEvent}},[e("i",{class:["vxe-input--number-prev-icon",_conf.default.icon.inputPrevNum]})]),e("span",{class:"vxe-input--number-next",on:{click:t.numberNextEvent}},[e("i",{class:["vxe-input--number-next-icon",_conf.default.icon.inputNextNum]})])])}function renderPasswordIcon(e,t){var a=t.showPwd;return e("span",{class:"vxe-input--password",on:{click:t.passwordToggleEvent}},[e("i",{class:["vxe-input--pwd-icon",a?_conf.default.icon.inputShowPwd:_conf.default.icon.inputPwd]})])}function rendePrefixIcon(e,t){var a=t.prefixIcon;return a?e("span",{class:"vxe-input--prefix",on:{click:t.clickPrefixEvent}},[e("i",{class:["vxe-input--prefix-icon",a]})]):null}function renderSuffixIcon(e,t){var a=t.value,n=t.isClearable,i=t.disabled,s=t.suffixIcon;return n||s?e("span",{class:["vxe-input--suffix",{"is--clear":n&&!i&&!(""===a||_xeUtils.default.eqNull(a))}],on:{click:t.clickSuffixEvent}},[s?e("i",{class:["vxe-input--suffix-icon",s]}):null,n?e("i",{class:["vxe-input--clear-icon",_conf.default.icon.inputClear]}):null]):null}function renderExtraPrefixIcon(e,t){return t.isDatePicker?e("span",{class:"vxe-input--extra-prefix"},[e("span",{class:"vxe-input--date-picker"},[e("i",{class:["vxe-input--date-picker-icon",_conf.default.icon.inputDate]})])]):null}function renderExtraSuffixIcon(e,t){var a=t.isPassword,n=t.isNumber,i=t.isDatePicker;return a||n||i?e("span",{class:"vxe-input--extra-suffix"},[a?renderPasswordIcon(e,t):null,n?renderNumberIcon(e,t):null]):null}var _default2={name:"VxeInput",props:{value:[String,Number,Date],name:String,type:{type:String,default:"text"},clearable:{type:Boolean,default:function(){return _conf.default.input.clearable}},readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],autocomplete:{type:String,default:"off"},form:String,labelFormat:{type:String,default:function(){return _conf.default.input.labelFormat}},parseFormat:{type:String,default:function(){return _conf.default.input.parseFormat}},valueFormat:{type:String,default:function(){return _conf.default.input.valueFormat}},startWeek:{type:[Number,String],default:function(){return _conf.default.input.startWeek}},size:String,step:[String,Number],prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:function(){return _conf.default.input.transfer}}},data:function(){return{panelIndex:0,showPwd:!1,visiblePanel:!1,animatVisible:!1,panelStyle:null,panelPlacement:null,isActivated:!1,inputValue:"",datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},isNumber:function(){return-1<["number","integer"].indexOf(this.type)},isDatePicker:function(){return-1<["date","month","year"].indexOf(this.type)},isPassword:function(){return"password"===this.type},stepValue:function(){return("integer"===this.type?_xeUtils.default.toInteger(this.step):_xeUtils.default.toNumber(this.step))||1},isClearable:function(){return this.clearable&&(this.isPassword||this.isNumber||"text"===this.type||"search"===this.type)},dateValue:function(){var e=this.value;return e?_xeUtils.default.toStringDate(e,this.dateLabelFormat):null},dateLabelFormat:function(){var e=this.labelFormat;return e||"yyyy-MM-dd"},selectDatePanelLabel:function(){var e,t=this.datePanelType,a=this.selectMonth,n=this.yearList,i="";return a&&(i=a.getFullYear(),e=a.getMonth()+1),"month"===t?_xeUtils.default.template(_conf.default.i18n("vxe.input.date.monthLabel"),[i]):"year"===t?n.length?"".concat(n[0].year," - ").concat(n[n.length-1].year):"":_xeUtils.default.template(_conf.default.i18n("vxe.input.date.dayLabel"),[i,e?_conf.default.i18n("vxe.input.date.m".concat(e)):"-"])},weekDatas:function(){for(var e=_xeUtils.default.toNumber(this.startWeek),t=[e],a=0;a<6;a++)6<=e?e=0:e++,t.push(e);return t},yearList:function(){var e=this.selectMonth,t=[];if(e)for(var a=0;a<16;a++){var n=_xeUtils.default.getWhatYear(e,a,"first");t.push({date:n,year:n.getFullYear()})}return t},yearDatas:function(){return _xeUtils.default.chunk(this.yearList,4)},monthList:function(){var e=this.selectMonth,t=[];if(e)for(var a=0;a<12;a++){var n=_xeUtils.default.getWhatYear(e,0,a);t.push({date:n,month:a})}return t},monthDatas:function(){return _xeUtils.default.chunk(this.monthList,4)},dayList:function(){var e=this.weekDatas,t=this.selectMonth,a=this.currentDate,n=[];if(t&&a)for(var i=t.getMonth(),s=t.getDay(),l=-e.indexOf(s),r=Math.abs(l),o=_xeUtils.default.getWhatDay(t,l),u=0;u<42;u++){var d=_xeUtils.default.getWhatDay(o,u),h=u<r;n.push({date:d,isPrev:h,isCurrent:d.getFullYear()===t.getFullYear()&&d.getMonth()===t.getMonth(),isToday:d.getFullYear()===a.getFullYear()&&d.getMonth()===a.getMonth()&&d.getDate()===a.getDate(),isNext:!h&&i!==d.getMonth(),label:d.getDate()})}return n},dayDatas:function(){return _xeUtils.default.chunk(this.dayList,7)},inpAttrs:function(){var e=this.isDatePicker,t=this.isPassword,a=this.type,n=this.name,i=this.placeholder,s=this.readonly,l=this.disabled,r=this.maxlength,o=this.form,u=this.autocomplete,d=this.showPwd,h={name:n,form:o,type:a,placeholder:i,maxlength:r,readonly:s,disabled:l,autocomplete:u};return(e||t&&d)&&(h.type="text"),i&&(h.placeholder=_tools.UtilTools.getFuncText(i)),h},inpEvents:function(){var a=this,n={};return _xeUtils.default.each(this.$listeners,function(e,t){-1===["clear","prefix-click","suffix-click"].indexOf(t)&&(n[t]=a.triggerEvent)}),this.isNumber?n.keydown=this.keydownEvent:this.isDatePicker&&(n.click=this.clickEvent),n.input=this.inputEvent,n.focus=this.focusEvent,n}},watch:{value:function(){this.changeValue()}},created:function(){this.changeValue(),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent)},mounted:function(){this.isDatePicker&&this.transfer&&document.body.appendChild(this.$refs.panel)},beforeDestroy:function(){var e=this.$refs.panel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"blur")},render:function(e){var t,a=this.isClearable,n=this.isDatePicker,i=this.visiblePanel,s=this.isActivated,l=this.vSize,r=this.type,o=this.readonly,u=this.disabled,d=this.prefixIcon,h=this.suffixIcon;return e("div",{class:["vxe-input","type--".concat(r),(t={},_defineProperty(t,"size--".concat(l),l),_defineProperty(t,"is--prefix",d),_defineProperty(t,"is--suffix",a||h),_defineProperty(t,"is--readonly",o),_defineProperty(t,"is--visivle",i),_defineProperty(t,"is--disabled",u),_defineProperty(t,"is--active",s),t)]},[renderExtraPrefixIcon(e,this),rendePrefixIcon(e,this),n?renderDateInput(e,this):renderDefaultInput(e,this),renderSuffixIcon(e,this),renderExtraSuffixIcon(e,this),renderPanel(e,this)])},methods:{focus:function(){return this.$refs.input.focus(),this.$nextTick()},blur:function(){return this.$refs.input.blur(),this.$nextTick()},triggerEvent:function(e){var t=this.$refs,a=this.value;this.$emit(e.type,{$panel:t.panel,value:a},e)},emitUpdate:function(e){this.$emit("input",e)},inputEvent:function(e){var t=this.isDatePicker,a=e.target.value;this.inputValue=a,t||this.emitUpdate(a)},focusEvent:function(e){this.isActivated=!0,this.triggerEvent(e)},keydownEvent:function(e){var t=e.keyCode,a=38===t;(a||40===t)&&(e.preventDefault(),a?this.numberPrevEvent(e):this.numberNextEvent(e)),this.triggerEvent(e)},clickEvent:function(e){this.isDatePicker&&(e.preventDefault(),this.showPanel()),this.triggerEvent(e)},clickPrefixEvent:function(e){var t=this.$refs,a=this.disabled,n=this.value;a||this.$emit("prefix-click",{$panel:t.panel,value:n},e)},clickSuffixEvent:function(e){var t=this.$refs,a=this.disabled,n=this.value;a||(_tools.DomTools.hasClass(e.currentTarget,"is--clear")?(this.emitUpdate(""),this.clearValueEvent(e,"")):this.$emit("suffix-click",{$panel:t.panel,value:n},e))},clearValueEvent:function(e,t){var a=this.$refs;this.$emit("clear",{$panel:a.panel,value:t},e)},changeValue:function(){this.isDatePicker&&(this.dateParseValue(this.value),this.inputValue=this.datePanelLabel)},afterCheckValue:function(){var e=this.type,t=this.value,a=this.isDatePicker,n=this.isNumber,i=this.dateLabelFormat,s=this.inputValue;n?s&&(s="integer"===e?_xeUtils.default.toInteger(s):_xeUtils.default.toNumber(s),_xeUtils.default.isEqual(t,s)||this.emitUpdate(s)):a&&s&&(s=_xeUtils.default.toStringDate(s,i),_xeUtils.default.isDate(s)?_xeUtils.default.isEqual(t,s)||this.dateChangeValue(s):this.dateRevertValue())},passwordToggleEvent:function(){var e=this.disabled,t=this.readonly,a=this.showPwd;e||t||(this.showPwd=!a)},numberPrevEvent:function(){var e=this.disabled,t=this.readonly;e||t||this.numberChange(!0)},numberNextEvent:function(){var e=this.disabled,t=this.readonly;e||t||this.numberChange(!1)},numberChange:function(e){var t=this.value,a=this.stepValue,n="integer"===this.type?_xeUtils.default.toInteger(t):_xeUtils.default.toNumber(t);this.emitUpdate(e?addition(n,a):subtraction(n,a))},dateMonthHandle:function(e,t){this.selectMonth=_xeUtils.default.getWhatMonth(e,t,"first")},dateNowHandle:function(){var e=_xeUtils.default.getWhatDay(Date.now(),0,"first");this.currentDate=e,this.dateMonthHandle(e,0)},dateToggleTypeEvent:function(){var e=this.datePanelType;e="month"===e?"year":"month",this.datePanelType=e},datePrevMonthEvent:function(){var e=this.type;this.selectMonth="year"===e?_xeUtils.default.getWhatYear(this.selectMonth,-16,"first"):"month"===e?_xeUtils.default.getWhatYear(this.selectMonth,-1,"first"):_xeUtils.default.getWhatMonth(this.selectMonth,-1,"first")},dateTodayMonthEvent:function(){this.dateNowHandle(),this.dateChangeValue(this.currentDate),this.hidePanel()},dateNextMonthEvent:function(){var e=this.type;this.selectMonth="year"===e?_xeUtils.default.getWhatYear(this.selectMonth,16,"first"):"month"===e?_xeUtils.default.getWhatYear(this.selectMonth,1,"first"):_xeUtils.default.getWhatMonth(this.selectMonth,1,"first")},dateSelectEvent:function(e){this.dateSelectItem(e.date)},dateSelectItem:function(e){var t=this.type,a=this.datePanelType;"month"===t?"year"===a?this.datePanelType="month":(this.dateChangeValue(e),this.hidePanel()):"year"===t?(this.dateChangeValue(e),this.hidePanel()):"month"===a?this.datePanelType="day":"year"===a?this.datePanelType="month":(this.dateChangeValue(e),this.hidePanel())},dateMouseenterEvent:function(e){var t=this.datePanelType;"month"===t?this.dateMoveMonth(e.date):"year"===t?this.dateMoveYear(e.date):this.dateMoveDay(e.date)},dateMoveDay:function(t){this.dayList.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy-MM-dd")})||this.dateCheckMonth(t),this.dateParseValue(t)},dateMoveMonth:function(e){this.dateCheckMonth(e),this.dateParseValue(e)},dateMoveYear:function(t){this.yearList.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy")})||this.dateCheckMonth(t),this.dateParseValue(t)},dateParseValue:function(e){var t=this.dateLabelFormat,a=this.parseFormat,n=e?_xeUtils.default.toStringDate(e,a):null,i="";_xeUtils.default.isDate(n)?i=_xeUtils.default.toDateString(n,t):n=null,this.datePanelValue=n,this.datePanelLabel=i},dateOffsetEvent:function(e){var t=this.isActivated,a=this.datePanelValue,n=this.datePanelType,i=e.keyCode,s=37===i,l=38===i,r=39===i,o=40===i;if(t)if(e.preventDefault(),"month"===n){var u=_xeUtils.default.getWhatMonth(a||Date.now(),0,"first");s?u=_xeUtils.default.getWhatMonth(u,-1):l?u=_xeUtils.default.getWhatMonth(u,-4):r?u=_xeUtils.default.getWhatMonth(u,1):o&&(u=_xeUtils.default.getWhatMonth(u,4)),this.dateMoveMonth(u)}else if("year"===n){var d=_xeUtils.default.getWhatYear(a||Date.now(),0,"first");s?d=_xeUtils.default.getWhatYear(d,-1):l?d=_xeUtils.default.getWhatYear(d,-4):r?d=_xeUtils.default.getWhatYear(d,1):o&&(d=_xeUtils.default.getWhatYear(d,4)),this.dateMoveYear(d)}else{var h=a||_xeUtils.default.getWhatDay(Date.now(),0,"first");s?h=_xeUtils.default.getWhatDay(h,-1):l?h=_xeUtils.default.getWhatWeek(h,-1):r?h=_xeUtils.default.getWhatDay(h,1):o&&(h=_xeUtils.default.getWhatWeek(h,1)),this.dateMoveDay(h)}},dateChangeValue:function(e){var t=this.value,a=this.valueFormat,n=a?_xeUtils.default.toDateString(e,a):e;this.dateCheckMonth(e),_xeUtils.default.isEqual(t,n)||this.emitUpdate(n)},dateCheckMonth:function(e){var t=_xeUtils.default.getWhatMonth(e,0,"first");_xeUtils.default.isEqual(t,this.selectMonth)||(this.selectMonth=t)},dateOpenPanel:function(){var e=this.dateValue;this.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),e?this.dateMonthHandle(e,0):this.dateNowHandle()},dateRevertValue:function(){this.inputValue=this.datePanelLabel},updateZindex:function(){this.panelIndex<_tools.UtilTools.getLastZIndex()&&(this.panelIndex=_tools.UtilTools.nextZIndex())},showPanel:function(){var e=this,t=this.type,a=this.disabled,n=this.visiblePanel,i=this.isDatePicker;a||n||(clearTimeout(this.hidePanelTimeout),this.isActivated=!0,this.animatVisible=!0,i&&(-1<["year","month"].indexOf(t)?this.datePanelType=t:this.datePanelType="day",this.dateOpenPanel()),setTimeout(function(){e.visiblePanel=!0},10),this.updateZindex(),this.updatePlacement())},hidePanel:function(){var e=this;this.visiblePanel=!1,this.hidePanelTimeout=setTimeout(function(){e.animatVisible=!1},250)},updatePlacement:function(){var m=this;this.$nextTick(function(){var e=m.$refs,t=m.transfer,a=m.placement,n=m.panelIndex,i=e.input,s=e.panel,l=i.offsetHeight,r=i.offsetWidth,o=s.offsetHeight,u={zIndex:n},d=_tools.DomTools.getAbsolutePos(i),h=d.boundingTop,c=d.boundingLeft,f=d.visibleHeight,p="bottom";if(t){var v=c,x=h+l;"top"===a?(p="top",x=h-o):(f<x+o&&(p="top",x=h-o),x<0&&(p="bottom",x=h+l)),Object.assign(u,{left:"".concat(v,"px"),top:"".concat(x,"px"),minWidth:"".concat(r,"px")})}else"top"===a?(p="top",u.bottom="".concat(l,"px")):f<h+l+o&&(p="top",u.bottom="".concat(l,"px"));m.panelStyle=u,m.panelPlacement=p})},handleGlobalMousedownEvent:function(e){var t=this.$refs,a=this.$el,n=this.disabled,i=this.visiblePanel,s=this.isActivated;!n&&s&&(this.isActivated=_tools.DomTools.getEventTargetNode(e,a).flag||_tools.DomTools.getEventTargetNode(e,t.panel).flag,this.isActivated||(i&&this.hidePanel(),this.afterCheckValue()))},handleGlobalKeydownEvent:function(e){var t=this.isDatePicker,a=this.visiblePanel,n=this.clearable;if(!this.disabled){var i=e.keyCode,s=9===i,l=46===i,r=27===i,o=13===i,u=37===i||38===i||39===i||40===i,d=this.isActivated;s?(d=!1,this.isActivated&&this.afterCheckValue(),this.isActivated=d):u&&t&&this.dateOffsetEvent(e),o?t&&(a?this.dateSelectItem(this.datePanelValue):d&&this.showPanel()):(s||r)&&a&&this.hidePanel(),l&&n&&d&&this.clearValueEvent(e,null)}},handleGlobalMousewheelEvent:function(e){var t=this.$refs,a=this.$el,n=this.visiblePanel;_tools.DomTools.getEventTargetNode(e,a).flag||_tools.DomTools.getEventTargetNode(e,t.panel).flag||(n&&this.hidePanel(),this.afterCheckValue())},handleGlobalBlurEvent:function(){this.visiblePanel&&this.hidePanel(),this.afterCheckValue()}}};exports.default=_default2;